<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Effects Pro Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/components/tooltips.css" />
  </head>
  <body>
    <div class="app">
      <button
        class="btn ghost sidebar-open-toggle"
        id="sidebarOpen"
        type="button"
        aria-controls="controlSidebar"
        aria-expanded="false"
      >
        Controls
      </button>

      <header class="hero">
        <div class="eyebrow">Effects Pro</div>
        <h1>Effects Dashboard</h1>
      </header>

      <div class="layout">
        <aside class="sidebar" id="controlSidebar" aria-label="Control Panel">
          <div class="sidebar-head">
            <div class="sidebar-brand" aria-hidden="true">
              <span class="sidebar-brand-label">Controls</span>
            </div>

            <button
              class="btn ghost sidebar-collapse-toggle"
              id="sidebarToggle"
              type="button"
              aria-controls="controlSidebar"
              aria-expanded="true"
              data-tooltip="Collapse controls"
            >
              <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                <path
                  fill="currentColor"
                  d="M10.78 2.72a.75.75 0 0 1 0 1.06L7.56 7l3.22 3.22a.75.75 0 1 1-1.06 1.06L5.97 7.53a.75.75 0 0 1 0-1.06l3.75-3.75a.75.75 0 0 1 1.06 0Z"
                />
              </svg>
              <span class="sr-only">Toggle controls sidebar</span>
            </button>
          </div>

          <div class="sidebar-panels">
            <section class="panel sidebar-panel" style="--delay: 60ms">
              <h2>Playback Controls</h2>
              <div class="row">
                <div class="buttons sidebar-buttons" style="margin-top: 0">
                  <button
                    class="btn secondary"
                    id="playSelection"
                    data-tooltip="Play selection"
                    style="display: inline-flex; align-items: center; gap: 6px"
                  >
                    <svg
                      id="playIcon"
                      viewBox="0 0 16 16"
                      width="14"
                      height="14"
                      fill="currentColor"
                    >
                      <path d="M3 2v12l10-6z" />
                    </svg>
                    <svg
                      id="pauseIcon"
                      viewBox="0 0 16 16"
                      width="14"
                      height="14"
                      fill="currentColor"
                      style="display: none"
                    >
                      <path d="M3 2h3v12H3V2zm7 0h3v12h-3V2z" />
                    </svg>
                    <span class="btn-label" id="playButtonText">Play</span>
                  </button>
                  <button class="btn ghost" id="stopSelection" disabled data-tooltip="Stop">
                    <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                      <path fill="currentColor" d="M4 4h8v8H4V4Z" />
                    </svg>
                    <span class="btn-label">Stop</span>
                  </button>
                  <button
                    class="btn ghost"
                    id="resetAnimation"
                    data-tooltip="Restart current animation"
                  >
                    <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                      <path
                        fill="currentColor"
                        d="M3.5 8a4.5 4.5 0 1 1 1.2 3.1.75.75 0 0 1 1.1-1.02A3 3 0 1 0 5 8H6.5a.5.5 0 0 1 .35.85l-2 2a.5.5 0 0 1-.7 0l-2-2A.5.5 0 0 1 2.5 8H3.5Z"
                      />
                    </svg>
                    <span class="btn-label">Reset</span>
                  </button>
                </div>
                <div class="now-playing" id="nowPlayingWrap" data-active="false">
                  <span class="now-dot"></span>
                  <span>Now playing:</span>
                  <strong id="nowPlaying">None</strong>
                </div>
              </div>
            </section>

            <section class="panel sidebar-panel" style="--delay: 60ms">
              <h2>Persistence</h2>
              <div class="buttons sidebar-buttons" style="margin-top: 0">
                <button class="btn" id="saveConfig" data-tooltip="Save + stage tour code">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M1.75 2A1.75 1.75 0 0 1 3.5.25h7.19c.46 0 .9.18 1.22.5l2.34 2.34c.32.32.5.76.5 1.22V14.5A1.75 1.75 0 0 1 13 16.25H3.5A1.75 1.75 0 0 1 1.75 14.5V2ZM4 1.75v4h7v-4H4Zm0 6.5v6.5h8v-6.5H4Z"
                    />
                  </svg>
                  <span class="btn-label">Save</span>
                </button>
                <button
                  class="btn ghost"
                  id="copyTourCode"
                  type="button"
                  data-tooltip="Save to enable tour code copy"
                >
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M5.5 1.75A1.75 1.75 0 0 1 7.25 0h6A1.75 1.75 0 0 1 15 1.75v7A1.75 1.75 0 0 1 13.25 10.5h-6A1.75 1.75 0 0 1 5.5 8.75v-7Zm1.75-.25a.25.25 0 0 0-.25.25v7c0 .14.11.25.25.25h6a.25.25 0 0 0 .25-.25v-7a.25.25 0 0 0-.25-.25h-6ZM1 6.75C1 5.78 1.78 5 2.75 5h1.1a.75.75 0 0 1 0 1.5h-1.1a.25.25 0 0 0-.25.25v7c0 .14.11.25.25.25h6c.14 0 .25-.11.25-.25v-1.1a.75.75 0 0 1 1.5 0v1.1A1.75 1.75 0 0 1 8.75 16h-6A1.75 1.75 0 0 1 1 14.25v-7Z"
                    />
                  </svg>
                  <span class="btn-label">Copy Tour Code</span>
                </button>
                <button class="btn ghost" id="exportConfig" data-tooltip="Export JSON">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M8 1a.75.75 0 0 1 .75.75V8.19l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72V1.75A.75.75 0 0 1 8 1Zm-6 12a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 13Z"
                    />
                  </svg>
                  <span class="btn-label">Export JSON</span>
                </button>
                <button
                  class="btn ghost"
                  id="exportConfigJs"
                  data-tooltip="Export JS"
                  style="display: none"
                  aria-hidden="true"
                >
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M5.75 13.5h5.6a2.65 2.65 0 0 0 .3-5.28 3.75 3.75 0 0 0-7.3-1.1A2.75 2.75 0 0 0 5.75 13.5Zm2.25-2.25a.75.75 0 0 1-.75-.75V7.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 1 1-1.06 1.06l-.97-.97V10.5a.75.75 0 0 1-.75.75Z"
                    />
                  </svg>
                  <span class="btn-label">Export JS</span>
                </button>
              </div>
              <div class="file-row" style="margin-top: 8px">
                <label class="file-input" data-tooltip="Import JSON">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M8 15a.75.75 0 0 1-.75-.75V7.81L5.53 9.53a.75.75 0 1 1-1.06-1.06l3-3a.75.75 0 0 1 1.06 0l3 3a.75.75 0 1 1-1.06 1.06L8.75 7.81v6.44A.75.75 0 0 1 8 15ZM2 3a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 3Z"
                    />
                  </svg>
                  <span class="btn-label">Import JSON</span>
                  <input type="file" id="importConfig" accept="application/json" />
                </label>
              </div>
            </section>
          </div>
        </aside>

        <div class="sidebar-backdrop" id="sidebarBackdrop" hidden></div>

        <main class="grid content-grid">
          <section class="panel span-2" style="--delay: 0ms; display: none">
            <h2>Master Controls</h2>
            <div class="row">
              <label class="toggle">
                <input type="checkbox" id="domEnabled" />
                <span>DOM overlay enabled</span>
              </label>
              <div class="field">
                <label for="mode">Mode</label>
                <select id="mode">
                  <option value="dom">DOM only</option>
                  <option value="button">Button only</option>
                  <option value="both">Both</option>
                </select>
              </div>
              <label class="toggle">
                <input type="checkbox" id="reducedMotion" />
                <span>Respect reduced motion</span>
              </label>
              <div class="field">
                <label for="zIndex">Z-index</label>
                <input type="number" id="zIndex" min="1" max="9999999" />
              </div>
            </div>
          </section>

          <section class="panel span-2" style="--delay: 100ms">
            <h2>One-Shot Effects</h2>
            <p class="panel-note">
              Single burst transitions that play once and finish automatically.
            </p>
            <div class="radio-section">
              <div class="radio-grid no-scroll" id="effectRadios"></div>
            </div>
          </section>

          <!-- SETTINGS COLUMN -->
          <section class="panel span-2" style="--delay: 120ms">
            <h2>Settings</h2>
            <p class="panel-note" id="settingsGlobalHint">
              Select an effect above to see its settings.
            </p>

            <!-- Theme Settings - shown when theme selected -->
            <div
              class="subsection"
              id="themeSettingsSection"
              style="display: none; margin-top: 0; padding-top: 0; border-top: none"
            >
              <div class="subhead">Effect Settings</div>
              <div class="row">
                <div class="field">
                  <label for="themeLifetime">Theme lifetime</label>
                  <select id="themeLifetime" data-path="themeLifetime">
                    <option value="permanent">Permanent</option>
                    <option value="timed">Timed</option>
                  </select>
                </div>
                <div class="field">
                  <label for="themeDuration">Theme duration (sec)</label>
                  <input
                    type="number"
                    id="themeDuration"
                    min="5"
                    max="300"
                    data-path="themeDurationSec"
                  />
                </div>
              </div>

              <!-- Storm Theme Controls -->
              <div
                class="theme-controls"
                id="stormThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="stormDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormDurationMs"
                        min="2000"
                        max="30000"
                        step="250"
                        data-path="effects.storm.durationMs"
                        data-output="stormDurationMsOut"
                      />
                      <output id="stormDurationMsOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBackgroundOpacity">Background opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBackgroundOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.storm.backgroundOpacity"
                        data-output="stormBackgroundOpacityOut"
                      />
                      <output id="stormBackgroundOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormLightningCycle">Lightning cycle (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormLightningCycle"
                        min="2000"
                        max="12000"
                        step="250"
                        data-path="effects.storm.lightningCycleMs"
                        data-output="stormLightningCycleOut"
                      />
                      <output id="stormLightningCycleOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormRainCount">Rain count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormRainCount"
                        min="50"
                        max="1600"
                        step="25"
                        data-path="effects.storm.rainCount"
                        data-output="stormRainCountOut"
                      />
                      <output id="stormRainCountOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormWindXMin">Wind X min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormWindXMin"
                        min="-12"
                        max="12"
                        step="0.5"
                        data-path="effects.storm.windXMin"
                        data-output="stormWindXMinOut"
                      />
                      <output id="stormWindXMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormWindXMax">Wind X max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormWindXMax"
                        min="-12"
                        max="12"
                        step="0.5"
                        data-path="effects.storm.windXMax"
                        data-output="stormWindXMaxOut"
                      />
                      <output id="stormWindXMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormSpeedYMin">Fall speed Y min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormSpeedYMin"
                        min="1"
                        max="35"
                        step="0.5"
                        data-path="effects.storm.speedYMin"
                        data-output="stormSpeedYMinOut"
                      />
                      <output id="stormSpeedYMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormSpeedYMax">Fall speed Y max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormSpeedYMax"
                        min="1"
                        max="40"
                        step="0.5"
                        data-path="effects.storm.speedYMax"
                        data-output="stormSpeedYMaxOut"
                      />
                      <output id="stormSpeedYMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormLengthMin">Drop length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormLengthMin"
                        min="0"
                        max="10"
                        step="0.1"
                        data-path="effects.storm.rainLengthMin"
                        data-output="stormLengthMinOut"
                      />
                      <output id="stormLengthMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormLengthMax">Drop length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormLengthMax"
                        min="0"
                        max="12"
                        step="0.1"
                        data-path="effects.storm.rainLengthMax"
                        data-output="stormLengthMaxOut"
                      />
                      <output id="stormLengthMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormOpacityMin">Drop opacity min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormOpacityMin"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.storm.rainOpacityMin"
                        data-output="stormOpacityMinOut"
                      />
                      <output id="stormOpacityMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormOpacityMax">Drop opacity max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormOpacityMax"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.storm.rainOpacityMax"
                        data-output="stormOpacityMaxOut"
                      />
                      <output id="stormOpacityMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltStartDelay">Random bolt start (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltStartDelay"
                        min="0"
                        max="20000"
                        step="500"
                        data-path="effects.storm.randomBoltStartDelayMs"
                        data-output="stormBoltStartDelayOut"
                      />
                      <output id="stormBoltStartDelayOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDelayMin">Random bolt delay min (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDelayMin"
                        min="200"
                        max="15000"
                        step="250"
                        data-path="effects.storm.randomBoltDelayMinMs"
                        data-output="stormBoltDelayMinOut"
                      />
                      <output id="stormBoltDelayMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDelayMax">Random bolt delay max (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDelayMax"
                        min="200"
                        max="20000"
                        step="250"
                        data-path="effects.storm.randomBoltDelayMaxMs"
                        data-output="stormBoltDelayMaxOut"
                      />
                      <output id="stormBoltDelayMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDurMin">Bolt duration min (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDurMin"
                        min="60"
                        max="2000"
                        step="25"
                        data-path="effects.storm.randomBoltDurationMinMs"
                        data-output="stormBoltDurMinOut"
                      />
                      <output id="stormBoltDurMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDurMax">Bolt duration max (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDurMax"
                        min="60"
                        max="2500"
                        step="25"
                        data-path="effects.storm.randomBoltDurationMaxMs"
                        data-output="stormBoltDurMaxOut"
                      />
                      <output id="stormBoltDurMaxOut"></output>
                    </div>
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  Tip: keep background opacity low if you want the tour to remain clearly visible
                  under the storm.
                </p>
              </div>

              <!-- Burn Theme Controls removed (Burn migrated to One-Shot effects). -->

              <!-- Bokeh Theme Controls -->
              <div
                class="theme-controls"
                id="bokehThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="bokehDurationMs">Duration (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehDurationMs"
                      min="1500"
                      max="30000"
                      step="250"
                      data-path="effects.bokeh.durationMs"
                      data-output="bokehDurationMsOut"
                    />
                    <output id="bokehDurationMsOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehLightCount">Number of lights</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehLightCount"
                      min="50"
                      max="300"
                      step="10"
                      data-path="effects.bokeh.lightCount"
                      data-output="bokehLightCountOut"
                    />
                    <output id="bokehLightCountOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehLightSize">Light size</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehLightSize"
                      min="50"
                      max="150"
                      step="5"
                      data-path="effects.bokeh.lightSize"
                      data-output="bokehLightSizeOut"
                    />
                    <output id="bokehLightSizeOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehBlurLevel">Blur intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehBlurLevel"
                      min="1"
                      max="5"
                      step="1"
                      data-path="effects.bokeh.blurLevel"
                      data-output="bokehBlurLevelOut"
                    />
                    <output id="bokehBlurLevelOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehSpeed">Animation speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehSpeed"
                      min="0.5"
                      max="2"
                      step="0.1"
                      data-path="effects.bokeh.speed"
                      data-output="bokehSpeedOut"
                    />
                    <output id="bokehSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehPalette">Color palette</label>
                  <select id="bokehPalette" data-path="effects.bokeh.palette">
                    <option value="festive">Festive (Multi-color)</option>
                    <option value="cool">Cool (Blues/Greens)</option>
                    <option value="warm">Warm (Reds/Oranges)</option>
                  </select>
                </div>
              </div>

              <!-- Electric Theme Controls -->
              <div
                class="theme-controls"
                id="electricThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="electricDurationMs">Duration (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricDurationMs"
                      min="500"
                      max="30000"
                      step="100"
                      data-path="effects.electric.durationMs"
                      data-output="electricDurationMsOut"
                    />
                    <output id="electricDurationMsOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricMinDelay">Min delay (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricMinDelay"
                      min="20"
                      max="200"
                      step="10"
                      data-path="effects.electric.minDelay"
                      data-output="electricMinDelayOut"
                    />
                    <output id="electricMinDelayOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricMaxDelay">Max delay (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricMaxDelay"
                      min="200"
                      max="2000"
                      step="50"
                      data-path="effects.electric.maxDelay"
                      data-output="electricMaxDelayOut"
                    />
                    <output id="electricMaxDelayOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricChaosChance">Chaos chance (multi-bolt)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricChaosChance"
                      min="0"
                      max="1"
                      step="0.05"
                      data-path="effects.electric.chaosChance"
                      data-output="electricChaosChanceOut"
                    />
                    <output id="electricChaosChanceOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricBoltColor">Lightning color</label>
                  <input
                    type="color"
                    id="electricBoltColor"
                    data-path="effects.electric.boltColor"
                  />
                </div>
                <div class="field">
                  <label for="electricBranchColor">Branch color</label>
                  <input
                    type="color"
                    id="electricBranchColor"
                    data-path="effects.electric.branchColor"
                  />
                </div>
                <div class="field">
                  <label for="electricFlashIntensity">Flash intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricFlashIntensity"
                      min="0"
                      max="1"
                      step="0.05"
                      data-path="effects.electric.flashIntensity"
                      data-output="electricFlashIntensityOut"
                    />
                    <output id="electricFlashIntensityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricShakeIntensity">Shake intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricShakeIntensity"
                      min="0"
                      max="2"
                      step="0.1"
                      data-path="effects.electric.shakeIntensity"
                      data-output="electricShakeIntensityOut"
                    />
                    <output id="electricShakeIntensityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricSparkCount">Spark count</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricSparkCount"
                      min="0"
                      max="50"
                      step="2"
                      data-path="effects.electric.sparkCount"
                      data-output="electricSparkCountOut"
                    />
                    <output id="electricSparkCountOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricBoltWidth">Bolt width</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricBoltWidth"
                      min="1"
                      max="10"
                      step="0.5"
                      data-path="effects.electric.boltWidth"
                      data-output="electricBoltWidthOut"
                    />
                    <output id="electricBoltWidthOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricDisplacement">Jaggedness</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricDisplacement"
                      min="20"
                      max="300"
                      step="10"
                      data-path="effects.electric.displacement"
                      data-output="electricDisplacementOut"
                    />
                    <output id="electricDisplacementOut"></output>
                  </div>
                </div>
              </div>

              <!-- Water Theme Controls -->
              <div
                class="theme-controls"
                id="waterThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="waterDurationMs">Duration (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterDurationMs"
                      min="2000"
                      max="30000"
                      step="250"
                      data-path="effects.water.durationMs"
                      data-output="waterDurationMsOut"
                    />
                    <output id="waterDurationMsOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterOpacity">Opacity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterOpacity"
                      min="0.3"
                      max="1"
                      step="0.05"
                      data-path="effects.water.opacity"
                      data-output="waterOpacityOut"
                    />
                    <output id="waterOpacityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterFlowSpeed">Flow speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterFlowSpeed"
                      min="0.5"
                      max="2.5"
                      step="0.1"
                      data-path="effects.water.flowSpeed"
                      data-output="waterFlowSpeedOut"
                    />
                    <output id="waterFlowSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterDistortion">Distortion (wave intensity)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterDistortion"
                      min="0.01"
                      max="0.15"
                      step="0.01"
                      data-path="effects.water.distortion"
                      data-output="waterDistortionOut"
                    />
                    <output id="waterDistortionOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterSpecular">Specular (highlights)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterSpecular"
                      min="0"
                      max="1"
                      step="0.05"
                      data-path="effects.water.specular"
                      data-output="waterSpecularOut"
                    />
                    <output id="waterSpecularOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterCaustics">Caustics (light patterns)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterCaustics"
                      min="0"
                      max="0.5"
                      step="0.02"
                      data-path="effects.water.caustics"
                      data-output="waterCausticsOut"
                    />
                    <output id="waterCausticsOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterTiling">Detail scale (tiling)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterTiling"
                      min="1"
                      max="5"
                      step="0.2"
                      data-path="effects.water.tiling1"
                      data-output="waterTilingOut"
                    />
                    <output id="waterTilingOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterRotation">Flow angle (rotation)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterRotation"
                      min="-45"
                      max="45"
                      step="5"
                      data-path="effects.water.rotate1Deg"
                      data-output="waterRotationOut"
                    />
                    <output id="waterRotationOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterTint">Water tint color</label>
                  <input
                    type="color"
                    id="waterTint"
                    data-path="effects.water.tint"
                    value="#78b4dc"
                  />
                </div>
              </div>

              <!-- Spinning Rays Theme Controls -->
              <div
                class="theme-controls"
                id="spinningRaysThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="spinningRaysDurationMs">Duration (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysDurationMs"
                      min="2000"
                      max="30000"
                      step="250"
                      data-path="effects.spinningRays.durationMs"
                      data-output="spinningRaysDurationMsOut"
                    />
                    <output id="spinningRaysDurationMsOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysNumRays">Number of rays</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysNumRays"
                      min="1"
                      max="240"
                      step="1"
                      data-path="effects.spinningRays.numRays"
                      data-output="spinningRaysNumRaysOut"
                    />
                    <output id="spinningRaysNumRaysOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysTrailAlpha">Trail fade</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysTrailAlpha"
                      min="0.01"
                      max="0.6"
                      step="0.01"
                      data-path="effects.spinningRays.trailAlpha"
                      data-output="spinningRaysTrailAlphaOut"
                    />
                    <output id="spinningRaysTrailAlphaOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCenterMode">Center mode</label>
                  <select id="spinningRaysCenterMode" data-path="effects.spinningRays.centerMode">
                    <option value="center">Center</option>
                    <option value="random">Random</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                <div class="field">
                  <label for="spinningRaysCenterX">Center X (%)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCenterX"
                      min="0"
                      max="100"
                      step="1"
                      data-path="effects.spinningRays.centerXPercent"
                      data-output="spinningRaysCenterXOut"
                    />
                    <output id="spinningRaysCenterXOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCenterY">Center Y (%)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCenterY"
                      min="0"
                      max="100"
                      step="1"
                      data-path="effects.spinningRays.centerYPercent"
                      data-output="spinningRaysCenterYOut"
                    />
                    <output id="spinningRaysCenterYOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysHueSpeed">Hue speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysHueSpeed"
                      min="-8"
                      max="8"
                      step="0.25"
                      data-path="effects.spinningRays.hueSpeed"
                      data-output="spinningRaysHueSpeedOut"
                    />
                    <output id="spinningRaysHueSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysHueRange">Hue range</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysHueRange"
                      min="0"
                      max="240"
                      step="1"
                      data-path="effects.spinningRays.hueRange"
                      data-output="spinningRaysHueRangeOut"
                    />
                    <output id="spinningRaysHueRangeOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysSaturation">Saturation</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysSaturation"
                      min="0"
                      max="100"
                      step="1"
                      data-path="effects.spinningRays.saturation"
                      data-output="spinningRaysSaturationOut"
                    />
                    <output id="spinningRaysSaturationOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysLightness">Lightness</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysLightness"
                      min="0"
                      max="100"
                      step="1"
                      data-path="effects.spinningRays.lightness"
                      data-output="spinningRaysLightnessOut"
                    />
                    <output id="spinningRaysLightnessOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysGlowBlur">Glow blur</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysGlowBlur"
                      min="0"
                      max="120"
                      step="1"
                      data-path="effects.spinningRays.glowBlur"
                      data-output="spinningRaysGlowBlurOut"
                    />
                    <output id="spinningRaysGlowBlurOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysBaseLineWidth">Base line width</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysBaseLineWidth"
                      min="0"
                      max="12"
                      step="0.25"
                      data-path="effects.spinningRays.baseLineWidth"
                      data-output="spinningRaysBaseLineWidthOut"
                    />
                    <output id="spinningRaysBaseLineWidthOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysLineWidthFactor">Line width factor</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysLineWidthFactor"
                      min="1"
                      max="240"
                      step="1"
                      data-path="effects.spinningRays.lineWidthFactor"
                      data-output="spinningRaysLineWidthFactorOut"
                    />
                    <output id="spinningRaysLineWidthFactorOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysAngularVelMin">Angular vel min</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysAngularVelMin"
                      min="0"
                      max="0.01"
                      step="0.0001"
                      data-path="effects.spinningRays.angularVelMin"
                      data-output="spinningRaysAngularVelMinOut"
                    />
                    <output id="spinningRaysAngularVelMinOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysAngularVelMax">Angular vel max</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysAngularVelMax"
                      min="0"
                      max="0.02"
                      step="0.0001"
                      data-path="effects.spinningRays.angularVelMax"
                      data-output="spinningRaysAngularVelMaxOut"
                    />
                    <output id="spinningRaysAngularVelMaxOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysWaveAccel">Wave accel</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysWaveAccel"
                      min="0"
                      max="0.01"
                      step="0.0001"
                      data-path="effects.spinningRays.waveAccel"
                      data-output="spinningRaysWaveAccelOut"
                    />
                    <output id="spinningRaysWaveAccelOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysRadiantMax">Radiant max</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysRadiantMax"
                      min="0"
                      max="2"
                      step="0.01"
                      data-path="effects.spinningRays.radiantMax"
                      data-output="spinningRaysRadiantMaxOut"
                    />
                    <output id="spinningRaysRadiantMaxOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCircleMax">Circle max count</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCircleMax"
                      min="8"
                      max="200"
                      step="1"
                      data-path="effects.spinningRays.circleMaxCount"
                      data-output="spinningRaysCircleMaxOut"
                    />
                    <output id="spinningRaysCircleMaxOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCircleRadiusFactor">Circle radius factor</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCircleRadiusFactor"
                      min="0.25"
                      max="6"
                      step="0.05"
                      data-path="effects.spinningRays.circleRadiusFactor"
                      data-output="spinningRaysCircleRadiusFactorOut"
                    />
                    <output id="spinningRaysCircleRadiusFactorOut"></output>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sine Waves Theme Controls -->
            <div
              class="theme-controls"
              id="sineWavesThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="field">
                <label for="sineWavesDuration">Duration (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesDuration"
                    min="800"
                    max="30000"
                    step="100"
                    data-path="effects.sineWaves.durationMs"
                    data-output="sineWavesDurationOut"
                  />
                  <output id="sineWavesDurationOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesSpeed">Speed</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesSpeed"
                    min="-20"
                    max="20"
                    step="0.25"
                    data-path="effects.sineWaves.speed"
                    data-output="sineWavesSpeedOut"
                  />
                  <output id="sineWavesSpeedOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesCenterY">Center Y (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesCenterY"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.sineWaves.centerYPercent"
                    data-output="sineWavesCenterYOut"
                  />
                  <output id="sineWavesCenterYOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWaveWidth">Wave width (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWaveWidth"
                    min="10"
                    max="100"
                    step="1"
                    data-path="effects.sineWaves.waveWidthPercent"
                    data-output="sineWavesWaveWidthOut"
                  />
                  <output id="sineWavesWaveWidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWaveLeft">Wave left (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWaveLeft"
                    min="0"
                    max="45"
                    step="0.5"
                    data-path="effects.sineWaves.waveLeftPercent"
                    data-output="sineWavesWaveLeftOut"
                  />
                  <output id="sineWavesWaveLeftOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesClearMode">Clear mode</label>
                <select id="sineWavesClearMode" data-path="effects.sineWaves.clearMode">
                  <option value="clear">Clear (no trails)</option>
                  <option value="trails">Trails</option>
                </select>
              </div>
              <div class="field">
                <label for="sineWavesTrailAlpha">Trail alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesTrailAlpha"
                    min="0.01"
                    max="0.6"
                    step="0.01"
                    data-path="effects.sineWaves.trailAlpha"
                    data-output="sineWavesTrailAlphaOut"
                  />
                  <output id="sineWavesTrailAlphaOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesSegDefault">Default segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesSegDefault"
                    min="1"
                    max="60"
                    step="1"
                    data-path="effects.sineWaves.segmentLengthDefault"
                    data-output="sineWavesSegDefaultOut"
                  />
                  <output id="sineWavesSegDefaultOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesComposite">Blend</label>
                <select id="sineWavesComposite" data-path="effects.sineWaves.compositeOperation">
                  <option value="lighter">Glow (lighter)</option>
                  <option value="source-over">Normal</option>
                </select>
              </div>
              <div class="field">
                <label for="sineWavesColorMode">Color mode</label>
                <select id="sineWavesColorMode" data-path="effects.sineWaves.colorMode">
                  <option value="gradient">Gradient</option>
                  <option value="solid">Solid</option>
                </select>
              </div>
              <div class="field">
                <label for="sineWavesStrokeColor">Solid stroke color (CSS)</label>
                <input
                  type="text"
                  id="sineWavesStrokeColor"
                  data-path="effects.sineWaves.strokeColor"
                />
              </div>
              <div class="field">
                <label for="sineWavesGradHue">Gradient hue</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradHue"
                    min="0"
                    max="360"
                    step="1"
                    data-path="effects.sineWaves.gradientHue"
                    data-output="sineWavesGradHueOut"
                  />
                  <output id="sineWavesGradHueOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradSat">Gradient saturation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradSat"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.sineWaves.gradientSaturation"
                    data-output="sineWavesGradSatOut"
                  />
                  <output id="sineWavesGradSatOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradLight">Gradient lightness</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradLight"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.sineWaves.gradientLightness"
                    data-output="sineWavesGradLightOut"
                  />
                  <output id="sineWavesGradLightOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradStartA">Gradient start alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradStartA"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="effects.sineWaves.gradientStartAlpha"
                    data-output="sineWavesGradStartAOut"
                  />
                  <output id="sineWavesGradStartAOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradMidA">Gradient mid alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradMidA"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="effects.sineWaves.gradientMidAlpha"
                    data-output="sineWavesGradMidAOut"
                  />
                  <output id="sineWavesGradMidAOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradEndA">Gradient end alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradEndA"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="effects.sineWaves.gradientEndAlpha"
                    data-output="sineWavesGradEndAOut"
                  />
                  <output id="sineWavesGradEndAOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Waves</div>
              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave1Enabled"
                    data-path="effects.sineWaves.wave1Enabled"
                  />
                  <span>Wave 1 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave1Amp">Wave 1 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="effects.sineWaves.wave1Amplitude"
                    data-output="sineWavesWave1AmpOut"
                  />
                  <output id="sineWavesWave1AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Wavelength">Wave 1 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="effects.sineWaves.wave1Wavelength"
                    data-output="sineWavesWave1WavelengthOut"
                  />
                  <output id="sineWavesWave1WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Width">Wave 1 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="effects.sineWaves.wave1LineWidth"
                    data-output="sineWavesWave1WidthOut"
                  />
                  <output id="sineWavesWave1WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Seg">Wave 1 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="effects.sineWaves.wave1SegmentLength"
                    data-output="sineWavesWave1SegOut"
                  />
                  <output id="sineWavesWave1SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Time">Wave 1 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="effects.sineWaves.wave1TimeModifier"
                    data-output="sineWavesWave1TimeOut"
                  />
                  <output id="sineWavesWave1TimeOut"></output>
                </div>
              </div>

              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave2Enabled"
                    data-path="effects.sineWaves.wave2Enabled"
                  />
                  <span>Wave 2 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave2Amp">Wave 2 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="effects.sineWaves.wave2Amplitude"
                    data-output="sineWavesWave2AmpOut"
                  />
                  <output id="sineWavesWave2AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Wavelength">Wave 2 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="effects.sineWaves.wave2Wavelength"
                    data-output="sineWavesWave2WavelengthOut"
                  />
                  <output id="sineWavesWave2WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Width">Wave 2 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="effects.sineWaves.wave2LineWidth"
                    data-output="sineWavesWave2WidthOut"
                  />
                  <output id="sineWavesWave2WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Seg">Wave 2 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="effects.sineWaves.wave2SegmentLength"
                    data-output="sineWavesWave2SegOut"
                  />
                  <output id="sineWavesWave2SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Time">Wave 2 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="effects.sineWaves.wave2TimeModifier"
                    data-output="sineWavesWave2TimeOut"
                  />
                  <output id="sineWavesWave2TimeOut"></output>
                </div>
              </div>

              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave3Enabled"
                    data-path="effects.sineWaves.wave3Enabled"
                  />
                  <span>Wave 3 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave3Amp">Wave 3 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="effects.sineWaves.wave3Amplitude"
                    data-output="sineWavesWave3AmpOut"
                  />
                  <output id="sineWavesWave3AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Wavelength">Wave 3 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="effects.sineWaves.wave3Wavelength"
                    data-output="sineWavesWave3WavelengthOut"
                  />
                  <output id="sineWavesWave3WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Width">Wave 3 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="effects.sineWaves.wave3LineWidth"
                    data-output="sineWavesWave3WidthOut"
                  />
                  <output id="sineWavesWave3WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Seg">Wave 3 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="effects.sineWaves.wave3SegmentLength"
                    data-output="sineWavesWave3SegOut"
                  />
                  <output id="sineWavesWave3SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Time">Wave 3 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="effects.sineWaves.wave3TimeModifier"
                    data-output="sineWavesWave3TimeOut"
                  />
                  <output id="sineWavesWave3TimeOut"></output>
                </div>
              </div>

              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave4Enabled"
                    data-path="effects.sineWaves.wave4Enabled"
                  />
                  <span>Wave 4 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave4Amp">Wave 4 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="effects.sineWaves.wave4Amplitude"
                    data-output="sineWavesWave4AmpOut"
                  />
                  <output id="sineWavesWave4AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Wavelength">Wave 4 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="effects.sineWaves.wave4Wavelength"
                    data-output="sineWavesWave4WavelengthOut"
                  />
                  <output id="sineWavesWave4WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Width">Wave 4 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="effects.sineWaves.wave4LineWidth"
                    data-output="sineWavesWave4WidthOut"
                  />
                  <output id="sineWavesWave4WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Seg">Wave 4 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="effects.sineWaves.wave4SegmentLength"
                    data-output="sineWavesWave4SegOut"
                  />
                  <output id="sineWavesWave4SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Time">Wave 4 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="effects.sineWaves.wave4TimeModifier"
                    data-output="sineWavesWave4TimeOut"
                  />
                  <output id="sineWavesWave4TimeOut"></output>
                </div>
              </div>
            </div>

            <!-- Flowers Theme Controls -->
            <div
              class="theme-controls"
              id="flowersThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="subhead" style="margin-bottom: 10px">Flowers</div>

              <div class="field">
                <label for="flowersStyle">Petal style</label>
                <select id="flowersStyle" data-path="effects.flowers.style">
                  <option value="ellipse">Ellipse</option>
                  <option value="path">Path</option>
                  <option value="rounded">Rounded</option>
                  <option value="random">Random mix</option>
                </select>
              </div>

              <div class="field">
                <label for="flowersSpawnMode">Spawn mode</label>
                <select id="flowersSpawnMode" data-path="effects.flowers.spawnMode">
                  <option value="random">Random</option>
                  <option value="bottomBand">Bottom band</option>
                  <option value="custom">Custom cluster</option>
                </select>
              </div>

              <div class="field">
                <label for="flowersSpawnRate">Spawn rate (per sec)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSpawnRate"
                    min="0"
                    max="5"
                    step="0.05"
                    data-path="effects.flowers.spawnRatePerSec"
                    data-output="flowersSpawnRateOut"
                  />
                  <output id="flowersSpawnRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersInitialBurst">Initial burst</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersInitialBurst"
                    min="0"
                    max="20"
                    step="1"
                    data-path="effects.flowers.initialBurst"
                    data-output="flowersInitialBurstOut"
                  />
                  <output id="flowersInitialBurstOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersMax">Max flowers</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersMax"
                    min="0"
                    max="200"
                    step="1"
                    data-path="effects.flowers.maxFlowers"
                    data-output="flowersMaxOut"
                  />
                  <output id="flowersMaxOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Placement</div>

              <div class="field">
                <label for="flowersXPad">X padding (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersXPad"
                    min="0"
                    max="45"
                    step="0.5"
                    data-path="effects.flowers.xPaddingPercent"
                    data-output="flowersXPadOut"
                  />
                  <output id="flowersXPadOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersYMin">Y min (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersYMin"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.yMinPercent"
                    data-output="flowersYMinOut"
                  />
                  <output id="flowersYMinOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersYMax">Y max (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersYMax"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.yMaxPercent"
                    data-output="flowersYMaxOut"
                  />
                  <output id="flowersYMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCustomX">Custom X (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCustomX"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.customXPercent"
                    data-output="flowersCustomXOut"
                  />
                  <output id="flowersCustomXOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCustomY">Custom Y (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCustomY"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.customYPercent"
                    data-output="flowersCustomYOut"
                  />
                  <output id="flowersCustomYOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersSpreadX">Spread X (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSpreadX"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.spreadXPercent"
                    data-output="flowersSpreadXOut"
                  />
                  <output id="flowersSpreadXOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersSpreadY">Spread Y (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSpreadY"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.spreadYPercent"
                    data-output="flowersSpreadYOut"
                  />
                  <output id="flowersSpreadYOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Lifecycle</div>

              <div class="field">
                <label for="flowersBloomMs">Bloom duration (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBloomMs"
                    min="200"
                    max="6000"
                    step="50"
                    data-path="effects.flowers.bloomDurationMs"
                    data-output="flowersBloomMsOut"
                  />
                  <output id="flowersBloomMsOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersLifeMs">Life (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersLifeMs"
                    min="0"
                    max="60000"
                    step="250"
                    data-path="effects.flowers.lifeMs"
                    data-output="flowersLifeMsOut"
                  />
                  <output id="flowersLifeMsOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersFadeMs">Fade out (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersFadeMs"
                    min="0"
                    max="10000"
                    step="50"
                    data-path="effects.flowers.fadeOutMs"
                    data-output="flowersFadeMsOut"
                  />
                  <output id="flowersFadeMsOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Geometry</div>

              <div class="field">
                <label for="flowersSizeMin">Size min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSizeMin"
                    min="5"
                    max="200"
                    step="1"
                    data-path="effects.flowers.sizeMin"
                    data-output="flowersSizeMinOut"
                  />
                  <output id="flowersSizeMinOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="flowersSizeMax">Size max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSizeMax"
                    min="5"
                    max="300"
                    step="1"
                    data-path="effects.flowers.sizeMax"
                    data-output="flowersSizeMaxOut"
                  />
                  <output id="flowersSizeMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersWobbleAmp">Sway amplitude (deg)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersWobbleAmp"
                    min="0"
                    max="20"
                    step="0.25"
                    data-path="effects.flowers.wobbleAmpPx"
                    data-output="flowersWobbleAmpOut"
                  />
                  <output id="flowersWobbleAmpOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersWobbleFreq">Sway speed</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersWobbleFreq"
                    min="0"
                    max="30"
                    step="0.5"
                    data-path="effects.flowers.wobbleFreq"
                    data-output="flowersWobbleFreqOut"
                  />
                  <output id="flowersWobbleFreqOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Petals</div>

              <div class="field">
                <label for="flowersPetalMin">Petal count min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalMin"
                    min="1"
                    max="24"
                    step="1"
                    data-path="effects.flowers.petalCountMin"
                    data-output="flowersPetalMinOut"
                  />
                  <output id="flowersPetalMinOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="flowersPetalMax">Petal count max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalMax"
                    min="1"
                    max="24"
                    step="1"
                    data-path="effects.flowers.petalCountMax"
                    data-output="flowersPetalMaxOut"
                  />
                  <output id="flowersPetalMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersBackPetalMin">Back petal count min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBackPetalMin"
                    min="1"
                    max="24"
                    step="1"
                    data-path="effects.flowers.backPetalCountMin"
                    data-output="flowersBackPetalMinOut"
                  />
                  <output id="flowersBackPetalMinOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="flowersBackPetalMax">Back petal count max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBackPetalMax"
                    min="1"
                    max="24"
                    step="1"
                    data-path="effects.flowers.backPetalCountMax"
                    data-output="flowersBackPetalMaxOut"
                  />
                  <output id="flowersBackPetalMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersBackScale">Back scale</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBackScale"
                    min="0.2"
                    max="3"
                    step="0.05"
                    data-path="effects.flowers.backScale"
                    data-output="flowersBackScaleOut"
                  />
                  <output id="flowersBackScaleOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersFrontScale">Front scale</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersFrontScale"
                    min="0.2"
                    max="3"
                    step="0.05"
                    data-path="effects.flowers.frontScale"
                    data-output="flowersFrontScaleOut"
                  />
                  <output id="flowersFrontScaleOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Palette</div>

              <div class="field">
                <label for="flowersPaletteMode">Palette mode</label>
                <select id="flowersPaletteMode" data-path="effects.flowers.paletteMode">
                  <option value="magenta">Magenta</option>
                  <option value="randomHsl">Random HSL</option>
                  <option value="custom">Custom</option>
                </select>
              </div>

              <div class="field">
                <label for="flowersPetalHue">Petal hue</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalHue"
                    min="0"
                    max="360"
                    step="1"
                    data-path="effects.flowers.petalHue"
                    data-output="flowersPetalHueOut"
                  />
                  <output id="flowersPetalHueOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalHueVar">Petal hue variance</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalHueVar"
                    min="0"
                    max="180"
                    step="1"
                    data-path="effects.flowers.petalHueVariance"
                    data-output="flowersPetalHueVarOut"
                  />
                  <output id="flowersPetalHueVarOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalSat">Petal saturation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalSat"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.petalSaturation"
                    data-output="flowersPetalSatOut"
                  />
                  <output id="flowersPetalSatOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalLight">Petal lightness</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalLight"
                    min="0"
                    max="100"
                    step="1"
                    data-path="effects.flowers.petalLightness"
                    data-output="flowersPetalLightOut"
                  />
                  <output id="flowersPetalLightOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalAlpha">Petal alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalAlpha"
                    min="0"
                    max="1"
                    step="0.01"
                    data-path="effects.flowers.petalAlpha"
                    data-output="flowersPetalAlphaOut"
                  />
                  <output id="flowersPetalAlphaOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Glow</div>

              <div class="field">
                <label for="flowersPetalGlowFront">Petal glow (front)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalGlowFront"
                    min="0"
                    max="120"
                    step="1"
                    data-path="effects.flowers.petalGlowBlurFront"
                    data-output="flowersPetalGlowFrontOut"
                  />
                  <output id="flowersPetalGlowFrontOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalGlowBack">Petal glow (back)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalGlowBack"
                    min="0"
                    max="80"
                    step="1"
                    data-path="effects.flowers.petalGlowBlurBack"
                    data-output="flowersPetalGlowBackOut"
                  />
                  <output id="flowersPetalGlowBackOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCenterGlow">Center glow blur</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCenterGlow"
                    min="0"
                    max="120"
                    step="1"
                    data-path="effects.flowers.centerGlowBlur"
                    data-output="flowersCenterGlowOut"
                  />
                  <output id="flowersCenterGlowOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalHighlight">Petal highlight alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalHighlight"
                    min="0"
                    max="1"
                    step="0.01"
                    data-path="effects.flowers.petalHighlightAlpha"
                    data-output="flowersPetalHighlightOut"
                  />
                  <output id="flowersPetalHighlightOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCenterHighlight">Center highlight alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCenterHighlight"
                    min="0"
                    max="1"
                    step="0.01"
                    data-path="effects.flowers.centerHighlightAlpha"
                    data-output="flowersCenterHighlightOut"
                  />
                  <output id="flowersCenterHighlightOut"></output>
                </div>
              </div>
            </div>

            <!-- Balloons Controls (migrated to OneShot) -->
            <div
              class="theme-controls"
              id="balloonsThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="subhead" style="margin-bottom: 10px">Balloons</div>

              <div class="field">
                <label for="balloonsDurationMs">Duration (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsDurationMs"
                    min="2000"
                    max="30000"
                    step="500"
                    data-path="effects.balloons.durationMs"
                    data-output="balloonsDurationMsOut"
                  />
                  <output id="balloonsDurationMsOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsDirection">Direction</label>
                <select id="balloonsDirection" data-path="effects.balloons.direction">
                  <option value="bottom">Up</option>
                  <option value="top">Down</option>
                  <option value="left">Right</option>
                  <option value="right">Left</option>
                  <option value="diagonal">Diagonal</option>
                  <option value="mixed">Mixed</option>
                </select>
              </div>

              <div class="field">
                <label for="balloonsColorMode">Color mode</label>
                <select id="balloonsColorMode" data-path="effects.balloons.colorMode">
                  <option value="single">Single</option>
                  <option value="dual">Dual</option>
                  <option value="rainbow">Rainbow</option>
                  <option value="custom">Custom color</option>
                </select>
              </div>

              <div class="field">
                <label for="balloonsCustomColorHex">Custom color</label>
                <input
                  type="color"
                  id="balloonsCustomColorHex"
                  value="#4fc3f7"
                  data-path="effects.balloons.customColorHex"
                />
              </div>

              <div class="field">
                <label for="balloonsMinSize">Size min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsMinSize"
                    min="10"
                    max="120"
                    step="1"
                    data-path="effects.balloons.minSize"
                    data-output="balloonsMinSizeOut"
                  />
                  <output id="balloonsMinSizeOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsMaxSize">Size max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsMaxSize"
                    min="20"
                    max="200"
                    step="1"
                    data-path="effects.balloons.maxSize"
                    data-output="balloonsMaxSizeOut"
                  />
                  <output id="balloonsMaxSizeOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsMinSpeed">Speed min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsMinSpeed"
                    min="0.2"
                    max="8"
                    step="0.1"
                    data-path="effects.balloons.minSpeed"
                    data-output="balloonsMinSpeedOut"
                  />
                  <output id="balloonsMinSpeedOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsMaxSpeed">Speed max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsMaxSpeed"
                    min="0.5"
                    max="15"
                    step="0.1"
                    data-path="effects.balloons.maxSpeed"
                    data-output="balloonsMaxSpeedOut"
                  />
                  <output id="balloonsMaxSpeedOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsSpawnRate">Spawn interval (frames)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsSpawnRate"
                    min="1"
                    max="120"
                    step="1"
                    data-path="effects.balloons.spawnRate"
                    data-output="balloonsSpawnRateOut"
                  />
                  <output id="balloonsSpawnRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsMaxBalloons">Max balloons</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsMaxBalloons"
                    min="1"
                    max="120"
                    step="1"
                    data-path="effects.balloons.maxBalloons"
                    data-output="balloonsMaxBalloonsOut"
                  />
                  <output id="balloonsMaxBalloonsOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsWaveAmplitude">Wave amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsWaveAmplitude"
                    min="0"
                    max="200"
                    step="1"
                    data-path="effects.balloons.waveAmplitude"
                    data-output="balloonsWaveAmplitudeOut"
                  />
                  <output id="balloonsWaveAmplitudeOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsWaveFrequency">Wave frequency</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsWaveFrequency"
                    min="1"
                    max="100"
                    step="1"
                    data-path="effects.balloons.waveFrequency"
                    data-output="balloonsWaveFrequencyOut"
                  />
                  <output id="balloonsWaveFrequencyOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsStringLength">String length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsStringLength"
                    min="1"
                    max="10"
                    step="0.1"
                    data-path="effects.balloons.stringLength"
                    data-output="balloonsStringLengthOut"
                  />
                  <output id="balloonsStringLengthOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsHeightRatio">Height ratio</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="balloonsHeightRatio"
                    min="1"
                    max="2"
                    step="0.05"
                    data-path="effects.balloons.heightRatio"
                    data-output="balloonsHeightRatioOut"
                  />
                  <output id="balloonsHeightRatioOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="balloonsStringColor">String color</label>
                <input
                  type="color"
                  id="balloonsStringColor"
                  data-path="effects.balloons.stringColor"
                />
              </div>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="balloonsShowStrings"
                  data-path="effects.balloons.showStrings"
                />
                <span>Show strings</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="balloonsShowGradient"
                  data-path="effects.balloons.showGradient"
                />
                <span>Color gradients</span>
              </label>

              <label class="toggle">
                <input type="checkbox" id="balloonsAnimate" data-path="effects.balloons.animate" />
                <span>Animate</span>
              </label>
            </div>

            <!-- Falling Stars Theme Controls (migrated to OneShot; legacy kept for reference)
            <div
              class="theme-controls"
              id="fallingStarsThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="subhead" style="margin-bottom: 10px">Falling Stars</div>

              <div class="field">
                <label for="fallingStarsTheme">Color theme</label>
                <select id="fallingStarsTheme" data-path="themes.fallingStars.theme">
                  <option value="blue">Blue</option>
                  <option value="purple">Purple</option>
                  <option value="red">Red</option>
                  <option value="orange">Orange</option>
                  <option value="mix">Mixed</option>
                </select>
              </div>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsUseCustomColor"
                  data-path="themes.fallingStars.useCustomColor"
                />
                <span>Use custom color</span>
              </label>

              <div class="field">
                <label for="fallingStarsCustomColorHex">Custom color</label>
                <input
                  type="color"
                  id="fallingStarsCustomColorHex"
                  data-path="themes.fallingStars.customColorHex"
                />
              </div>

              <div class="field">
                <label for="fallingStarsSpawnMode">Spawn mode</label>
                <select id="fallingStarsSpawnMode" data-path="themes.fallingStars.spawnMode">
                  <option value="rain">Rain (from top)</option>
                  <option value="mouse">Mouse trail</option>
                  <option value="both">Both</option>
                </select>
              </div>

              <div class="field">
                <label for="fallingStarsSpawnRate">Spawn rate (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsSpawnRate"
                    min="5"
                    max="100"
                    step="1"
                    data-path="themes.fallingStars.spawnRate"
                    data-output="fallingStarsSpawnRateOut"
                  />
                  <output id="fallingStarsSpawnRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsMaxParticles">Max particles</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsMaxParticles"
                    min="30"
                    max="600"
                    step="10"
                    data-path="themes.fallingStars.maxParticles"
                    data-output="fallingStarsMaxParticlesOut"
                  />
                  <output id="fallingStarsMaxParticlesOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsBaseSize">Base star size</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsBaseSize"
                    min="5"
                    max="50"
                    step="1"
                    data-path="themes.fallingStars.baseSize"
                    data-output="fallingStarsBaseSizeOut"
                  />
                  <output id="fallingStarsBaseSizeOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsSizeVariation">Size variation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsSizeVariation"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="themes.fallingStars.sizeVariation"
                    data-output="fallingStarsSizeVariationOut"
                  />
                  <output id="fallingStarsSizeVariationOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Physics</div>

              <div class="field">
                <label for="fallingStarsGravity">Gravity</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsGravity"
                    min="0"
                    max="0.05"
                    step="0.001"
                    data-path="themes.fallingStars.gravity"
                    data-output="fallingStarsGravityOut"
                  />
                  <output id="fallingStarsGravityOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsMaxVelocity">Max velocity</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsMaxVelocity"
                    min="1"
                    max="20"
                    step="0.5"
                    data-path="themes.fallingStars.maxVelocity"
                    data-output="fallingStarsMaxVelocityOut"
                  />
                  <output id="fallingStarsMaxVelocityOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsVelocityVariation">Velocity variation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsVelocityVariation"
                    min="0"
                    max="10"
                    step="0.5"
                    data-path="themes.fallingStars.velocityVariation"
                    data-output="fallingStarsVelocityVariationOut"
                  />
                  <output id="fallingStarsVelocityVariationOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsRotationSpeed">Rotation speed</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsRotationSpeed"
                    min="0"
                    max="0.5"
                    step="0.01"
                    data-path="themes.fallingStars.rotationSpeed"
                    data-output="fallingStarsRotationSpeedOut"
                  />
                  <output id="fallingStarsRotationSpeedOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Animation</div>

              <div class="field">
                <label for="fallingStarsFadeStartPercent">Fade/shrink start (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsFadeStartPercent"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.fallingStars.fadeStartPercent"
                    data-output="fallingStarsFadeStartPercentOut"
                  />
                  <output id="fallingStarsFadeStartPercentOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsShrinkRate">Shrink rate</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsShrinkRate"
                    min="0"
                    max="0.1"
                    step="0.005"
                    data-path="themes.fallingStars.shrinkRate"
                    data-output="fallingStarsShrinkRateOut"
                  />
                  <output id="fallingStarsShrinkRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsFadeRate">Fade rate</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsFadeRate"
                    min="0"
                    max="0.1"
                    step="0.005"
                    data-path="themes.fallingStars.fadeRate"
                    data-output="fallingStarsFadeRateOut"
                  />
                  <output id="fallingStarsFadeRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsShadowBlur">Glow intensity</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsShadowBlur"
                    min="0"
                    max="50"
                    step="1"
                    data-path="themes.fallingStars.shadowBlur"
                    data-output="fallingStarsShadowBlurOut"
                  />
                  <output id="fallingStarsShadowBlurOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Interaction</div>

              <div class="field">
                <label for="fallingStarsMouseRandomness">Mouse jitter</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsMouseRandomness"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.fallingStars.mouseRandomness"
                    data-output="fallingStarsMouseRandomnessOut"
                  />
                  <output id="fallingStarsMouseRandomnessOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsExplosionSize">Explosion size (stars per click)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsExplosionSize"
                    min="10"
                    max="200"
                    step="5"
                    data-path="themes.fallingStars.explosionSize"
                    data-output="fallingStarsExplosionSizeOut"
                  />
                  <output id="fallingStarsExplosionSizeOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Options</div>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsMouseTrail"
                  data-path="themes.fallingStars.mouseTrail"
                />
                <span>Mouse trail enabled</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsClickExplosion"
                  data-path="themes.fallingStars.clickExplosion"
                />
                <span>Click explosion enabled</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsScreenBlend"
                  data-path="themes.fallingStars.screenBlend"
                />
                <span>Screen blend mode</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsReverse"
                  data-path="themes.fallingStars.reverse"
                />
                <span>Reverse (float up)</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsCircleClip"
                  data-path="themes.fallingStars.useCircleClip"
                />
                <span>Circle clip</span>
              </label>
            </div>
            -->

            <!-- Effect Settings - shown when effect selected -->
            <div class="subsection" id="effectSettingsSection" style="display: none">
              <div class="subhead">Effect Tuning</div>
              <p class="panel-note" id="settingsHint">
                Adjusting settings for the selected effect.
              </p>
              <div class="settings-empty" id="settingsEmpty" style="display: none">
                No adjustable settings for this effect.
              </div>

              <!-- Halloween Effect Controls (migrated from Themes) -->
              <div
                class="theme-controls"
                id="halloweenThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="halloweenDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenDurationMs"
                        min="2000"
                        max="20000"
                        step="250"
                        data-path="effects.halloween.durationMs"
                        data-output="halloweenDurationMsOut"
                      />
                      <output id="halloweenDurationMsOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="halloweenStyle">Style</label>
                    <select id="halloweenStyle" data-path="effects.halloween.style">
                      <option value="spiders">Spiders (web drop)</option>
                      <option value="emoji">Emoji rain</option>
                      <option value="mixed">Mixed</option>
                      <option value="embers">Embers (legacy)</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="halloweenDirection">Wind direction</label>
                    <select id="halloweenDirection" data-path="effects.halloween.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="halloweenWindStrength">Wind strength</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenWindStrength"
                        min="0"
                        max="220"
                        step="5"
                        data-path="effects.halloween.windStrength"
                        data-output="halloweenWindStrengthOut"
                      />
                      <output id="halloweenWindStrengthOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostCount">Ghost quantity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostCount"
                        min="0"
                        max="12"
                        step="1"
                        data-path="effects.halloween.ghostCount"
                        data-output="halloweenGhostCountOut"
                      />
                      <output id="halloweenGhostCountOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostDirection">Ghost direction</label>
                    <select
                      id="halloweenGhostDirection"
                      data-path="effects.halloween.ghostDirection"
                    >
                      <option value="mixed">Mixed</option>
                      <option value="leftToRight">Left  Right</option>
                      <option value="rightToLeft">Right  Left</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostRandomness">Ghost randomness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostRandomness"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.halloween.ghostRandomness"
                        data-output="halloweenGhostRandomnessOut"
                      />
                      <output id="halloweenGhostRandomnessOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenDrift">Sway amount</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenDrift"
                        min="0"
                        max="80"
                        step="1"
                        data-path="effects.halloween.drift"
                        data-output="halloweenDriftOut"
                      />
                      <output id="halloweenDriftOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSpeedMin"
                        min="5"
                        max="240"
                        step="1"
                        data-path="effects.halloween.speedMin"
                        data-output="halloweenSpeedMinOut"
                      />
                      <output id="halloweenSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSpeedMax"
                        min="10"
                        max="320"
                        step="1"
                        data-path="effects.halloween.speedMax"
                        data-output="halloweenSpeedMaxOut"
                      />
                      <output id="halloweenSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSizeMin"
                        min="10"
                        max="60"
                        step="1"
                        data-path="effects.halloween.sizeMin"
                        data-output="halloweenSizeMinOut"
                      />
                      <output id="halloweenSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSizeMax"
                        min="12"
                        max="80"
                        step="1"
                        data-path="effects.halloween.sizeMax"
                        data-output="halloweenSizeMaxOut"
                      />
                      <output id="halloweenSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostSizeMin">Ghost size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostSizeMin"
                        min="40"
                        max="220"
                        step="2"
                        data-path="effects.halloween.ghostSizeMin"
                        data-output="halloweenGhostSizeMinOut"
                      />
                      <output id="halloweenGhostSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostSizeMax">Ghost size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostSizeMax"
                        min="50"
                        max="280"
                        step="2"
                        data-path="effects.halloween.ghostSizeMax"
                        data-output="halloweenGhostSizeMaxOut"
                      />
                      <output id="halloweenGhostSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenEmissionRate">Density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenEmissionRate"
                        min="2"
                        max="40"
                        step="1"
                        data-path="effects.halloween.emissionRate"
                        data-output="halloweenEmissionRateOut"
                      />
                      <output id="halloweenEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenMaxParticles">Max items</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenMaxParticles"
                        min="30"
                        max="400"
                        step="10"
                        data-path="effects.halloween.maxParticles"
                        data-output="halloweenMaxParticlesOut"
                      />
                      <output id="halloweenMaxParticlesOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenStringLenMin">Web length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenStringLenMin"
                        min="40"
                        max="800"
                        step="10"
                        data-path="effects.halloween.stringLenMin"
                        data-output="halloweenStringLenMinOut"
                      />
                      <output id="halloweenStringLenMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenStringLenMax">Web length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenStringLenMax"
                        min="60"
                        max="900"
                        step="10"
                        data-path="effects.halloween.stringLenMax"
                        data-output="halloweenStringLenMaxOut"
                      />
                      <output id="halloweenStringLenMaxOut"></output>
                    </div>
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  No external images needed (spiders + ghosts are CSS/SVG overlays).
                </p>
              </div>

              <!-- Christmas Lights Effect Controls (migrated from Themes) -->
              <div
                class="theme-controls"
                id="christmasLightsThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="christmasLightsDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsDurationMs"
                        min="2000"
                        max="30000"
                        step="250"
                        data-path="effects.christmasLights.durationMs"
                        data-output="christmasLightsDurationMsOut"
                      />
                      <output id="christmasLightsDurationMsOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsLightCount">Light count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsLightCount"
                        min="0"
                        max="120"
                        step="1"
                        data-path="effects.christmasLights.lightCount"
                        data-output="christmasLightsLightCountOut"
                      />
                      <output id="christmasLightsLightCountOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsStarsCount">Stars count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsStarsCount"
                        min="0"
                        max="300"
                        step="1"
                        data-path="effects.christmasLights.starsCount"
                        data-output="christmasLightsStarsCountOut"
                      />
                      <output id="christmasLightsStarsCountOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsBokehCount">Bokeh count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsBokehCount"
                        min="0"
                        max="60"
                        step="1"
                        data-path="effects.christmasLights.bokehCount"
                        data-output="christmasLightsBokehCountOut"
                      />
                      <output id="christmasLightsBokehCountOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsSnowflakeCount">Snowflake count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsSnowflakeCount"
                        min="0"
                        max="500"
                        step="1"
                        data-path="effects.christmasLights.snowflakeCount"
                        data-output="christmasLightsSnowflakeCountOut"
                      />
                      <output id="christmasLightsSnowflakeCountOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsSnowColorHex">Snow color</label>
                    <input
                      type="color"
                      id="christmasLightsSnowColorHex"
                      data-path="effects.christmasLights.snowColorHex"
                    />
                  </div>

                  <div class="field">
                    <label for="christmasLightsBokehColorMode">Bokeh color mode</label>
                    <select
                      id="christmasLightsBokehColorMode"
                      data-path="effects.christmasLights.bokehColorMode"
                    >
                      <option value="palette">Palette</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="christmasLightsBokehColorHex">Bokeh color</label>
                    <input
                      type="color"
                      id="christmasLightsBokehColorHex"
                      data-path="effects.christmasLights.bokehColorHex"
                    />
                  </div>

                  <div class="field">
                    <label for="christmasLightsBokehOpacity">Bokeh opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsBokehOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.christmasLights.bokehOpacity"
                        data-output="christmasLightsBokehOpacityOut"
                      />
                      <output id="christmasLightsBokehOpacityOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsSnowAccumulateHeight">Snow pile height (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsSnowAccumulateHeight"
                        min="0"
                        max="320"
                        step="5"
                        data-path="effects.christmasLights.snowAccumulateHeight"
                        data-output="christmasLightsSnowAccumulateHeightOut"
                      />
                      <output id="christmasLightsSnowAccumulateHeightOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="christmasLightsSnowAccumulateSec">Snow pile duration (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="christmasLightsSnowAccumulateSec"
                        min="5"
                        max="180"
                        step="1"
                        data-path="effects.christmasLights.snowAccumulateSec"
                        data-output="christmasLightsSnowAccumulateSecOut"
                      />
                      <output id="christmasLightsSnowAccumulateSecOut"></output>
                    </div>
                  </div>

                  <label class="toggle" style="min-width: 200px">
                    <input type="checkbox" data-path="effects.christmasLights.showStars" />
                    <span>Stars enabled</span>
                  </label>
                  <label class="toggle" style="min-width: 200px">
                    <input type="checkbox" data-path="effects.christmasLights.showBokeh" />
                    <span>Bokeh enabled</span>
                  </label>
                  <label class="toggle" style="min-width: 200px">
                    <input type="checkbox" data-path="effects.christmasLights.showLights" />
                    <span>Rope lights enabled</span>
                  </label>
                  <label class="toggle" style="min-width: 200px">
                    <input type="checkbox" data-path="effects.christmasLights.showSnow" />
                    <span>Snow enabled</span>
                  </label>
                  <label class="toggle" style="min-width: 200px">
                    <input type="checkbox" data-path="effects.christmasLights.showSnowGround" />
                    <span>Snow pile enabled</span>
                  </label>
                </div>
              </div>

              <!-- Easter Effect Controls (migrated from Themes) -->
              <div
                class="theme-controls"
                id="easterThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="easterDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterDurationMs"
                        min="2000"
                        max="30000"
                        step="250"
                        data-path="effects.easter.durationMs"
                        data-output="easterDurationMsOut"
                      />
                      <output id="easterDurationMsOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterEmissionRate">Density (particles/sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterEmissionRate"
                        min="1"
                        max="40"
                        step="1"
                        data-path="effects.easter.emissionRate"
                        data-output="easterEmissionRateOut"
                      />
                      <output id="easterEmissionRateOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterMaxParticles"
                        min="20"
                        max="400"
                        step="10"
                        data-path="effects.easter.maxParticles"
                        data-output="easterMaxParticlesOut"
                      />
                      <output id="easterMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterParticleLifetimeSec">Particle lifetime (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterParticleLifetimeSec"
                        min="4"
                        max="120"
                        step="1"
                        data-path="effects.easter.particleLifetimeSec"
                        data-output="easterParticleLifetimeSecOut"
                      />
                      <output id="easterParticleLifetimeSecOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterSizeMin"
                        min="6"
                        max="60"
                        step="1"
                        data-path="effects.easter.sizeMin"
                        data-output="easterSizeMinOut"
                      />
                      <output id="easterSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterSizeMax"
                        min="8"
                        max="90"
                        step="1"
                        data-path="effects.easter.sizeMax"
                        data-output="easterSizeMaxOut"
                      />
                      <output id="easterSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterSpeedMin"
                        min="10"
                        max="240"
                        step="1"
                        data-path="effects.easter.speedMin"
                        data-output="easterSpeedMinOut"
                      />
                      <output id="easterSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterSpeedMax"
                        min="10"
                        max="360"
                        step="1"
                        data-path="effects.easter.speedMax"
                        data-output="easterSpeedMaxOut"
                      />
                      <output id="easterSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterDrift">Drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="easterDrift"
                        min="0"
                        max="80"
                        step="1"
                        data-path="effects.easter.drift"
                        data-output="easterDriftOut"
                      />
                      <output id="easterDriftOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="easterColorMode">Color mode</label>
                    <select id="easterColorMode" data-path="effects.easter.colorMode">
                      <option value="palette">Palette</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="easterColorHex">Custom color</label>
                    <input type="color" id="easterColorHex" data-path="effects.easter.colorHex" />
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  Tip: Increase <strong>Particle lifetime</strong> if eggs vanish before reaching
                  the bottom.
                </p>
              </div>

              <!-- Leaves Effect Controls (migrated from Themes) -->
              <div
                class="theme-controls"
                id="leavesThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="leavesDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesDurationMs"
                        min="2000"
                        max="30000"
                        step="250"
                        data-path="effects.leaves.durationMs"
                        data-output="leavesDurationMsOut"
                      />
                      <output id="leavesDurationMsOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesEmissionRate">Density (particles/sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesEmissionRate"
                        min="1"
                        max="40"
                        step="1"
                        data-path="effects.leaves.emissionRate"
                        data-output="leavesEmissionRateOut"
                      />
                      <output id="leavesEmissionRateOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesMaxParticles"
                        min="20"
                        max="400"
                        step="10"
                        data-path="effects.leaves.maxParticles"
                        data-output="leavesMaxParticlesOut"
                      />
                      <output id="leavesMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesParticleLifetimeSec">Particle lifetime (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesParticleLifetimeSec"
                        min="4"
                        max="120"
                        step="1"
                        data-path="effects.leaves.particleLifetimeSec"
                        data-output="leavesParticleLifetimeSecOut"
                      />
                      <output id="leavesParticleLifetimeSecOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesSizeMin"
                        min="4"
                        max="60"
                        step="1"
                        data-path="effects.leaves.sizeMin"
                        data-output="leavesSizeMinOut"
                      />
                      <output id="leavesSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesSizeMax"
                        min="6"
                        max="90"
                        step="1"
                        data-path="effects.leaves.sizeMax"
                        data-output="leavesSizeMaxOut"
                      />
                      <output id="leavesSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesSpeedMin"
                        min="10"
                        max="240"
                        step="1"
                        data-path="effects.leaves.speedMin"
                        data-output="leavesSpeedMinOut"
                      />
                      <output id="leavesSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesSpeedMax"
                        min="10"
                        max="360"
                        step="1"
                        data-path="effects.leaves.speedMax"
                        data-output="leavesSpeedMaxOut"
                      />
                      <output id="leavesSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesDrift">Drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="leavesDrift"
                        min="0"
                        max="80"
                        step="1"
                        data-path="effects.leaves.drift"
                        data-output="leavesDriftOut"
                      />
                      <output id="leavesDriftOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="leavesColorMode">Color mode</label>
                    <select id="leavesColorMode" data-path="effects.leaves.colorMode">
                      <option value="palette">Palette</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="leavesColorHex">Custom color</label>
                    <input type="color" id="leavesColorHex" data-path="effects.leaves.colorHex" />
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  Tip: Increase <strong>Particle lifetime</strong> if leaves vanish before reaching
                  the bottom.
                </p>
              </div>

              <!-- Fire Effect Controls (migrated from Themes) -->
              <div
                class="theme-controls"
                id="fireEffectControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="fireDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireDurationMs"
                        min="500"
                        max="30000"
                        step="100"
                        data-path="effects.fire.durationMs"
                        data-output="fireDurationMsOut"
                      />
                      <output id="fireDurationMsOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireEmissionRate">Emission rate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireEmissionRate"
                        min="1"
                        max="80"
                        step="1"
                        data-path="effects.fire.emissionRate"
                        data-output="fireEmissionRateOut"
                      />
                      <output id="fireEmissionRateOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireMaxParticles"
                        min="10"
                        max="600"
                        step="1"
                        data-path="effects.fire.maxParticles"
                        data-output="fireMaxParticlesOut"
                      />
                      <output id="fireMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireParticleLifetimeSec">Particle lifetime (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireParticleLifetimeSec"
                        min="1"
                        max="20"
                        step="0.5"
                        data-path="effects.fire.particleLifetimeSec"
                        data-output="fireParticleLifetimeSecOut"
                      />
                      <output id="fireParticleLifetimeSecOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireSizeMin"
                        min="1"
                        max="60"
                        step="1"
                        data-path="effects.fire.sizeMin"
                        data-output="fireSizeMinOut"
                      />
                      <output id="fireSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireSizeMax"
                        min="2"
                        max="100"
                        step="1"
                        data-path="effects.fire.sizeMax"
                        data-output="fireSizeMaxOut"
                      />
                      <output id="fireSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireSpeedMin"
                        min="10"
                        max="260"
                        step="1"
                        data-path="effects.fire.speedMin"
                        data-output="fireSpeedMinOut"
                      />
                      <output id="fireSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireSpeedMax"
                        min="10"
                        max="420"
                        step="1"
                        data-path="effects.fire.speedMax"
                        data-output="fireSpeedMaxOut"
                      />
                      <output id="fireSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireDrift">Drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireDrift"
                        min="0"
                        max="120"
                        step="1"
                        data-path="effects.fire.drift"
                        data-output="fireDriftOut"
                      />
                      <output id="fireDriftOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="fireColorMode">Color mode</label>
                    <select id="fireColorMode" data-path="effects.fire.colorMode">
                      <option value="palette">Palette</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="fireColorHex">Custom color</label>
                    <input type="color" id="fireColorHex" data-path="effects.fire.colorHex" />
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  Tip: Increase <strong>Particle lifetime</strong> if embers vanish before reaching
                  the top.
                </p>
              </div>

              <!-- Wind Effect Controls (migrated from Themes) -->
              <div
                class="theme-controls"
                id="windEffectControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="windDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windDurationMs"
                        min="500"
                        max="30000"
                        step="100"
                        data-path="effects.wind.durationMs"
                        data-output="windDurationMsOut"
                      />
                      <output id="windDurationMsOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windEmissionRate">Emission rate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windEmissionRate"
                        min="1"
                        max="80"
                        step="1"
                        data-path="effects.wind.emissionRate"
                        data-output="windEmissionRateOut"
                      />
                      <output id="windEmissionRateOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windMaxParticles"
                        min="10"
                        max="600"
                        step="1"
                        data-path="effects.wind.maxParticles"
                        data-output="windMaxParticlesOut"
                      />
                      <output id="windMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windParticleLifetimeSec">Particle lifetime (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windParticleLifetimeSec"
                        min="1"
                        max="20"
                        step="0.5"
                        data-path="effects.wind.particleLifetimeSec"
                        data-output="windParticleLifetimeSecOut"
                      />
                      <output id="windParticleLifetimeSecOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windSpeedMin"
                        min="10"
                        max="420"
                        step="1"
                        data-path="effects.wind.speedMin"
                        data-output="windSpeedMinOut"
                      />
                      <output id="windSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windSpeedMax"
                        min="10"
                        max="520"
                        step="1"
                        data-path="effects.wind.speedMax"
                        data-output="windSpeedMaxOut"
                      />
                      <output id="windSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windLengthMin">Streak length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windLengthMin"
                        min="10"
                        max="240"
                        step="1"
                        data-path="effects.wind.lengthMin"
                        data-output="windLengthMinOut"
                      />
                      <output id="windLengthMinOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windLengthMax">Streak length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windLengthMax"
                        min="10"
                        max="360"
                        step="1"
                        data-path="effects.wind.lengthMax"
                        data-output="windLengthMaxOut"
                      />
                      <output id="windLengthMaxOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windDrift">Drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windDrift"
                        min="0"
                        max="120"
                        step="1"
                        data-path="effects.wind.drift"
                        data-output="windDriftOut"
                      />
                      <output id="windDriftOut"></output>
                    </div>
                  </div>

                  <div class="field">
                    <label for="windColorMode">Color mode</label>
                    <select id="windColorMode" data-path="effects.wind.colorMode">
                      <option value="palette">Palette</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="windColorHex">Custom color</label>
                    <input type="color" id="windColorHex" data-path="effects.wind.colorHex" />
                  </div>

                  <div class="field">
                    <label for="windColorOpacity">Color opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="windColorOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.wind.colorOpacity"
                        data-output="windColorOpacityOut"
                      />
                      <output id="windColorOpacityOut"></output>
                    </div>
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  Tip: Increase <strong>Particle lifetime</strong> if streaks vanish before reaching
                  the right edge.
                </p>
              </div>

              <details class="settings-group" data-group="transitions" open>
                <summary>Transitions</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="flash">
                    <label for="flashDuration">Flash duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="flashDuration"
                        min="80"
                        max="1200"
                        step="20"
                        data-path="effects.flash.durationMs"
                        data-output="flashDurationOut"
                      />
                      <output id="flashDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeDuration">Fade duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fadeDuration"
                        min="150"
                        max="12000"
                        step="50"
                        data-path="effects.fade.durationMs"
                        data-output="fadeDurationOut"
                      />
                      <output id="fadeDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeColorHex">Fade color</label>
                    <input type="color" id="fadeColorHex" data-path="effects.fade.colorHex" />
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeOpacity">Fade opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fadeOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.fade.opacity"
                        data-output="fadeOpacityOut"
                      />
                      <output id="fadeOpacityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeEasing">Fade easing</label>
                    <select id="fadeEasing" data-path="effects.fade.easing">
                      <option value="standard">Standard</option>
                      <option value="linear">Linear</option>
                      <option value="easeInOut">Ease In Out</option>
                      <option value="easeOut">Ease Out</option>
                      <option value="easeIn">Ease In</option>
                    </select>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeBlendMode">Blend mode</label>
                    <select id="fadeBlendMode" data-path="effects.fade.blendMode">
                      <option value="normal">Normal</option>
                      <option value="multiply">Multiply</option>
                      <option value="screen">Screen</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft Light</option>
                    </select>
                  </div>
                  <div class="field" data-effect="sweep">
                    <label for="sweepDuration">Sweep duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="sweepDuration"
                        min="200"
                        max="2000"
                        step="20"
                        data-path="effects.sweep.durationMs"
                        data-output="sweepDurationOut"
                      />
                      <output id="sweepDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="sweep">
                    <label for="sweepDirection">Sweep direction</label>
                    <select id="sweepDirection" data-path="effects.sweep.direction">
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                      <option value="top">Top</option>
                      <option value="bottom">Bottom</option>
                    </select>
                  </div>

                  <div class="field" data-effect="sweep">
                    <label for="sweepColor">Sweep color</label>
                    <input type="color" id="sweepColor" data-path="effects.sweep.color" />
                  </div>
                  <div class="field" data-effect="cinema">
                    <label for="cinemaHeight">Cinema bar height (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="cinemaHeight"
                        min="6"
                        max="25"
                        step="1"
                        data-path="effects.cinema.barHeightPercent"
                        data-output="cinemaHeightOut"
                      />
                      <output id="cinemaHeightOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="cinema">
                    <label for="cinemaDuration">Cinema duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="cinemaDuration"
                        min="200"
                        max="2000"
                        step="20"
                        data-path="effects.cinema.durationMs"
                        data-output="cinemaDurationOut"
                      />
                      <output id="cinemaDurationOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="particles" open>
                <summary>Particles</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="confetti">
                    <label for="confettiCount">Confetti count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiCount"
                        min="20"
                        max="320"
                        step="10"
                        data-path="effects.confetti.count"
                        data-output="confettiCountOut"
                      />
                      <output id="confettiCountOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiDuration">Confetti duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiDuration"
                        min="1000"
                        max="6000"
                        step="100"
                        data-path="effects.confetti.durationMs"
                        data-output="confettiDurationOut"
                      />
                      <output id="confettiDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiOrigin">Origin mode</label>
                    <select id="confettiOrigin" data-path="effects.confetti.origin">
                      <option value="cannon">Cannon</option>
                      <option value="rain">Rain</option>
                      <option value="explosion">Explosion</option>
                    </select>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiShape">Shape</label>
                    <select id="confettiShape" data-path="effects.confetti.shape">
                      <option value="mixed">Mixed</option>
                      <option value="rect">Rectangle</option>
                      <option value="circle">Circle</option>
                    </select>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSpeedMin"
                        min="10"
                        max="100"
                        step="5"
                        data-path="effects.confetti.speedMin"
                        data-output="confettiSpeedMinOut"
                      />
                      <output id="confettiSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSpeedMax"
                        min="50"
                        max="200"
                        step="5"
                        data-path="effects.confetti.speedMax"
                        data-output="confettiSpeedMaxOut"
                      />
                      <output id="confettiSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiGravity">Gravity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiGravity"
                        min="50"
                        max="600"
                        step="10"
                        data-path="effects.confetti.gravity"
                        data-output="confettiGravityOut"
                      />
                      <output id="confettiGravityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiWind">Wind</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiWind"
                        min="-100"
                        max="100"
                        step="5"
                        data-path="effects.confetti.wind"
                        data-output="confettiWindOut"
                      />
                      <output id="confettiWindOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSizeMin"
                        min="2"
                        max="10"
                        step="1"
                        data-path="effects.confetti.sizeMin"
                        data-output="confettiSizeMinOut"
                      />
                      <output id="confettiSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSizeMax"
                        min="8"
                        max="20"
                        step="1"
                        data-path="effects.confetti.sizeMax"
                        data-output="confettiSizeMaxOut"
                      />
                      <output id="confettiSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowDuration">Snow duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowDuration"
                        min="2000"
                        max="60000"
                        step="250"
                        data-path="effects.snow.durationMs"
                        data-output="snowDurationOut"
                      />
                      <output id="snowDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowEmissionRate">Emission rate (particles/sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowEmissionRate"
                        min="1"
                        max="60"
                        step="1"
                        data-path="effects.snow.emissionRate"
                        data-output="snowEmissionRateOut"
                      />
                      <output id="snowEmissionRateOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowMaxParticles"
                        min="20"
                        max="500"
                        step="10"
                        data-path="effects.snow.maxParticles"
                        data-output="snowMaxParticlesOut"
                      />
                      <output id="snowMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSpeedMin"
                        min="5"
                        max="120"
                        step="1"
                        data-path="effects.snow.speedMin"
                        data-output="snowSpeedMinOut"
                      />
                      <output id="snowSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSpeedMax"
                        min="10"
                        max="200"
                        step="1"
                        data-path="effects.snow.speedMax"
                        data-output="snowSpeedMaxOut"
                      />
                      <output id="snowSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowDirection">Wind direction</label>
                    <select id="snowDirection" data-path="effects.snow.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowWindStrength">Wind strength (px/sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowWindStrength"
                        min="0"
                        max="200"
                        step="5"
                        data-path="effects.snow.windStrength"
                        data-output="snowWindStrengthOut"
                      />
                      <output id="snowWindStrengthOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowWindVariance">Wind variance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowWindVariance"
                        min="0"
                        max="40"
                        step="1"
                        data-path="effects.snow.windVariance"
                        data-output="snowWindVarianceOut"
                      />
                      <output id="snowWindVarianceOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowDrift">Drift (sway)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowDrift"
                        min="0"
                        max="60"
                        step="1"
                        data-path="effects.snow.drift"
                        data-output="snowDriftOut"
                      />
                      <output id="snowDriftOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowSizeMin">Particle size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSizeMin"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.snow.sizeMin"
                        data-output="snowSizeMinOut"
                      />
                      <output id="snowSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowSizeMax">Particle size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSizeMax"
                        min="2"
                        max="18"
                        step="1"
                        data-path="effects.snow.sizeMax"
                        data-output="snowSizeMaxOut"
                      />
                      <output id="snowSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowLifetimeSec">Particle lifetime (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowLifetimeSec"
                        min="4"
                        max="120"
                        step="1"
                        data-path="effects.snow.particleLifetimeSec"
                        data-output="snowLifetimeSecOut"
                      />
                      <output id="snowLifetimeSecOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snow">
                    <label for="snowColor">Color</label>
                    <input type="color" id="snowColor" data-path="effects.snow.colorHex" />
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesDuration">Snow Flakes duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesDuration"
                        min="2000"
                        max="60000"
                        step="250"
                        data-path="effects.snowflakes.durationMs"
                        data-output="snowflakesDurationOut"
                      />
                      <output id="snowflakesDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesEmissionRate">Emission rate (particles/sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesEmissionRate"
                        min="1"
                        max="60"
                        step="1"
                        data-path="effects.snowflakes.emissionRate"
                        data-output="snowflakesEmissionRateOut"
                      />
                      <output id="snowflakesEmissionRateOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesMaxParticles"
                        min="20"
                        max="500"
                        step="10"
                        data-path="effects.snowflakes.maxParticles"
                        data-output="snowflakesMaxParticlesOut"
                      />
                      <output id="snowflakesMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSpeedMin"
                        min="0"
                        max="200"
                        step="1"
                        data-path="effects.snowflakes.speedMin"
                        data-output="snowflakesSpeedMinOut"
                      />
                      <output id="snowflakesSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSpeedMax"
                        min="0"
                        max="240"
                        step="1"
                        data-path="effects.snowflakes.speedMax"
                        data-output="snowflakesSpeedMaxOut"
                      />
                      <output id="snowflakesSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesDirection">Direction</label>
                    <select id="snowflakesDirection" data-path="effects.snowflakes.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesWindStrength">Wind strength</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesWindStrength"
                        min="-240"
                        max="240"
                        step="5"
                        data-path="effects.snowflakes.windStrength"
                        data-output="snowflakesWindStrengthOut"
                      />
                      <output id="snowflakesWindStrengthOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesDrift">Drift (sway)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesDrift"
                        min="0"
                        max="80"
                        step="1"
                        data-path="effects.snowflakes.drift"
                        data-output="snowflakesDriftOut"
                      />
                      <output id="snowflakesDriftOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesSizeMin">Particle size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSizeMin"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.snowflakes.sizeMin"
                        data-output="snowflakesSizeMinOut"
                      />
                      <output id="snowflakesSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesSizeMax">Particle size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSizeMax"
                        min="2"
                        max="24"
                        step="1"
                        data-path="effects.snowflakes.sizeMax"
                        data-output="snowflakesSizeMaxOut"
                      />
                      <output id="snowflakesSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesLifetimeSec">Particle lifetime (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesLifetimeSec"
                        min="4"
                        max="120"
                        step="1"
                        data-path="effects.snowflakes.particleLifetimeSec"
                        data-output="snowflakesLifetimeSecOut"
                      />
                      <output id="snowflakesLifetimeSecOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="snowflakes">
                    <label for="snowflakesColor">Color</label>
                    <input
                      type="color"
                      id="snowflakesColor"
                      data-path="effects.snowflakes.colorHex"
                    />
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseDuration">Ripple Reverse duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseDuration"
                        min="200"
                        max="2000"
                        step="50"
                        data-path="effects.rippleReverse.durationMs"
                        data-output="rippleReverseDurationOut"
                      />
                      <output id="rippleReverseDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseColor">Ripple Reverse color</label>
                    <input
                      type="color"
                      id="rippleReverseColor"
                      data-path="effects.rippleReverse.color"
                    />
                  </div>

                  <label class="toggle" data-effect="rippleReverse" style="min-width: 220px">
                    <input
                      type="checkbox"
                      id="rippleReverseReverse"
                      data-path="effects.rippleReverse.reverse"
                    />
                    <span>Enable reverse animation</span>
                  </label>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseEasing">Easing</label>
                    <select id="rippleReverseEasing" data-path="effects.rippleReverse.easing">
                      <option value="ease-out">Ease Out</option>
                      <option value="elastic">Elastic</option>
                      <option value="bounce">Bounce</option>
                    </select>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseReverseDelay">Reverse delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseReverseDelay"
                        min="0"
                        max="2000"
                        step="50"
                        data-path="effects.rippleReverse.reverseDelay"
                        data-output="rippleReverseReverseDelayOut"
                      />
                      <output id="rippleReverseReverseDelayOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseHoldTime">Hold time (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseHoldTime"
                        min="0"
                        max="5000"
                        step="100"
                        data-path="effects.rippleReverse.holdTime"
                        data-output="rippleReverseHoldTimeOut"
                      />
                      <output id="rippleReverseHoldTimeOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseOrigin">Origin position</label>
                    <select id="rippleReverseOrigin" data-path="effects.rippleReverse.origin">
                      <option value="top-left">Top Left</option>
                      <option value="top-center">Top Center</option>
                      <option value="top-right">Top Right</option>
                      <option value="middle-left">Middle Left</option>
                      <option value="center">Center</option>
                      <option value="middle-right">Middle Right</option>
                      <option value="bottom-left">Bottom Left</option>
                      <option value="bottom-center">Bottom Center</option>
                      <option value="bottom-right">Bottom Right</option>
                    </select>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseMode">Animation mode</label>
                    <select id="rippleReverseMode" data-path="effects.rippleReverse.mode">
                      <option value="reverse">Reverse</option>
                      <option value="wobble">Wobble</option>
                      <option value="liquid">Liquid</option>
                    </select>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseOpacity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.rippleReverse.opacity"
                        data-output="rippleReverseOpacityOut"
                      />
                      <output id="rippleReverseOpacityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseBorderWidth">Border width (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseBorderWidth"
                        min="0"
                        max="50"
                        step="1"
                        data-path="effects.rippleReverse.borderWidth"
                        data-output="rippleReverseBorderWidthOut"
                      />
                      <output id="rippleReverseBorderWidthOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseBorderColor">Border color</label>
                    <input
                      type="color"
                      id="rippleReverseBorderColor"
                      data-path="effects.rippleReverse.borderColor"
                    />
                  </div>

                  <div class="field" data-effect="sparkles">
                    <label for="sparklesCount">Sparkles count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="sparklesCount"
                        min="20"
                        max="220"
                        step="10"
                        data-path="effects.sparkles.count"
                        data-output="sparklesCountOut"
                      />
                      <output id="sparklesCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainMode">Rain mode</label>
                    <select id="rainMode" data-path="effects.rain.mode">
                      <option value="continuous">Continuous</option>
                      <option value="burst">Burst</option>
                    </select>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainIntensity">Intensity preset</label>
                    <select id="rainIntensity" data-path="effects.rain.intensity">
                      <option value="soft">Soft</option>
                      <option value="medium">Medium</option>
                      <option value="heavy">Heavy</option>
                      <option value="storm">Storm</option>
                    </select>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainDirection">Direction</label>
                    <select id="rainDirection" data-path="effects.rain.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainSplashes">Splashes</label>
                    <select id="rainSplashes" data-path="effects.rain.splashes">
                      <option value="true">On</option>
                      <option value="false">Off</option>
                    </select>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainColorHex">Color</label>
                    <input type="color" id="rainColorHex" data-path="effects.rain.colorHex" />
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainCount">Burst count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainCount"
                        min="60"
                        max="1200"
                        step="10"
                        data-path="effects.rain.count"
                        data-output="rainCountOut"
                      />
                      <output id="rainCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainDuration">Rain duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainDuration"
                        min="1000"
                        max="20000"
                        step="100"
                        data-path="effects.rain.durationMs"
                        data-output="rainDurationOut"
                      />
                      <output id="rainDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainEmissionRate">Density (drops/sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainEmissionRate"
                        min="2"
                        max="140"
                        step="1"
                        data-path="effects.rain.emissionRate"
                        data-output="rainEmissionRateOut"
                      />
                      <output id="rainEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainMaxParticles">Max drops</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainMaxParticles"
                        min="50"
                        max="1200"
                        step="10"
                        data-path="effects.rain.maxParticles"
                        data-output="rainMaxParticlesOut"
                      />
                      <output id="rainMaxParticlesOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainParticleLifeMinSec">Drop lifetime min (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainParticleLifeMinSec"
                        min="0.3"
                        max="8"
                        step="0.1"
                        data-path="effects.rain.particleLifeMinSec"
                        data-output="rainParticleLifeMinSecOut"
                      />
                      <output id="rainParticleLifeMinSecOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainParticleLifeMaxSec">Drop lifetime max (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainParticleLifeMaxSec"
                        min="0.3"
                        max="10"
                        step="0.1"
                        data-path="effects.rain.particleLifeMaxSec"
                        data-output="rainParticleLifeMaxSecOut"
                      />
                      <output id="rainParticleLifeMaxSecOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainSpeedMin"
                        min="100"
                        max="2200"
                        step="10"
                        data-path="effects.rain.speedMin"
                        data-output="rainSpeedMinOut"
                      />
                      <output id="rainSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainSpeedMax"
                        min="150"
                        max="2600"
                        step="10"
                        data-path="effects.rain.speedMax"
                        data-output="rainSpeedMaxOut"
                      />
                      <output id="rainSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainLengthMin">Drop length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainLengthMin"
                        min="6"
                        max="60"
                        step="1"
                        data-path="effects.rain.lengthMin"
                        data-output="rainLengthMinOut"
                      />
                      <output id="rainLengthMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainLengthMax">Drop length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainLengthMax"
                        min="8"
                        max="80"
                        step="1"
                        data-path="effects.rain.lengthMax"
                        data-output="rainLengthMaxOut"
                      />
                      <output id="rainLengthMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainThicknessMin">Thickness min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainThicknessMin"
                        min="0.5"
                        max="3"
                        step="0.1"
                        data-path="effects.rain.thicknessMin"
                        data-output="rainThicknessMinOut"
                      />
                      <output id="rainThicknessMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainThicknessMax">Thickness max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainThicknessMax"
                        min="0.5"
                        max="3.5"
                        step="0.1"
                        data-path="effects.rain.thicknessMax"
                        data-output="rainThicknessMaxOut"
                      />
                      <output id="rainThicknessMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainDrift">Wind base drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainDrift"
                        min="0"
                        max="200"
                        step="5"
                        data-path="effects.rain.drift"
                        data-output="rainDriftOut"
                      />
                      <output id="rainDriftOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainWindVarMin">Wind variance min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainWindVarMin"
                        min="-60"
                        max="0"
                        step="1"
                        data-path="effects.rain.windVarMin"
                        data-output="rainWindVarMinOut"
                      />
                      <output id="rainWindVarMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainWindVarMax">Wind variance max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainWindVarMax"
                        min="0"
                        max="60"
                        step="1"
                        data-path="effects.rain.windVarMax"
                        data-output="rainWindVarMaxOut"
                      />
                      <output id="rainWindVarMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesMode">Bubbles mode</label>
                    <select id="bubblesMode" data-path="effects.bubbles.mode">
                      <option value="continuous">Continuous</option>
                      <option value="burst">Burst</option>
                    </select>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesDuration"
                        min="1500"
                        max="20000"
                        step="100"
                        data-path="effects.bubbles.durationMs"
                        data-output="bubblesDurationOut"
                      />
                      <output id="bubblesDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesCount">Burst count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesCount"
                        min="1"
                        max="220"
                        step="1"
                        data-path="effects.bubbles.count"
                        data-output="bubblesCountOut"
                      />
                      <output id="bubblesCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesEmissionRate">Emission rate (per sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesEmissionRate"
                        min="1"
                        max="40"
                        step="1"
                        data-path="effects.bubbles.emissionRate"
                        data-output="bubblesEmissionRateOut"
                      />
                      <output id="bubblesEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesMaxParticles"
                        min="10"
                        max="260"
                        step="5"
                        data-path="effects.bubbles.maxParticles"
                        data-output="bubblesMaxParticlesOut"
                      />
                      <output id="bubblesMaxParticlesOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesParticleLifeMinSec">Particle life min (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesParticleLifeMinSec"
                        min="1"
                        max="30"
                        step="1"
                        data-path="effects.bubbles.particleLifeMinSec"
                        data-output="bubblesParticleLifeMinSecOut"
                      />
                      <output id="bubblesParticleLifeMinSecOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesParticleLifeMaxSec">Particle life max (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesParticleLifeMaxSec"
                        min="1"
                        max="40"
                        step="1"
                        data-path="effects.bubbles.particleLifeMaxSec"
                        data-output="bubblesParticleLifeMaxSecOut"
                      />
                      <output id="bubblesParticleLifeMaxSecOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesSizeMin"
                        min="4"
                        max="100"
                        step="1"
                        data-path="effects.bubbles.sizeMin"
                        data-output="bubblesSizeMinOut"
                      />
                      <output id="bubblesSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesSizeMax"
                        min="10"
                        max="160"
                        step="1"
                        data-path="effects.bubbles.sizeMax"
                        data-output="bubblesSizeMaxOut"
                      />
                      <output id="bubblesSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesSpeedMin"
                        min="5"
                        max="160"
                        step="1"
                        data-path="effects.bubbles.speedMin"
                        data-output="bubblesSpeedMinOut"
                      />
                      <output id="bubblesSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesSpeedMax"
                        min="5"
                        max="200"
                        step="1"
                        data-path="effects.bubbles.speedMax"
                        data-output="bubblesSpeedMaxOut"
                      />
                      <output id="bubblesSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesDrift">Drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesDrift"
                        min="0"
                        max="120"
                        step="1"
                        data-path="effects.bubbles.drift"
                        data-output="bubblesDriftOut"
                      />
                      <output id="bubblesDriftOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesStrokeWidth">Stroke width</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesStrokeWidth"
                        min="0.5"
                        max="8"
                        step="0.5"
                        data-path="effects.bubbles.strokeWidth"
                        data-output="bubblesStrokeWidthOut"
                      />
                      <output id="bubblesStrokeWidthOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesColorMode">Color mode</label>
                    <select id="bubblesColorMode" data-path="effects.bubbles.colorMode">
                      <option value="palette">Palette</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesColorHex">Custom color</label>
                    <input type="color" id="bubblesColorHex" data-path="effects.bubbles.colorHex" />
                  </div>
                  <div class="field" data-effect="bubbles">
                    <label for="bubblesColorOpacity">Custom opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bubblesColorOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.bubbles.colorOpacity"
                        data-output="bubblesColorOpacityOut"
                      />
                      <output id="bubblesColorOpacityOut"></output>
                    </div>
                  </div>
                  <!-- Smoke (one-shot) -->
                  <div class="field" data-effect="smoke">
                    <label for="smokeDuration">Smoke duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeDuration"
                        min="800"
                        max="20000"
                        step="100"
                        data-path="effects.smoke.durationMs"
                        data-output="smokeDurationOut"
                      />
                      <output id="smokeDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeSpawnInterval">Spawn interval (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeSpawnInterval"
                        min="16"
                        max="160"
                        step="1"
                        data-path="effects.smoke.spawnIntervalMs"
                        data-output="smokeSpawnIntervalOut"
                      />
                      <output id="smokeSpawnIntervalOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeRiseSpeed">Rise speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeRiseSpeed"
                        min="0.2"
                        max="4"
                        step="0.1"
                        data-path="effects.smoke.riseSpeed"
                        data-output="smokeRiseSpeedOut"
                      />
                      <output id="smokeRiseSpeedOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeSizeScale">Size scale</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeSizeScale"
                        min="0.4"
                        max="2.5"
                        step="0.1"
                        data-path="effects.smoke.sizeScale"
                        data-output="smokeSizeScaleOut"
                      />
                      <output id="smokeSizeScaleOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeMaxParticles"
                        min="10"
                        max="300"
                        step="5"
                        data-path="effects.smoke.maxParticles"
                        data-output="smokeMaxParticlesOut"
                      />
                      <output id="smokeMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeParticleLifetime">Particle lifetime (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeParticleLifetime"
                        min="800"
                        max="20000"
                        step="100"
                        data-path="effects.smoke.particleLifetimeMs"
                        data-output="smokeParticleLifetimeOut"
                      />
                      <output id="smokeParticleLifetimeOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeOpacityScale">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="smokeOpacityScale"
                        min="0.05"
                        max="1"
                        step="0.01"
                        data-path="effects.smoke.opacityScale"
                        data-output="smokeOpacityScaleOut"
                      />
                      <output id="smokeOpacityScaleOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeColor">Smoke color</label>
                    <input type="color" id="smokeColor" data-path="effects.smoke.colorHex" />
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeBlendMode">Blend mode</label>
                    <select id="smokeBlendMode" data-path="effects.smoke.blendMode">
                      <option value="screen">Screen</option>
                      <option value="normal">Normal</option>
                      <option value="lighter">Lighter</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft light</option>
                      <option value="multiply">Multiply</option>
                    </select>
                  </div>

                  <div class="field" data-effect="smoke">
                    <label for="smokeRotation">Rotation</label>
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="smokeRotation"
                        data-path="effects.smoke.rotation"
                      />
                      <span>Enabled</span>
                    </label>
                  </div>

                  <div class="field" data-effect="dust">
                    <label for="dustCount">Dust count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="dustCount"
                        min="20"
                        max="220"
                        step="10"
                        data-path="effects.dust.count"
                        data-output="dustCountOut"
                      />
                      <output id="dustCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="glitter">
                    <label for="glitterCount">Glitter count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="glitterCount"
                        min="20"
                        max="220"
                        step="10"
                        data-path="effects.glitter.count"
                        data-output="glitterCountOut"
                      />
                      <output id="glitterCountOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="fallingStars" open>
                <summary>Falling Stars</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsDuration"
                        min="800"
                        max="12000"
                        step="100"
                        data-path="effects.fallingStars.durationMs"
                        data-output="fallingStarsDurationOut"
                      />
                      <output id="fallingStarsDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsTheme">Color theme</label>
                    <select id="fallingStarsTheme" data-path="effects.fallingStars.theme">
                      <option value="blue">Blue</option>
                      <option value="purple">Purple</option>
                      <option value="red">Red</option>
                      <option value="orange">Orange</option>
                      <option value="mix">Mixed</option>
                    </select>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="fallingStarsUseCustomColor"
                        data-path="effects.fallingStars.useCustomColor"
                      />
                      <span>Use custom color</span>
                    </label>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsCustomColorHex">Custom color</label>
                    <input
                      type="color"
                      id="fallingStarsCustomColorHex"
                      data-path="effects.fallingStars.customColorHex"
                    />
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsSpawnMode">Spawn mode</label>
                    <select id="fallingStarsSpawnMode" data-path="effects.fallingStars.spawnMode">
                      <option value="rain">Rain (from top)</option>
                      <option value="mouse">Mouse trail</option>
                      <option value="both">Both</option>
                    </select>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="fallingStarsMouseTrail"
                        data-path="effects.fallingStars.mouseTrail"
                      />
                      <span>Mouse trail enabled</span>
                    </label>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="fallingStarsClickExplosion"
                        data-path="effects.fallingStars.clickExplosion"
                      />
                      <span>Click explosion enabled</span>
                    </label>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsExplosionSize">Explosion size (stars per click)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsExplosionSize"
                        min="10"
                        max="300"
                        step="5"
                        data-path="effects.fallingStars.explosionSize"
                        data-output="fallingStarsExplosionSizeOut"
                      />
                      <output id="fallingStarsExplosionSizeOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsSpawnRate">Spawn rate (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsSpawnRate"
                        min="5"
                        max="100"
                        step="1"
                        data-path="effects.fallingStars.spawnRate"
                        data-output="fallingStarsSpawnRateOut"
                      />
                      <output id="fallingStarsSpawnRateOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsMaxParticles">Max particles</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsMaxParticles"
                        min="30"
                        max="600"
                        step="10"
                        data-path="effects.fallingStars.maxParticles"
                        data-output="fallingStarsMaxParticlesOut"
                      />
                      <output id="fallingStarsMaxParticlesOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsBaseSize">Base star size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsBaseSize"
                        min="5"
                        max="50"
                        step="1"
                        data-path="effects.fallingStars.baseSize"
                        data-output="fallingStarsBaseSizeOut"
                      />
                      <output id="fallingStarsBaseSizeOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsSizeVariation">Size variation</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsSizeVariation"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.fallingStars.sizeVariation"
                        data-output="fallingStarsSizeVariationOut"
                      />
                      <output id="fallingStarsSizeVariationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsGravity">Gravity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsGravity"
                        min="0"
                        max="0.05"
                        step="0.001"
                        data-path="effects.fallingStars.gravity"
                        data-output="fallingStarsGravityOut"
                      />
                      <output id="fallingStarsGravityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsMaxVelocity">Max velocity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsMaxVelocity"
                        min="1"
                        max="40"
                        step="1"
                        data-path="effects.fallingStars.maxVelocity"
                        data-output="fallingStarsMaxVelocityOut"
                      />
                      <output id="fallingStarsMaxVelocityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsVelocityVariation">Velocity variation</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsVelocityVariation"
                        min="0"
                        max="20"
                        step="0.5"
                        data-path="effects.fallingStars.velocityVariation"
                        data-output="fallingStarsVelocityVariationOut"
                      />
                      <output id="fallingStarsVelocityVariationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsRotationSpeed">Rotation speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsRotationSpeed"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.fallingStars.rotationSpeed"
                        data-output="fallingStarsRotationSpeedOut"
                      />
                      <output id="fallingStarsRotationSpeedOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsFadeStartPercent">Fade/shrink start (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsFadeStartPercent"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.fallingStars.fadeStartPercent"
                        data-output="fallingStarsFadeStartPercentOut"
                      />
                      <output id="fallingStarsFadeStartPercentOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsShrinkRate">Shrink rate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsShrinkRate"
                        min="0"
                        max="0.2"
                        step="0.005"
                        data-path="effects.fallingStars.shrinkRate"
                        data-output="fallingStarsShrinkRateOut"
                      />
                      <output id="fallingStarsShrinkRateOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsFadeRate">Fade rate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsFadeRate"
                        min="0"
                        max="0.2"
                        step="0.005"
                        data-path="effects.fallingStars.fadeRate"
                        data-output="fallingStarsFadeRateOut"
                      />
                      <output id="fallingStarsFadeRateOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsShadowBlur">Glow intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsShadowBlur"
                        min="0"
                        max="60"
                        step="1"
                        data-path="effects.fallingStars.shadowBlur"
                        data-output="fallingStarsShadowBlurOut"
                      />
                      <output id="fallingStarsShadowBlurOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label for="fallingStarsMouseRandomness">Mouse jitter</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fallingStarsMouseRandomness"
                        min="0"
                        max="200"
                        step="1"
                        data-path="effects.fallingStars.mouseRandomness"
                        data-output="fallingStarsMouseRandomnessOut"
                      />
                      <output id="fallingStarsMouseRandomnessOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="fallingStarsScreenBlend"
                        data-path="effects.fallingStars.screenBlend"
                      />
                      <span>Screen blend mode</span>
                    </label>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="fallingStarsReverse"
                        data-path="effects.fallingStars.reverse"
                      />
                      <span>Reverse (float up)</span>
                    </label>
                  </div>

                  <div class="field" data-effect="fallingStars">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="fallingStarsCircleClip"
                        data-path="effects.fallingStars.useCircleClip"
                      />
                      <span>Circle clip</span>
                    </label>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="special" open>
                <summary>Special</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="laser">
                    <label for="laserThickness">Laser thickness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserThickness"
                        min="2"
                        max="20"
                        step="1"
                        data-path="effects.laser.thickness"
                        data-output="laserThicknessOut"
                      />
                      <output id="laserThicknessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserLines">Laser lines</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserLines"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.laser.lines"
                        data-output="laserLinesOut"
                      />
                      <output id="laserLinesOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserDuration">Laser duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserDuration"
                        min="200"
                        max="2000"
                        step="50"
                        data-path="effects.laser.durationMs"
                        data-output="laserDurationOut"
                      />
                      <output id="laserDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserColor">Laser color</label>
                    <input type="color" id="laserColor" data-path="effects.laser.color" />
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserOpacity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.laser.opacity"
                        data-output="laserOpacityOut"
                      />
                      <output id="laserOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserDirection">Direction</label>
                    <select id="laserDirection" data-path="effects.laser.direction">
                      <option value="leftToRight">Left to Right</option>
                      <option value="rightToLeft">Right to Left</option>
                      <option value="topToBottom">Top to Bottom</option>
                      <option value="bottomToTop">Bottom to Top</option>
                      <option value="diagTLBR">Diagonal TL to BR</option>
                      <option value="diagTRBL">Diagonal TR to BL</option>
                    </select>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserStagger">Stagger between lines (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserStagger"
                        min="0"
                        max="300"
                        step="10"
                        data-path="effects.laser.staggerMs"
                        data-output="laserStaggerOut"
                      />
                      <output id="laserStaggerOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserGlow">Glow (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserGlow"
                        min="0"
                        max="40"
                        step="1"
                        data-path="effects.laser.glowPx"
                        data-output="laserGlowOut"
                      />
                      <output id="laserGlowOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserOffsetRange">Offset spread (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserOffsetRange"
                        min="0"
                        max="80"
                        step="2"
                        data-path="effects.laser.offsetRangePct"
                        data-output="laserOffsetRangeOut"
                      />
                      <output id="laserOffsetRangeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="fireworks">
                    <label for="fireworksBursts">Fireworks bursts</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireworksBursts"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.fireworks.bursts"
                        data-output="fireworksBurstsOut"
                      />
                      <output id="fireworksBurstsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="fireworks">
                    <label for="fireworksRays">Fireworks rays</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireworksRays"
                        min="8"
                        max="30"
                        step="1"
                        data-path="effects.fireworks.rays"
                        data-output="fireworksRaysOut"
                      />
                      <output id="fireworksRaysOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonDuration">Hexagon duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonDuration"
                        min="800"
                        max="12000"
                        step="100"
                        data-path="effects.hexagon.durationMs"
                        data-output="hexagonDurationOut"
                      />
                      <output id="hexagonDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonOriginX">Origin X (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonOriginX"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.hexagon.originXPercent"
                        data-output="hexagonOriginXOut"
                      />
                      <output id="hexagonOriginXOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonOriginY">Origin Y (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonOriginY"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.hexagon.originYPercent"
                        data-output="hexagonOriginYOut"
                      />
                      <output id="hexagonOriginYOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonLen">Step length (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonLen"
                        min="5"
                        max="60"
                        step="1"
                        data-path="effects.hexagon.len"
                        data-output="hexagonLenOut"
                      />
                      <output id="hexagonLenOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonPixelSize">Pixel size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonPixelSize"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.hexagon.pixelSize"
                        data-output="hexagonPixelSizeOut"
                      />
                      <output id="hexagonPixelSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonCount">Max lines</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonCount"
                        min="5"
                        max="260"
                        step="5"
                        data-path="effects.hexagon.count"
                        data-output="hexagonCountOut"
                      />
                      <output id="hexagonCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonBaseTime">Base time</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonBaseTime"
                        min="1"
                        max="80"
                        step="1"
                        data-path="effects.hexagon.baseTime"
                        data-output="hexagonBaseTimeOut"
                      />
                      <output id="hexagonBaseTimeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonAddedTime">Added time</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonAddedTime"
                        min="0"
                        max="80"
                        step="1"
                        data-path="effects.hexagon.addedTime"
                        data-output="hexagonAddedTimeOut"
                      />
                      <output id="hexagonAddedTimeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonSpawnChance">Spawn chance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonSpawnChance"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.hexagon.spawnChance"
                        data-output="hexagonSpawnChanceOut"
                      />
                      <output id="hexagonSpawnChanceOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonDieChance">Die chance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonDieChance"
                        min="0"
                        max="0.5"
                        step="0.01"
                        data-path="effects.hexagon.dieChance"
                        data-output="hexagonDieChanceOut"
                      />
                      <output id="hexagonDieChanceOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonSparkChance">Spark chance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonSparkChance"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.hexagon.sparkChance"
                        data-output="hexagonSparkChanceOut"
                      />
                      <output id="hexagonSparkChanceOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonSparkDist">Spark distance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonSparkDist"
                        min="0"
                        max="120"
                        step="2"
                        data-path="effects.hexagon.sparkDist"
                        data-output="hexagonSparkDistOut"
                      />
                      <output id="hexagonSparkDistOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonSparkSize">Spark size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonSparkSize"
                        min="1"
                        max="20"
                        step="1"
                        data-path="effects.hexagon.sparkSize"
                        data-output="hexagonSparkSizeOut"
                      />
                      <output id="hexagonSparkSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonHueStart">Hue start</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonHueStart"
                        min="0"
                        max="360"
                        step="5"
                        data-path="effects.hexagon.hueStart"
                        data-output="hexagonHueStartOut"
                      />
                      <output id="hexagonHueStartOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonHueChange">Hue change</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonHueChange"
                        min="0"
                        max="2"
                        step="0.05"
                        data-path="effects.hexagon.hueChange"
                        data-output="hexagonHueChangeOut"
                      />
                      <output id="hexagonHueChangeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonSaturation">Saturation</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonSaturation"
                        min="0"
                        max="100"
                        step="5"
                        data-path="effects.hexagon.saturation"
                        data-output="hexagonSaturationOut"
                      />
                      <output id="hexagonSaturationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonBaseLight">Base light</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonBaseLight"
                        min="0"
                        max="100"
                        step="5"
                        data-path="effects.hexagon.baseLight"
                        data-output="hexagonBaseLightOut"
                      />
                      <output id="hexagonBaseLightOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonAddedLight">Light range</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonAddedLight"
                        min="0"
                        max="80"
                        step="5"
                        data-path="effects.hexagon.addedLight"
                        data-output="hexagonAddedLightOut"
                      />
                      <output id="hexagonAddedLightOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonShadowBlur">Shadow blur multiplier</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonShadowBlur"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.hexagon.shadowToTimePropMult"
                        data-output="hexagonShadowBlurOut"
                      />
                      <output id="hexagonShadowBlurOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonTrailFade">Trail fade</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hexagonTrailFade"
                        min="0.01"
                        max="0.2"
                        step="0.01"
                        data-path="effects.hexagon.repaintAlpha"
                        data-output="hexagonTrailFadeOut"
                      />
                      <output id="hexagonTrailFadeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="hexagon">
                    <label for="hexagonComposite">Composite mode</label>
                    <select id="hexagonComposite" data-path="effects.hexagon.compositeOperation">
                      <option value="lighter">Lighter</option>
                      <option value="screen">Screen</option>
                      <option value="source-over">Normal</option>
                    </select>
                  </div>
                  <div class="field" data-effect="energy">
                    <label for="energySize">Energy size (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="energySize"
                        min="120"
                        max="420"
                        step="10"
                        data-path="effects.energy.sizePx"
                        data-output="energySizeOut"
                      />
                      <output id="energySizeOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="screenfx" open>
                <summary>Screen FX</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="flames">
                    <label for="flamesDurationMs">Flames duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="flamesDurationMs"
                        min="1500"
                        max="30000"
                        step="250"
                        data-path="effects.flames.durationMs"
                        data-output="flamesDurationMsOut"
                      />
                      <output id="flamesDurationMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="flames">
                    <label for="flamesIntensity">Flames intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="flamesIntensity"
                        min="0.5"
                        max="2"
                        step="0.1"
                        data-path="effects.flames.intensity"
                        data-output="flamesIntensityOut"
                      />
                      <output id="flamesIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="flames">
                    <label for="flamesSpeed">Flames speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="flamesSpeed"
                        min="0.5"
                        max="3"
                        step="0.1"
                        data-path="effects.flames.speed"
                        data-output="flamesSpeedOut"
                      />
                      <output id="flamesSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="flames">
                    <label for="flamesScale">Flames scale</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="flamesScale"
                        min="0.5"
                        max="2"
                        step="0.1"
                        data-path="effects.flames.scale"
                        data-output="flamesScaleOut"
                      />
                      <output id="flamesScaleOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="flames">
                    <label for="flamesShowBackground">Background</label>
                    <select id="flamesShowBackground" data-path="effects.flames.showBackground">
                      <option value="false">Transparent (fire only)</option>
                      <option value="true">Show background (black)</option>
                    </select>
                  </div>
                  <div class="field" data-effect="burn">
                    <label for="burnDurationMs">Burn duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="burnDurationMs"
                        min="1500"
                        max="30000"
                        step="250"
                        data-path="effects.burn.durationMs"
                        data-output="burnDurationMsOut"
                      />
                      <output id="burnDurationMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="burn">
                    <label for="burnProgressSpeed">Burn progress speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="burnProgressSpeed"
                        min="0.01"
                        max="2"
                        step="0.01"
                        data-path="effects.burn.progressSpeed"
                        data-output="burnProgressSpeedOut"
                      />
                      <output id="burnProgressSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="burn">
                    <label for="burnFlameSpeed">Flame speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="burnFlameSpeed"
                        min="0.1"
                        max="4"
                        step="0.1"
                        data-path="effects.burn.flameSpeed"
                        data-output="burnFlameSpeedOut"
                      />
                      <output id="burnFlameSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="burn">
                    <label for="burnBackground">Background</label>
                    <select id="burnBackground" data-path="effects.burn.background">
                      <option value="transparent">Transparent (fire only)</option>
                      <option value="white">White (burning paper)</option>
                    </select>
                  </div>
                  <div class="field" data-effect="burn">
                    <label for="burnLoop">Playback</label>
                    <select id="burnLoop" data-path="effects.burn.loop">
                      <option value="false">Play once</option>
                      <option value="true">Loop</option>
                    </select>
                  </div>
                  <div class="field" data-effect="vhs">
                    <label for="vhsIntensity">VHS intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="vhsIntensity"
                        min="0.2"
                        max="1.2"
                        step="0.05"
                        data-path="effects.vhs.intensity"
                        data-output="vhsIntensityOut"
                      />
                      <output id="vhsIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crt">
                    <label for="crtScanline">CRT scanline opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtScanline"
                        min="0.05"
                        max="0.4"
                        step="0.01"
                        data-path="effects.crt.scanlineOpacity"
                        data-output="crtScanlineOut"
                      />
                      <output id="crtScanlineOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crt">
                    <label for="crtVignette">CRT vignette</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtVignette"
                        min="0.1"
                        max="0.9"
                        step="0.05"
                        data-path="effects.crt.vignette"
                        data-output="crtVignetteOut"
                      />
                      <output id="crtVignetteOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiFontSize">ASCII font size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiFontSize"
                        min="8"
                        max="18"
                        step="1"
                        data-path="effects.ascii.fontSizePx"
                        data-output="asciiFontSizeOut"
                      />
                      <output id="asciiFontSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiColor">ASCII color</label>
                    <input type="color" id="asciiColor" data-path="effects.ascii.color" />
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiDuration">ASCII duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiDuration"
                        min="500"
                        max="8000"
                        step="100"
                        data-path="effects.ascii.durationMs"
                        data-output="asciiDurationOut"
                      />
                      <output id="asciiDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiOpacity">ASCII opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiOpacity"
                        min="0.05"
                        max="1"
                        step="0.05"
                        data-path="effects.ascii.opacity"
                        data-output="asciiOpacityOut"
                      />
                      <output id="asciiOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiBackgroundAlpha">ASCII background alpha</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiBackgroundAlpha"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.ascii.backgroundAlpha"
                        data-output="asciiBackgroundAlphaOut"
                      />
                      <output id="asciiBackgroundAlphaOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiBlendMode">ASCII blend mode</label>
                    <select id="asciiBlendMode" data-path="effects.ascii.blendMode">
                      <option value="screen">Screen</option>
                      <option value="normal">Normal</option>
                      <option value="multiply">Multiply</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft light</option>
                    </select>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiLetterSpacing">ASCII letter spacing (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiLetterSpacing"
                        min="0"
                        max="6"
                        step="0.1"
                        data-path="effects.ascii.letterSpacingPx"
                        data-output="asciiLetterSpacingOut"
                      />
                      <output id="asciiLetterSpacingOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiLineHeight">ASCII line height</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiLineHeight"
                        min="0.8"
                        max="2"
                        step="0.05"
                        data-path="effects.ascii.lineHeight"
                        data-output="asciiLineHeightOut"
                      />
                      <output id="asciiLineHeightOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebCount">Web count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebCount"
                        min="1"
                        max="8"
                        step="1"
                        data-path="effects.spiderWeb.count"
                        data-output="spiderWebCountOut"
                      />
                      <output id="spiderWebCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebPlacement">Placement</label>
                    <select id="spiderWebPlacement" data-path="effects.spiderWeb.placement">
                      <option value="random">Random</option>
                      <option value="center">Center</option>
                    </select>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebPadding">Edge padding (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebPadding"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.spiderWeb.paddingPercent"
                        data-output="spiderWebPaddingOut"
                      />
                      <output id="spiderWebPaddingOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebOpacity"
                        min="0.05"
                        max="1"
                        step="0.05"
                        data-path="effects.spiderWeb.opacity"
                        data-output="spiderWebOpacityOut"
                      />
                      <output id="spiderWebOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebIntensity">Intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebIntensity"
                        min="0.5"
                        max="2"
                        step="0.05"
                        data-path="effects.spiderWeb.intensity"
                        data-output="spiderWebIntensityOut"
                      />
                      <output id="spiderWebIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebQuality">Quality</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebQuality"
                        min="0.2"
                        max="1"
                        step="0.05"
                        data-path="effects.spiderWeb.quality"
                        data-output="spiderWebQualityOut"
                      />
                      <output id="spiderWebQualityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebDuration"
                        min="1000"
                        max="12000"
                        step="250"
                        data-path="effects.spiderWeb.durationMs"
                        data-output="spiderWebDurationOut"
                      />
                      <output id="spiderWebDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassDuration"
                        min="1500"
                        max="12000"
                        step="250"
                        data-path="effects.crackedGlass.durationMs"
                        data-output="crackedGlassDurationOut"
                      />
                      <output id="crackedGlassDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassCountMode">Amount mode</label>
                    <select id="crackedGlassCountMode" data-path="effects.crackedGlass.countMode">
                      <option value="random">Random</option>
                      <option value="fixed">Fixed</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassRandomMin">Random min cracks</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassRandomMin"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.randomMinCount"
                        data-output="crackedGlassRandomMinOut"
                      />
                      <output id="crackedGlassRandomMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassRandomMax">Random max cracks</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassRandomMax"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.randomMaxCount"
                        data-output="crackedGlassRandomMaxOut"
                      />
                      <output id="crackedGlassRandomMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassCount">Fixed cracks</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassCount"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.count"
                        data-output="crackedGlassCountOut"
                      />
                      <output id="crackedGlassCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassDistribution">Spread</label>
                    <select
                      id="crackedGlassDistribution"
                      data-path="effects.crackedGlass.distribution"
                    >
                      <option value="screen">Spread (full screen)</option>
                      <option value="cluster">Close (clustered)</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassClusterRadius">Cluster radius (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassClusterRadius"
                        min="2"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.clusterRadiusPercent"
                        data-output="crackedGlassClusterRadiusOut"
                      />
                      <output id="crackedGlassClusterRadiusOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOrigin">Location</label>
                    <select id="crackedGlassOrigin" data-path="effects.crackedGlass.origin">
                      <option value="random">Random</option>
                      <option value="center">Center</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOriginX">Location X (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassOriginX"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.originXPercent"
                        data-output="crackedGlassOriginXOut"
                      />
                      <output id="crackedGlassOriginXOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOriginY">Location Y (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassOriginY"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.originYPercent"
                        data-output="crackedGlassOriginYOut"
                      />
                      <output id="crackedGlassOriginYOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassOpacity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.crackedGlass.opacity"
                        data-output="crackedGlassOpacityOut"
                      />
                      <output id="crackedGlassOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassColorMode">Color mode</label>
                    <select id="crackedGlassColorMode" data-path="effects.crackedGlass.colorMode">
                      <option value="white">White</option>
                      <option value="tint">Tint</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassHue">Tint hue</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassHue"
                        min="0"
                        max="360"
                        step="1"
                        data-path="effects.crackedGlass.hue"
                        data-output="crackedGlassHueOut"
                      />
                      <output id="crackedGlassHueOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassHueVar">Hue variance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassHueVar"
                        min="0"
                        max="180"
                        step="1"
                        data-path="effects.crackedGlass.hueVariance"
                        data-output="crackedGlassHueVarOut"
                      />
                      <output id="crackedGlassHueVarOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassFlashMode">Flash mode</label>
                    <select id="crackedGlassFlashMode" data-path="effects.crackedGlass.flashMode">
                      <option value="single">Single</option>
                      <option value="strobe">Strobe</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassFlashOpacity">Flash opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassFlashOpacity"
                        min="0.05"
                        max="1"
                        step="0.05"
                        data-path="effects.crackedGlass.flashOpacity"
                        data-output="crackedGlassFlashOpacityOut"
                      />
                      <output id="crackedGlassFlashOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassStrobePulses">Strobe pulses</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassStrobePulses"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.strobePulses"
                        data-output="crackedGlassStrobePulsesOut"
                      />
                      <output id="crackedGlassStrobePulsesOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassStrobeInterval">Strobe interval (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassStrobeInterval"
                        min="60"
                        max="500"
                        step="10"
                        data-path="effects.crackedGlass.strobeIntervalMs"
                        data-output="crackedGlassStrobeIntervalOut"
                      />
                      <output id="crackedGlassStrobeIntervalOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassShakeEnabled">Shake</label>
                    <select
                      id="crackedGlassShakeEnabled"
                      data-path="effects.crackedGlass.shakeEnabled"
                    >
                      <option value="true">On</option>
                      <option value="false">Off</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassImpactEnabled">Impact marker</label>
                    <select
                      id="crackedGlassImpactEnabled"
                      data-path="effects.crackedGlass.impactEnabled"
                    >
                      <option value="true">On</option>
                      <option value="false">Off</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassMinIntensity">Min intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassMinIntensity"
                        min="0.1"
                        max="2"
                        step="0.05"
                        data-path="effects.crackedGlass.minIntensity"
                        data-output="crackedGlassMinIntensityOut"
                      />
                      <output id="crackedGlassMinIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassMaxIntensity">Max intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassMaxIntensity"
                        min="0.1"
                        max="2"
                        step="0.05"
                        data-path="effects.crackedGlass.maxIntensity"
                        data-output="crackedGlassMaxIntensityOut"
                      />
                      <output id="crackedGlassMaxIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassDelayStep">Impact spacing (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassDelayStep"
                        min="0"
                        max="500"
                        step="10"
                        data-path="effects.crackedGlass.delayStepMs"
                        data-output="crackedGlassDelayStepOut"
                      />
                      <output id="crackedGlassDelayStepOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassSaturation">Tint saturation</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassSaturation"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.saturation"
                        data-output="crackedGlassSaturationOut"
                      />
                      <output id="crackedGlassSaturationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassLightness">Tint lightness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassLightness"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.lightness"
                        data-output="crackedGlassLightnessOut"
                      />
                      <output id="crackedGlassLightnessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassBranchDepth">Branch depth</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassBranchDepth"
                        min="0"
                        max="4"
                        step="1"
                        data-path="effects.crackedGlass.branchDepth"
                        data-output="crackedGlassBranchDepthOut"
                      />
                      <output id="crackedGlassBranchDepthOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassLineWidth">Line width</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassLineWidth"
                        min="0.5"
                        max="6"
                        step="0.25"
                        data-path="effects.crackedGlass.lineWidthBase"
                        data-output="crackedGlassLineWidthOut"
                      />
                      <output id="crackedGlassLineWidthOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassLineWidthJitter">Line width jitter</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassLineWidthJitter"
                        min="0"
                        max="6"
                        step="0.25"
                        data-path="effects.crackedGlass.lineWidthJitter"
                        data-output="crackedGlassLineWidthJitterOut"
                      />
                      <output id="crackedGlassLineWidthJitterOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassJaggedness">Jaggedness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassJaggedness"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.crackedGlass.jaggednessPx"
                        data-output="crackedGlassJaggednessOut"
                      />
                      <output id="crackedGlassJaggednessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassShardProb">Shard probability</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassShardProb"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.crackedGlass.shardProbability"
                        data-output="crackedGlassShardProbOut"
                      />
                      <output id="crackedGlassShardProbOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesDuration"
                        min="1000"
                        max="8000"
                        step="100"
                        data-path="effects.heartParticles.durationMs"
                        data-output="heartParticlesDurationOut"
                      />
                      <output id="heartParticlesDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesDensity">Particle density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesDensity"
                        min="10"
                        max="150"
                        step="5"
                        data-path="effects.heartParticles.density"
                        data-output="heartParticlesDensityOut"
                      />
                      <output id="heartParticlesDensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesBlastSize">Max particle size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesBlastSize"
                        min="10"
                        max="80"
                        step="2"
                        data-path="effects.heartParticles.blastSize"
                        data-output="heartParticlesBlastSizeOut"
                      />
                      <output id="heartParticlesBlastSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesMinSize">Min particle size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesMinSize"
                        min="2"
                        max="30"
                        step="1"
                        data-path="effects.heartParticles.minSize"
                        data-output="heartParticlesMinSizeOut"
                      />
                      <output id="heartParticlesMinSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesGravity">Gravity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesGravity"
                        min="0"
                        max="0.5"
                        step="0.01"
                        data-path="effects.heartParticles.gravity"
                        data-output="heartParticlesGravityOut"
                      />
                      <output id="heartParticlesGravityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesSpeed">Particle speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesSpeed"
                        min="1"
                        max="10"
                        step="0.2"
                        data-path="effects.heartParticles.speed"
                        data-output="heartParticlesSpeedOut"
                      />
                      <output id="heartParticlesSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesShrinkRate">Shrink rate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesShrinkRate"
                        min="0.05"
                        max="0.5"
                        step="0.01"
                        data-path="effects.heartParticles.shrinkRate"
                        data-output="heartParticlesShrinkRateOut"
                      />
                      <output id="heartParticlesShrinkRateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesFadeRate">Fade rate (reverse mode)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesFadeRate"
                        min="0.001"
                        max="0.05"
                        step="0.001"
                        data-path="effects.heartParticles.fadeRate"
                        data-output="heartParticlesFadeRateOut"
                      />
                      <output id="heartParticlesFadeRateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesExplosionCount">Number of explosions</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesExplosionCount"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.heartParticles.explosionCount"
                        data-output="heartParticlesExplosionCountOut"
                      />
                      <output id="heartParticlesExplosionCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesTheme">Theme</label>
                    <select id="heartParticlesTheme" data-path="effects.heartParticles.theme">
                      <option value="red">Red</option>
                      <option value="pink">Pink</option>
                      <option value="purple">Purple</option>
                      <option value="lightpink">Light Pink</option>
                    </select>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesSpreadType">Spread pattern</label>
                    <select
                      id="heartParticlesSpreadType"
                      data-path="effects.heartParticles.spreadType"
                    >
                      <option value="single">Single (Center)</option>
                      <option value="random">Random</option>
                      <option value="grid">Grid</option>
                    </select>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="heartParticlesReverse"
                        data-path="effects.heartParticles.reverse"
                      />
                      <span>Reverse mode (float up)</span>
                    </label>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="ecgDuration"
                        min="1000"
                        max="12000"
                        step="100"
                        data-path="effects.ecgHeartbeat.durationMs"
                        data-output="ecgDurationOut"
                      />
                      <output id="ecgDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgPulseType">Pulse type</label>
                    <select id="ecgPulseType" data-path="effects.ecgHeartbeat.pulseType">
                      <option value="pulsar">Pulsar</option>
                      <option value="jugular">Jugular</option>
                      <option value="bleed">Bleed</option>
                      <option value="flatline">Flatline</option>
                      <option value="longbeat">Long Beat</option>
                    </select>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgCycle">Cycle speed (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="ecgCycle"
                        min="0.5"
                        max="10"
                        step="0.1"
                        data-path="effects.ecgHeartbeat.cycleSec"
                        data-output="ecgCycleOut"
                      />
                      <output id="ecgCycleOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgStrokeWidth">Stroke width</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="ecgStrokeWidth"
                        min="1"
                        max="10"
                        step="0.5"
                        data-path="effects.ecgHeartbeat.strokeWidth"
                        data-output="ecgStrokeWidthOut"
                      />
                      <output id="ecgStrokeWidthOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgColor">Pulse color</label>
                    <input type="color" id="ecgColor" data-path="effects.ecgHeartbeat.colorHex" />
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgEasing">Easing</label>
                    <select id="ecgEasing" data-path="effects.ecgHeartbeat.easing">
                      <option value="linear">Linear</option>
                      <option value="ease">Ease</option>
                      <option value="ease-in">Ease In</option>
                      <option value="ease-out">Ease Out</option>
                      <option value="ease-in-out">Ease In Out</option>
                    </select>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="ecgOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.ecgHeartbeat.opacity"
                        data-output="ecgOpacityOut"
                      />
                      <output id="ecgOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgYPos">Vertical position (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="ecgYPos"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.ecgHeartbeat.yPercent"
                        data-output="ecgYPosOut"
                      />
                      <output id="ecgYPosOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label for="ecgScale">Scale</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="ecgScale"
                        min="0.5"
                        max="2"
                        step="0.05"
                        data-path="effects.ecgHeartbeat.scale"
                        data-output="ecgScaleOut"
                      />
                      <output id="ecgScaleOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="ecgShadow"
                        data-path="effects.ecgHeartbeat.shadow"
                      />
                      <span>Shadow</span>
                    </label>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="ecgReverse"
                        data-path="effects.ecgHeartbeat.reverse"
                      />
                      <span>Reverse</span>
                    </label>
                  </div>
                  <div class="field" data-effect="ecgHeartbeat">
                    <label class="toggle">
                      <input type="checkbox" id="ecgGlow" data-path="effects.ecgHeartbeat.glow" />
                      <span>Glow</span>
                    </label>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="auraDuration"
                        min="500"
                        max="8000"
                        step="100"
                        data-path="effects.aura.durationMs"
                        data-output="auraDurationOut"
                      />
                      <output id="auraDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraLevelSelect">Aura level</label>
                    <select id="auraLevelSelect" data-path="effects.aura.level">
                      <option value="cold">Cold</option>
                      <option value="warm">Warm</option>
                      <option value="hot">Hot</option>
                    </select>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraColor">Custom color</label>
                    <input type="color" id="auraColor" data-path="effects.aura.color" />
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraIntensity">Color intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="auraIntensity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.aura.intensity"
                        data-output="auraIntensityOut"
                      />
                      <output id="auraIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="auraOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.aura.opacity"
                        data-output="auraOpacityOut"
                      />
                      <output id="auraOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraBlendMode">Blend mode</label>
                    <select id="auraBlendMode" data-path="effects.aura.blendMode">
                      <option value="normal">Normal</option>
                      <option value="screen">Screen</option>
                      <option value="multiply">Multiply</option>
                      <option value="overlay">Overlay</option>
                    </select>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraGradientCenter">Gradient center</label>
                    <input
                      type="text"
                      id="auraGradientCenter"
                      data-path="effects.aura.gradientCenter"
                      placeholder="50% 40%"
                    />
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraGradientRadius">Gradient radius</label>
                    <input
                      type="text"
                      id="auraGradientRadius"
                      data-path="effects.aura.gradientRadius"
                      placeholder="70%"
                    />
                  </div>
                  <div class="field" data-effect="grain">
                    <label for="grainIntensity">Grain intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="grainIntensity"
                        min="0.05"
                        max="0.5"
                        step="0.01"
                        data-path="effects.grain.intensity"
                        data-output="grainIntensityOut"
                      />
                      <output id="grainIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="watercolor">
                    <label for="watercolorIntensity">Watercolor intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="watercolorIntensity"
                        min="0.2"
                        max="1"
                        step="0.05"
                        data-path="effects.watercolor.intensity"
                        data-output="watercolorIntensityOut"
                      />
                      <output id="watercolorIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitDuration">8-bit duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitDuration"
                        min="400"
                        max="12000"
                        step="100"
                        data-path="effects.eightBit.durationMs"
                        data-output="eightBitDurationOut"
                      />
                      <output id="eightBitDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitPixelSize">8-bit pixel size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitPixelSize"
                        min="4"
                        max="18"
                        step="1"
                        data-path="effects.eightBit.pixelSize"
                        data-output="eightBitPixelSizeOut"
                      />
                      <output id="eightBitPixelSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitIntensity">8-bit intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitIntensity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.eightBit.intensity"
                        data-output="eightBitIntensityOut"
                      />
                      <output id="eightBitIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitLineAlpha">8-bit grid line alpha</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitLineAlpha"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.eightBit.lineAlpha"
                        data-output="eightBitLineAlphaOut"
                      />
                      <output id="eightBitLineAlphaOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitJitterPx">8-bit jitter (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitJitterPx"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.eightBit.jitterPx"
                        data-output="eightBitJitterPxOut"
                      />
                      <output id="eightBitJitterPxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitJitterMs">8-bit jitter speed (ms, 0 = duration)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitJitterMs"
                        min="0"
                        max="60000"
                        step="50"
                        data-path="effects.eightBit.jitterMs"
                        data-output="eightBitJitterMsOut"
                      />
                      <output id="eightBitJitterMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitBlendMode">8-bit blend mode</label>
                    <select id="eightBitBlendMode" data-path="effects.eightBit.blendMode">
                      <option value="normal">Normal</option>
                      <option value="multiply">Multiply</option>
                      <option value="screen">Screen</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft light</option>
                    </select>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitColorHex">8-bit grid color</label>
                    <input
                      type="color"
                      id="eightBitColorHex"
                      data-path="effects.eightBit.colorHex"
                    />
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="glitch" open>
                <summary>Distort &amp; Glitch</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="bulge">
                    <label for="bulgeDuration">Bulge duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeDuration"
                        min="200"
                        max="12000"
                        step="50"
                        data-path="effects.bulge.durationMs"
                        data-output="bulgeDurationOut"
                      />
                      <output id="bulgeDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeScale">Bulge scale</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeScale"
                        min="1.05"
                        max="2.2"
                        step="0.05"
                        data-path="effects.bulge.scale"
                        data-output="bulgeScaleOut"
                      />
                      <output id="bulgeScaleOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeCenterX">Bulge center X (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeCenterX"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.bulge.centerXPercent"
                        data-output="bulgeCenterXOut"
                      />
                      <output id="bulgeCenterXOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeCenterY">Bulge center Y (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeCenterY"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.bulge.centerYPercent"
                        data-output="bulgeCenterYOut"
                      />
                      <output id="bulgeCenterYOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeRadiusPercent">Bulge radius (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeRadiusPercent"
                        min="10"
                        max="100"
                        step="1"
                        data-path="effects.bulge.radiusPercent"
                        data-output="bulgeRadiusPercentOut"
                      />
                      <output id="bulgeRadiusPercentOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeGlowAlpha">Bulge glow alpha</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeGlowAlpha"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.bulge.glowAlpha"
                        data-output="bulgeGlowAlphaOut"
                      />
                      <output id="bulgeGlowAlphaOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeBlurPx">Bulge blur (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeBlurPx"
                        min="0"
                        max="10"
                        step="0.1"
                        data-path="effects.bulge.blurPx"
                        data-output="bulgeBlurPxOut"
                      />
                      <output id="bulgeBlurPxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bulge">
                    <label for="bulgeSaturate">Bulge saturate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeSaturate"
                        min="0"
                        max="3"
                        step="0.05"
                        data-path="effects.bulge.saturate"
                        data-output="bulgeSaturateOut"
                      />
                      <output id="bulgeSaturateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="strobe">
                    <label for="strobeFrequency">Strobe frequency</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="strobeFrequency"
                        min="2"
                        max="24"
                        step="1"
                        data-path="effects.strobe.frequency"
                        data-output="strobeFrequencyOut"
                      />
                      <output id="strobeFrequencyOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="strobe">
                    <label for="strobeColor">Strobe color (CSS)</label>
                    <input type="text" id="strobeColor" data-path="effects.strobe.color" />
                  </div>
                  <div class="field" data-effect="hardGlitch">
                    <label for="hardGlitchIntensity">Hard glitch intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hardGlitchIntensity"
                        min="0.3"
                        max="1.6"
                        step="0.05"
                        data-path="effects.hardGlitch.intensity"
                        data-output="hardGlitchIntensityOut"
                      />
                      <output id="hardGlitchIntensityOut"></output>
                    </div>
                  </div>
                  <!-- softGlitch removed -->
                  <div class="field" data-effect="shaderFire">
                    <label for="shaderFireIntensity">Shader fire intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="shaderFireIntensity"
                        min="0.3"
                        max="1.5"
                        step="0.05"
                        data-path="effects.shaderFire.intensity"
                        data-output="shaderFireIntensityOut"
                      />
                      <output id="shaderFireIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="shaderFire">
                    <label for="shaderFireSpeed">Shader fire speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="shaderFireSpeed"
                        min="0.3"
                        max="2.0"
                        step="0.1"
                        data-path="effects.shaderFire.speed"
                        data-output="shaderFireSpeedOut"
                      />
                      <output id="shaderFireSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="pixelSort">
                    <label for="pixelSortIntensity">Pixel sort intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="pixelSortIntensity"
                        min="0.2"
                        max="1"
                        step="0.05"
                        data-path="effects.pixelSort.intensity"
                        data-output="pixelSortIntensityOut"
                      />
                      <output id="pixelSortIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crtTurnOff">
                    <label for="crtTurnOffSpeed">CRT speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtTurnOffSpeed"
                        min="0.5"
                        max="2.0"
                        step="0.1"
                        data-path="effects.crtTurnOff.speed"
                        data-output="crtTurnOffSpeedOut"
                      />
                      <output id="crtTurnOffSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crtTurnOff">
                    <label for="crtTurnOffVerticalDelay">CRT vertical delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtTurnOffVerticalDelay"
                        min="0"
                        max="500"
                        step="50"
                        data-path="effects.crtTurnOff.verticalDelay"
                        data-output="crtTurnOffVerticalDelayOut"
                      />
                      <output id="crtTurnOffVerticalDelayOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crtTurnOff">
                    <label for="crtTurnOffHorizontalDelay">CRT horizontal delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtTurnOffHorizontalDelay"
                        min="100"
                        max="800"
                        step="50"
                        data-path="effects.crtTurnOff.horizontalDelay"
                        data-output="crtTurnOffHorizontalDelayOut"
                      />
                      <output id="crtTurnOffHorizontalDelayOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsAction">Curtains action</label>
                    <select id="curtainsAction" data-path="effects.curtains.action">
                      <option value="open">Open</option>
                      <option value="close">Close</option>
                      <option value="closeThenOpen">Close then open</option>
                    </select>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsDurationMs">Curtains duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsDurationMs"
                        min="200"
                        max="12000"
                        step="50"
                        data-path="effects.curtains.durationMs"
                        data-output="curtainsDurationMsOut"
                      />
                      <output id="curtainsDurationMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsHoldMs">Curtains hold (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsHoldMs"
                        min="0"
                        max="8000"
                        step="50"
                        data-path="effects.curtains.holdMs"
                        data-output="curtainsHoldMsOut"
                      />
                      <output id="curtainsHoldMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsOverlayAlpha">Curtains overlay alpha</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsOverlayAlpha"
                        min="0"
                        max="1"
                        step="0.02"
                        data-path="effects.curtains.overlayAlpha"
                        data-output="curtainsOverlayAlphaOut"
                      />
                      <output id="curtainsOverlayAlphaOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsEasing">Curtains easing</label>
                    <select id="curtainsEasing" data-path="effects.curtains.easing">
                      <option value="linear">Linear</option>
                      <option value="ease">Ease</option>
                      <option value="ease-in">Ease-in</option>
                      <option value="ease-out">Ease-out</option>
                      <option value="ease-in-out">Ease-in-out</option>
                      <option value="cubic-bezier(0.2,0.9,0.2,1)">Smooth (0.2,0.9,0.2,1)</option>
                    </select>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsColor1Hex">Curtains color 1</label>
                    <input
                      type="color"
                      id="curtainsColor1Hex"
                      data-path="effects.curtains.color1Hex"
                    />
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsColor2Hex">Curtains color 2</label>
                    <input
                      type="color"
                      id="curtainsColor2Hex"
                      data-path="effects.curtains.color2Hex"
                    />
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsRodEnabled">Curtain rod</label>
                    <select id="curtainsRodEnabled" data-path="effects.curtains.rodEnabled">
                      <option value="true">Enabled</option>
                      <option value="false">Disabled</option>
                    </select>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsRodHeightPx">Rod height (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsRodHeightPx"
                        min="6"
                        max="80"
                        step="1"
                        data-path="effects.curtains.rodHeightPx"
                        data-output="curtainsRodHeightPxOut"
                      />
                      <output id="curtainsRodHeightPxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsRodColorHex">Rod color</label>
                    <input
                      type="color"
                      id="curtainsRodColorHex"
                      data-path="effects.curtains.rodColorHex"
                    />
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsOpenWidthPercent">Open width (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsOpenWidthPercent"
                        min="4"
                        max="40"
                        step="1"
                        data-path="effects.curtains.openWidthPercent"
                        data-output="curtainsOpenWidthPercentOut"
                      />
                      <output id="curtainsOpenWidthPercentOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsOpenOffsetPercent">Open offset (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsOpenOffsetPercent"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.curtains.openOffsetPercent"
                        data-output="curtainsOpenOffsetPercentOut"
                      />
                      <output id="curtainsOpenOffsetPercentOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsOpenRotateDeg">Open rotate (deg)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsOpenRotateDeg"
                        min="0"
                        max="20"
                        step="0.5"
                        data-path="effects.curtains.openRotateDeg"
                        data-output="curtainsOpenRotateDegOut"
                      />
                      <output id="curtainsOpenRotateDegOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsTopPercent">Top offset (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsTopPercent"
                        min="-20"
                        max="20"
                        step="1"
                        data-path="effects.curtains.topPercent"
                        data-output="curtainsTopPercentOut"
                      />
                      <output id="curtainsTopPercentOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="curtains">
                    <label for="curtainsHeightPercent">Height (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="curtainsHeightPercent"
                        min="100"
                        max="160"
                        step="1"
                        data-path="effects.curtains.heightPercent"
                        data-output="curtainsHeightPercentOut"
                      />
                      <output id="curtainsHeightPercentOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructDuration"
                        min="1500"
                        max="30000"
                        step="100"
                        data-path="effects.selfDestruct.durationMs"
                        data-output="selfDestructDurationOut"
                      />
                      <output id="selfDestructDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructMessageText">Message</label>
                    <input
                      type="text"
                      id="selfDestructMessageText"
                      data-path="effects.selfDestruct.messageText"
                      placeholder="DEVICE SELF-DESTRUCTION"
                    />
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructCountdownSec">Countdown (sec)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructCountdownSec"
                        min="3"
                        max="60"
                        step="1"
                        data-path="effects.selfDestruct.countdownSec"
                        data-output="selfDestructCountdownSecOut"
                      />
                      <output id="selfDestructCountdownSecOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructWarningColorHex">Warning color</label>
                    <input
                      type="color"
                      id="selfDestructWarningColorHex"
                      data-path="effects.selfDestruct.warningColorHex"
                    />
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructTextColorHex">Text color</label>
                    <input
                      type="color"
                      id="selfDestructTextColorHex"
                      data-path="effects.selfDestruct.textColorHex"
                    />
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="selfDestructShowGrid"
                        data-path="effects.selfDestruct.showGrid"
                      />
                      <span>Show background grid</span>
                    </label>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructGridOpacity">Grid opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructGridOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.selfDestruct.gridOpacity"
                        data-output="selfDestructGridOpacityOut"
                      />
                      <output id="selfDestructGridOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructOverlayOpacity">Overlay opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructOverlayOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.selfDestruct.overlayOpacity"
                        data-output="selfDestructOverlayOpacityOut"
                      />
                      <output id="selfDestructOverlayOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructPanelOpacity">Panel opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructPanelOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.selfDestruct.panelOpacity"
                        data-output="selfDestructPanelOpacityOut"
                      />
                      <output id="selfDestructPanelOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="selfDestructAbortEnabled"
                        data-path="effects.selfDestruct.abortEnabled"
                      />
                      <span>Allow ABORT button</span>
                    </label>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="selfDestructCrtEnabled"
                        data-path="effects.selfDestruct.crtEnabled"
                      />
                      <span>CRT shutdown on detonate</span>
                    </label>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructCrtDelayMs">CRT delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructCrtDelayMs"
                        min="0"
                        max="5000"
                        step="50"
                        data-path="effects.selfDestruct.crtDelayMs"
                        data-output="selfDestructCrtDelayMsOut"
                      />
                      <output id="selfDestructCrtDelayMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="selfDestruct">
                    <label for="selfDestructAutoResetMs">Auto-reset (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="selfDestructAutoResetMs"
                        min="0"
                        max="15000"
                        step="100"
                        data-path="effects.selfDestruct.autoResetMs"
                        data-output="selfDestructAutoResetMsOut"
                      />
                      <output id="selfDestructAutoResetMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownDurationMs">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownDurationMs"
                        min="1000"
                        max="30000"
                        step="100"
                        data-path="effects.movieCountdown.durationMs"
                        data-output="movieCountdownDurationMsOut"
                      />
                      <output id="movieCountdownDurationMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownStartNumber">Start number</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownStartNumber"
                        min="3"
                        max="20"
                        step="1"
                        data-path="effects.movieCountdown.startNumber"
                        data-output="movieCountdownStartNumberOut"
                      />
                      <output id="movieCountdownStartNumberOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownStepMs">Step (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownStepMs"
                        min="200"
                        max="2000"
                        step="50"
                        data-path="effects.movieCountdown.stepMs"
                        data-output="movieCountdownStepMsOut"
                      />
                      <output id="movieCountdownStepMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownHoldMs">Hold (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownHoldMs"
                        min="0"
                        max="2000"
                        step="50"
                        data-path="effects.movieCountdown.holdMs"
                        data-output="movieCountdownHoldMsOut"
                      />
                      <output id="movieCountdownHoldMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownSizeMode">Size mode</label>
                    <select id="movieCountdownSizeMode" data-path="effects.movieCountdown.sizeMode">
                      <option value="responsive">Responsive (vmin)</option>
                      <option value="fixed">Fixed (px)</option>
                    </select>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownSizeVmin">Size (vmin)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownSizeVmin"
                        min="30"
                        max="100"
                        step="1"
                        data-path="effects.movieCountdown.sizeVmin"
                        data-output="movieCountdownSizeVminOut"
                      />
                      <output id="movieCountdownSizeVminOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownSizePx">Size (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownSizePx"
                        min="200"
                        max="1200"
                        step="10"
                        data-path="effects.movieCountdown.sizePx"
                        data-output="movieCountdownSizePxOut"
                      />
                      <output id="movieCountdownSizePxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBorderPx">Frame border (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownBorderPx"
                        min="0"
                        max="60"
                        step="1"
                        data-path="effects.movieCountdown.borderPx"
                        data-output="movieCountdownBorderPxOut"
                      />
                      <output id="movieCountdownBorderPxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBorderColorHex">Frame border color</label>
                    <input
                      type="color"
                      id="movieCountdownBorderColorHex"
                      data-path="effects.movieCountdown.borderColorHex"
                    />
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBgColorHex">Background color</label>
                    <input
                      type="color"
                      id="movieCountdownBgColorHex"
                      data-path="effects.movieCountdown.bgColorHex"
                    />
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBgOpacity">Background opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownBgOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.movieCountdown.bgOpacity"
                        data-output="movieCountdownBgOpacityOut"
                      />
                      <output id="movieCountdownBgOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBoxSpeedMs">Box rotation speed (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownBoxSpeedMs"
                        min="200"
                        max="3000"
                        step="50"
                        data-path="effects.movieCountdown.boxSpeedMs"
                        data-output="movieCountdownBoxSpeedMsOut"
                      />
                      <output id="movieCountdownBoxSpeedMsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBoxLightHex">Box light</label>
                    <input
                      type="color"
                      id="movieCountdownBoxLightHex"
                      data-path="effects.movieCountdown.boxLightHex"
                    />
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBoxDarkHex">Box dark</label>
                    <input
                      type="color"
                      id="movieCountdownBoxDarkHex"
                      data-path="effects.movieCountdown.boxDarkHex"
                    />
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownBoxBorderHex">Box border</label>
                    <input
                      type="color"
                      id="movieCountdownBoxBorderHex"
                      data-path="effects.movieCountdown.boxBorderHex"
                    />
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownCircleBgOpacity">Circle bg opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownCircleBgOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.movieCountdown.circleBgOpacity"
                        data-output="movieCountdownCircleBgOpacityOut"
                      />
                      <output id="movieCountdownCircleBgOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownCircleBorderPx">Circle border (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="movieCountdownCircleBorderPx"
                        min="0"
                        max="40"
                        step="1"
                        data-path="effects.movieCountdown.circleBorderPx"
                        data-output="movieCountdownCircleBorderPxOut"
                      />
                      <output id="movieCountdownCircleBorderPxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownCircleBorderColorHex">Circle border color</label>
                    <input
                      type="color"
                      id="movieCountdownCircleBorderColorHex"
                      data-path="effects.movieCountdown.circleBorderColorHex"
                    />
                  </div>
                  <div class="field" data-effect="movieCountdown">
                    <label for="movieCountdownNumberColorHex">Number color</label>
                    <input
                      type="color"
                      id="movieCountdownNumberColorHex"
                      data-path="effects.movieCountdown.numberColorHex"
                    />
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurDuration">Blur duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="blurDuration"
                        min="200"
                        max="12000"
                        step="50"
                        data-path="effects.blur.durationMs"
                        data-output="blurDurationOut"
                      />
                      <output id="blurDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurAmount">Blur amount (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="blurAmount"
                        min="2"
                        max="40"
                        step="1"
                        data-path="effects.blur.amountPx"
                        data-output="blurAmountOut"
                      />
                      <output id="blurAmountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurBgAlpha">Blur background alpha</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="blurBgAlpha"
                        min="0"
                        max="0.2"
                        step="0.01"
                        data-path="effects.blur.bgAlpha"
                        data-output="blurBgAlphaOut"
                      />
                      <output id="blurBgAlphaOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurBlendMode">Blur blend mode</label>
                    <select id="blurBlendMode" data-path="effects.blur.blendMode">
                      <option value="normal">Normal</option>
                      <option value="multiply">Multiply</option>
                      <option value="screen">Screen</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft light</option>
                    </select>
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurSaturate">Blur saturate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="blurSaturate"
                        min="0"
                        max="3"
                        step="0.05"
                        data-path="effects.blur.saturate"
                        data-output="blurSaturateOut"
                      />
                      <output id="blurSaturateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurBrightness">Blur brightness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="blurBrightness"
                        min="0.5"
                        max="2.5"
                        step="0.05"
                        data-path="effects.blur.brightness"
                        data-output="blurBrightnessOut"
                      />
                      <output id="blurBrightnessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachDuration">Bleach duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bleachDuration"
                        min="200"
                        max="12000"
                        step="50"
                        data-path="effects.bleach.durationMs"
                        data-output="bleachDurationOut"
                      />
                      <output id="bleachDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachIntensity">Bleach intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bleachIntensity"
                        min="0.1"
                        max="0.9"
                        step="0.05"
                        data-path="effects.bleach.intensity"
                        data-output="bleachIntensityOut"
                      />
                      <output id="bleachIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachColorHex">Bleach tint color</label>
                    <input type="color" id="bleachColorHex" data-path="effects.bleach.colorHex" />
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachBlendMode">Bleach blend mode</label>
                    <select id="bleachBlendMode" data-path="effects.bleach.blendMode">
                      <option value="normal">Normal</option>
                      <option value="multiply">Multiply</option>
                      <option value="screen">Screen</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft light</option>
                    </select>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachBrightness">Bleach brightness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bleachBrightness"
                        min="0.5"
                        max="3"
                        step="0.05"
                        data-path="effects.bleach.brightness"
                        data-output="bleachBrightnessOut"
                      />
                      <output id="bleachBrightnessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachContrast">Bleach contrast</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bleachContrast"
                        min="0.5"
                        max="3"
                        step="0.05"
                        data-path="effects.bleach.contrast"
                        data-output="bleachContrastOut"
                      />
                      <output id="bleachContrastOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachSaturate">Bleach saturate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bleachSaturate"
                        min="0"
                        max="2"
                        step="0.05"
                        data-path="effects.bleach.saturate"
                        data-output="bleachSaturateOut"
                      />
                      <output id="bleachSaturateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="colorCorrection">
                    <label for="colorBrightness">Color correction brightness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="colorBrightness"
                        min="0.7"
                        max="1.8"
                        step="0.05"
                        data-path="effects.colorCorrection.brightness"
                        data-output="colorBrightnessOut"
                      />
                      <output id="colorBrightnessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="colorCorrection">
                    <label for="colorContrast">Color correction contrast</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="colorContrast"
                        min="0.7"
                        max="2"
                        step="0.05"
                        data-path="effects.colorCorrection.contrast"
                        data-output="colorContrastOut"
                      />
                      <output id="colorContrastOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="colorCorrection">
                    <label for="colorSaturate">Color correction saturate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="colorSaturate"
                        min="0.6"
                        max="2"
                        step="0.05"
                        data-path="effects.colorCorrection.saturate"
                        data-output="colorSaturateOut"
                      />
                      <output id="colorSaturateOut"></output>
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </section>
        </main>
      </div>

      <section class="status-bar" aria-label="Diagnostics">
        <span class="status-title">Diagnostics</span>
        <div class="diagnostics" id="diagnostics">
          <div class="diag-row">
            <span>Enabled</span>
            <span id="diagEnabled">--</span>
          </div>
          <div class="diag-row">
            <span>Overlay exists</span>
            <span id="diagOverlay">--</span>
          </div>
          <div class="diag-row">
            <span>Tour object captured</span>
            <span id="diagTourObj">--</span>
          </div>
          <div class="diag-row">
            <span>Last played effect</span>
            <span id="diagLastEffect">--</span>
          </div>
        </div>
      </section>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script src="effects-core.js"></script>
    <script>
      (function () {
        "use strict";

        (function () {
          const sidebar = document.getElementById("controlSidebar");
          const collapseToggle = document.getElementById("sidebarToggle");
          const openToggle = document.getElementById("sidebarOpen");
          const backdrop = document.getElementById("sidebarBackdrop");
          if (!sidebar || (!collapseToggle && !openToggle)) return;

          const storageKey = "effectsProSidebarCollapsed";
          const mobileQuery = window.matchMedia ? window.matchMedia("(max-width: 900px)") : null;
          const isMobile = () => !!(mobileQuery && mobileQuery.matches);

          const setBackdropVisible = (visible) => {
            if (!backdrop) return;
            backdrop.hidden = !visible;
          };

          const setAria = () => {
            const mobile = isMobile();
            const open = document.body.classList.contains("sidebar-open");

            if (openToggle) {
              openToggle.setAttribute("aria-expanded", mobile && open ? "true" : "false");
            }

            if (!collapseToggle) return;
            if (mobile) {
              collapseToggle.setAttribute("aria-expanded", open ? "true" : "false");
              const tooltip = open ? "Close controls" : "Open controls";
              collapseToggle.dataset.tooltip = tooltip;
              collapseToggle.setAttribute("aria-label", tooltip);
              return;
            }

            const expanded = !document.body.classList.contains("sidebar-collapsed");
            collapseToggle.setAttribute("aria-expanded", expanded ? "true" : "false");
            const tooltip = expanded ? "Collapse controls" : "Expand controls";
            collapseToggle.dataset.tooltip = tooltip;
            collapseToggle.setAttribute("aria-label", tooltip);
          };

          const closeMobile = () => {
            document.body.classList.remove("sidebar-open");
            setBackdropVisible(false);
            setAria();
          };

          const openMobile = () => {
            document.body.classList.add("sidebar-open");
            setBackdropVisible(true);
            setAria();
          };

          const toggleMobile = () => {
            if (document.body.classList.contains("sidebar-open")) closeMobile();
            else openMobile();
          };

          const applyDesktopState = () => {
            let collapsed = false;
            try {
              collapsed = window.localStorage && window.localStorage.getItem(storageKey) === "1";
            } catch {
              // ignore
            }
            document.body.classList.toggle("sidebar-collapsed", collapsed);
            document.body.classList.remove("sidebar-open");
            setBackdropVisible(false);
            setAria();
          };

          const toggleDesktopCollapsed = () => {
            const nextCollapsed = !document.body.classList.contains("sidebar-collapsed");
            document.body.classList.toggle("sidebar-collapsed", nextCollapsed);
            try {
              if (window.localStorage)
                window.localStorage.setItem(storageKey, nextCollapsed ? "1" : "0");
            } catch {
              // ignore
            }
            setAria();
          };

          if (openToggle) {
            openToggle.addEventListener("click", () => {
              if (isMobile()) toggleMobile();
              else toggleDesktopCollapsed();
            });
          }

          if (collapseToggle) {
            collapseToggle.addEventListener("click", () => {
              if (isMobile()) closeMobile();
              else toggleDesktopCollapsed();
            });
          }

          if (backdrop) {
            backdrop.addEventListener("click", closeMobile);
          }

          document.addEventListener("keydown", (event) => {
            if (!isMobile()) return;
            if (event.key === "Escape" || event.key === "Esc") closeMobile();
          });

          if (mobileQuery) {
            const onChange = () => {
              if (isMobile()) {
                document.body.classList.remove("sidebar-collapsed");
                closeMobile();
              } else {
                applyDesktopState();
              }
            };
            try {
              mobileQuery.addEventListener("change", onChange);
            } catch {
              // ignore
            }
          }

          if (isMobile()) {
            document.body.classList.remove("sidebar-collapsed");
            closeMobile();
          } else {
            applyDesktopState();
          }
        })();

        const EFFECTS = [
          "none",
          "hexagon",
          "flash",
          "fade",
          "selfDestruct",
          "sineWaves",
          "balloons",
          "sweep",
          "cinema",
          "curtains",
          "confetti",
          "sparkles",
          "smoke",
          "rain",
          "snow",
          "snowflakes",
          "easter",
          "leaves",
          "fire",
          "flames",
          "burn",
          "wind",
          "electric",
          "bokeh",
          "halloween",
          "christmasLights",
          "storm",
          "spinningRays",
          "flowers",
          "bubbles",
          "fallingStars",
          "radial",
          "ripple",
          "rippleReverse",
          "waterRipple",
          "water",
          "dust",
          "glitter",
          "laser",
          "fireworks",
          "energy",
          "vhs",
          "crt",
          "ascii",
          "matrixDance",
          "movieCountdown",
          "spiderWeb",
          "crackedGlass",
          "heartParticles",
          "ecgHeartbeat",
          "aura",
          "grain",
          "watercolor",
          "eightBit",
          "bulge",
          "strobe",
          "hardGlitch",
          "shaderFire",
          "pixelSort",
          "crtTurnOff",
          "blur",
          "bleach",
          "colorCorrection",
        ];

        const EFFECT_LABELS = {
          none: "None",
          hexagon: "Hexagon",
          flash: "Flash",
          fade: "Fade",
          selfDestruct: "Self-Destruct",
          sineWaves: "Sine Waves",
          balloons: "Balloons",
          sweep: "Sweep",
          cinema: "Cinema Bars",
          curtains: "Curtains",
          confetti: "Confetti",
          sparkles: "Sparkles",
          smoke: "Smoke",
          rain: "Rainfall",
          snow: "Snow",
          snowflakes: "Snow Flakes",
          easter: "Easter",
          leaves: "Leaves",
          fire: "Fire",
          flames: "Flames",
          burn: "Burn",
          wind: "Wind",
          electric: "Electric",
          bokeh: "Bokeh Lights",
          halloween: "Halloween",
          christmasLights: "Christmas Lights",
          storm: "Storm",
          spinningRays: "Spinning Rays",
          flowers: "Flowers",
          bubbles: "Bubbles",
          fallingStars: "Falling Stars",
          radial: "Radial",
          ripple: "Ripple",
          rippleReverse: "Ripple Reverse",
          waterRipple: "Water Ripple",
          water: "Water",
          dust: "Dust",
          glitter: "Glitter",
          laser: "Laser",
          fireworks: "Fireworks",
          energy: "Energy",
          vhs: "VHS",
          crt: "CRT",
          ascii: "ASCII",
          matrixDance: "Matrix Dance",
          movieCountdown: "Movie Countdown",
          spiderWeb: "Spider Web",
          crackedGlass: "Cracked Glass",
          ecgHeartbeat: "ECG Heartbeat",
          grain: "Grain",
          watercolor: "Watercolor",
          eightBit: "8-bit",
          bulge: "Bulge",
          strobe: "Strobe",
          hardGlitch: "Hard Glitch",
          shaderFire: "Shader Fire",
          pixelSort: "Pixel Sort",
          crtTurnOff: "CRT Turn-Off",
          blur: "Blur",
          bleach: "Bleach",
          colorCorrection: "Color Correction",
          heartParticles: "Heart Particles",
          aura: "Aura",
        };

        let nowPlayingTimer = null;

        function byId(id) {
          return document.getElementById(id);
        }

        let stagedTourPreset = null;

        function getTourCodeMode() {
          const modeEl = byId("tourCodeMode");
          const value = modeEl ? String(modeEl.value || "") : "";
          return value === "external" ? "external" : "inline";
        }

        function formatSelectionLabel(selection) {
          if (!selection || !selection.type || selection.type === "none") return "None";
          if (selection.type === "effect")
            return "Effect: " + getLabel(EFFECT_LABELS, selection.name);
          return selection.name || "None";
        }

        function setCopyTourCodeEnabled(enabled, tooltip) {
          const copyBtn = byId("copyTourCode");
          if (!copyBtn) return;
          copyBtn.classList.toggle("is-disabled", !enabled);
          copyBtn.setAttribute("aria-disabled", enabled ? "false" : "true");
          const tip =
            tooltip || (enabled ? "Copy tour button code" : "Save to enable tour code copy");
          copyBtn.dataset.tooltip = tip;
          copyBtn.setAttribute("aria-label", tip);
        }

        function invalidateTourPreset() {
          stagedTourPreset = null;
          setCopyTourCodeEnabled(false);
        }

        function getLabel(labelMap, key) {
          if (!key) return "";
          return labelMap && labelMap[key] ? labelMap[key] : key;
        }

        function formatNowPlaying(value) {
          if (!value || value === "none") return "None";
          if (value.indexOf("theme:") === 0) {
            const themeKey = value.replace("theme:", "").trim();
            return getLabel(EFFECT_LABELS, themeKey);
          }
          return getLabel(EFFECT_LABELS, value);
        }

        function setNowPlaying(value, durationMs) {
          const wrap = byId("nowPlayingWrap");
          const label = byId("nowPlaying");
          if (!wrap || !label) return;
          if (nowPlayingTimer) {
            clearTimeout(nowPlayingTimer);
            nowPlayingTimer = null;
          }
          const formatted = formatNowPlaying(value);
          label.textContent = formatted;
          const isActive = formatted && formatted !== "None";
          wrap.dataset.active = isActive ? "true" : "false";
          const holdMs = Number(durationMs);
          if (isActive && Number.isFinite(holdMs) && holdMs > 0) {
            nowPlayingTimer = setTimeout(() => {
              label.textContent = "None";
              wrap.dataset.active = "false";
              nowPlayingTimer = null;
              updatePlaybackButton(false);
            }, holdMs + 200);
          }
        }

        function getEffectDurationMs(effectName, config) {
          if (!effectName || effectName === "none") return 0;
          const effectCfg = config && config.effects ? config.effects[effectName] : null;
          const duration =
            effectCfg && typeof effectCfg.durationMs !== "undefined"
              ? Number(effectCfg.durationMs)
              : 0;
          return Number.isFinite(duration) && duration > 0 ? duration : 1200;
        }

        function waitForApi(callback, attempts) {
          const maxAttempts = attempts || 120; // ~12s fallback for slow networks
          let done = false;
          let timer = null;

          function getApi() {
            const api = window.tourEffectsFunctions || window.effectsPro;
            if (!api) return null;
            if (typeof api.getConfig !== "function") return null;
            if (typeof api.loadConfig !== "function") return null;
            return api;
          }

          function finish(api, err) {
            if (done) return;
            done = true;
            if (timer) clearInterval(timer);
            callback(api, err);
          }

          const immediate = getApi();
          if (immediate) {
            finish(immediate);
            return;
          }

          // Prefer loader promise when available (visual-effects-pro loader).
          const ep = window.effectsPro;
          if (ep && ep.ready && typeof ep.ready.then === "function") {
            ep.ready
              .then(() => {
                finish(getApi());
              })
              .catch((err) => {
                finish(null, err);
              });
          }

          let count = 0;
          timer = setInterval(() => {
            const api = getApi();
            if (api) {
              finish(api);
              return;
            }
            count += 1;
            if (count >= maxAttempts) {
              finish(null);
            }
          }, 100);
        }

        function showToast(message, isError) {
          const toast = byId("toast");
          if (!toast) return;
          toast.textContent = message;
          toast.style.borderColor = isError ? "var(--danger)" : "var(--accent-2)";
          toast.classList.add("show");
          setTimeout(() => toast.classList.remove("show"), 2200);
        }

        function escapeJsString(value) {
          return String(value)
            .replace(/\\/g, "\\\\")
            .replace(/'/g, "\\'")
            .replace(/\r/g, "\\r")
            .replace(/\n/g, "\\n");
        }

        function buildTourConfigPatch(api, selection) {
          if (!api || typeof api.getConfig !== "function") return null;
          const cfg = api.getConfig();
          if (!cfg || typeof cfg !== "object") return null;

          const type = selection && selection.type ? selection.type : "none";
          const name = selection && selection.name ? selection.name : "none";
          if (!type || type === "none" || !name || name === "none") return null;

          const patch = {
            reducedMotionRespect:
              typeof cfg.reducedMotionRespect === "boolean" ? cfg.reducedMotionRespect : true,
            maxDevicePixelRatio: Number(cfg.maxDevicePixelRatio) || 2,
            zIndex: Number(cfg.zIndex) || 999999,
          };

          const targetType = type === "theme" ? "effect" : type;
          if (targetType === "effect") {
            if (cfg.effects && typeof cfg.effects === "object" && cfg.effects[name]) {
              patch.effects = { [name]: cfg.effects[name] };
            }
          }

          return patch;
        }

        function buildTourButtonSnippet(preset) {
          const selection = preset && preset.selection ? preset.selection : preset;
          const mode = preset && preset.mode ? preset.mode : "external";

          const type = selection && selection.type ? selection.type : "none";
          const name = selection && selection.name ? selection.name : "none";

          const patch = preset && preset.patch ? preset.patch : null;
          const patchJson = patch && typeof patch === "object" ? JSON.stringify(patch) : "";

          const targetType = type === "theme" ? "effect" : type;
          let trigger = "window.tourEffectsFunctions.stopAll();";
          if (targetType === "effect" && name !== "none") {
            trigger = "window.tourEffectsFunctions.playEffect('" + escapeJsString(name) + "');";
          }

          return (
            "try {\n" +
            "\tif (window.tourEffectsFunctions) {\n" +
            "\t\twindow.tourEffectsFunctions.loadConfig();\n" +
            "\t\twindow.tourEffectsFunctions.initializeEffects(this);\n" +
            "\n" +
            (mode === "inline" && patchJson
              ? "\t\tif (window.tourEffectsFunctions.setConfig) {\n" +
                "\t\t\twindow.tourEffectsFunctions.setConfig(" +
                patchJson +
                ");\n" +
                "\t\t}\n\n"
              : "") +
            "\t\tvar cfg = window.tourEffectsFunctions.getConfig ? window.tourEffectsFunctions.getConfig() : null;\n" +
            "\t\tvar enabled = cfg ? cfg.enabled !== false : true;\n" +
            "\t\tvar mode = cfg && cfg.mode ? cfg.mode : 'both';\n" +
            "\n" +
            "\t\tif (enabled && (mode === 'dom' || mode === 'both' || mode === 'button')) {\n" +
            "\t\t\twindow.tourEffectsFunctions.enableDomOverlay(true);\n" +
            "\t\t} else if (!enabled) {\n" +
            "\t\t\twindow.tourEffectsFunctions.enableDomOverlay(false);\n" +
            "\t\t}\n" +
            "\n" +
            "\t\t" +
            trigger +
            "\n" +
            "\t} else {\n" +
            "\t\tconsole.warn('Effects core not loaded yet (tourEffectsFunctions missing).');\n" +
            "\t}\n" +
            "} catch (error) {\n" +
            "\tconsole.error('Effects button action error:', error);\n" +
            "}"
          );
        }

        function copyTextToClipboard(text) {
          if (!text) return Promise.reject(new Error("Missing text"));

          if (navigator.clipboard && typeof navigator.clipboard.writeText === "function") {
            return navigator.clipboard.writeText(text);
          }

          return new Promise((resolve, reject) => {
            try {
              const textarea = document.createElement("textarea");
              textarea.value = text;
              textarea.setAttribute("readonly", "");
              textarea.style.position = "fixed";
              textarea.style.top = "-1000px";
              textarea.style.left = "-1000px";
              textarea.style.opacity = "0";
              document.body.appendChild(textarea);
              textarea.focus();
              textarea.select();
              const ok = document.execCommand && document.execCommand("copy");
              textarea.remove();
              if (ok) resolve();
              else reject(new Error("Copy command failed"));
            } catch (err) {
              reject(err);
            }
          });
        }

        function createRadioCard(id, value, label) {
          const wrapper = document.createElement("div");
          wrapper.className = "radio-card";
          const input = document.createElement("input");
          input.type = "radio";
          input.name = "previewSelection";
          input.id = id;
          input.value = value;
          const labelEl = document.createElement("label");
          labelEl.setAttribute("for", id);
          labelEl.textContent = label;
          wrapper.appendChild(input);
          wrapper.appendChild(labelEl);
          return wrapper;
        }

        function renderRadioList(container, list, labels, type, includeNone) {
          if (!container) return;
          container.textContent = "";
          if (includeNone) {
            container.appendChild(createRadioCard("select-" + type + "-none", "none", "None"));
          }
          const items = Array.isArray(list) ? list.slice() : [];
          const collator =
            typeof Intl !== "undefined" && Intl.Collator
              ? new Intl.Collator(undefined, { numeric: true, sensitivity: "base" })
              : null;

          items
            .filter((item) => item !== "none")
            .sort((a, b) => {
              const labelA = labels && labels[a] ? labels[a] : a;
              const labelB = labels && labels[b] ? labels[b] : b;
              if (collator) {
                return collator.compare(labelA, labelB) || collator.compare(a, b);
              }
              const keyA = String(labelA).toLowerCase();
              const keyB = String(labelB).toLowerCase();
              if (keyA < keyB) return -1;
              if (keyA > keyB) return 1;
              const rawA = String(a).toLowerCase();
              const rawB = String(b).toLowerCase();
              if (rawA < rawB) return -1;
              if (rawA > rawB) return 1;
              return 0;
            })
            .forEach((item) => {
              const id = "select-" + type + "-" + item;
              const value = type + ":" + item;
              container.appendChild(createRadioCard(id, value, labels[item] || item));
            });
        }

        function renderSelectionRadios(effects) {
          renderRadioList(byId("effectRadios"), effects, EFFECT_LABELS, "effect", true);
        }

        // Render immediately with fallback lists for faster perceived load,
        // then re-render with live lists once the core finishes bootstrapping.
        renderSelectionRadios(EFFECTS);

        function parseSelectionValue(value) {
          if (!value || value === "none") {
            return { type: "none", name: "none" };
          }
          const parts = value.split(":");
          const rawType = parts[0] || "none";
          const name = parts[1] || "none";
          if (rawType === "theme") {
            return { type: "effect", name };
          }
          if (rawType === "effect") {
            return { type: "effect", name };
          }
          return { type: "none", name: "none" };
        }

        function getSelection() {
          const checked = document.querySelector('input[name="previewSelection"]:checked');
          return parseSelectionValue(checked ? checked.value : "none");
        }

        function setSelectionValue(value) {
          const target = document.querySelector(
            'input[name="previewSelection"][value="' + value + '"]'
          );
          if (target) {
            target.checked = true;
            return;
          }
          const fallback = document.querySelector('input[name="previewSelection"][value="none"]');
          if (fallback) {
            fallback.checked = true;
          }
        }

        function selectionFromConfig(config) {
          const preferredEffect =
            config && config.preferredEffect ? config.preferredEffect : "none";
          if (preferredEffect && preferredEffect !== "none") {
            return { type: "effect", name: preferredEffect };
          }
          const preferredTheme = config && config.preferredTheme ? config.preferredTheme : "none";
          if (preferredTheme && preferredTheme !== "none") {
            return { type: "effect", name: preferredTheme };
          }
          return { type: "none", name: "none" };
        }

        function getConfigValue(config, path) {
          return path.split(".").reduce((acc, key) => (acc ? acc[key] : undefined), config);
        }

        function pathToObject(path, value) {
          const parts = path.split(".");
          let obj = {};
          let cursor = obj;
          for (let i = 0; i < parts.length - 1; i++) {
            cursor[parts[i]] = {};
            cursor = cursor[parts[i]];
          }
          cursor[parts[parts.length - 1]] = value;
          return obj;
        }

        function readUiValue(el) {
          if (!el) return undefined;
          if (el.type === "checkbox") {
            return !!el.checked;
          }
          if (el.type === "number" || el.type === "range") {
            const num = Number(el.value);
            return Number.isFinite(num) ? num : 0;
          }
          const value = el.value;
          if (value === "true") return true;
          if (value === "false") return false;
          return value;
        }

        function saveUIToConfig(api, changedEl) {
          if (!api || typeof api.setConfig !== "function") return;

          // Fast path: update a single data-path control safely.
          if (changedEl && changedEl.dataset && changedEl.dataset.path) {
            const value = readUiValue(changedEl);
            api.setConfig(pathToObject(changedEl.dataset.path, value));

            // Derived settings (water flow vectors) for future compatibility.
            if (changedEl.id === "waterFlowSpeed") {
              const flowSpeed = Number(changedEl.value) || 1.0;
              const baseFlow1 = [0.14, -0.09];
              const baseFlow2 = [-0.11, 0.13];
              api.setConfig({
                effects: {
                  water: {
                    flow1: [baseFlow1[0] * flowSpeed, baseFlow1[1] * flowSpeed],
                    flow2: [baseFlow2[0] * flowSpeed, baseFlow2[1] * flowSpeed],
                  },
                },
              });
            }
            return;
          }

          // Sync non-data-path controls used by the dashboard.
          const domEnabled = byId("domEnabled");
          if (domEnabled) {
            api.setConfig({ enabled: !!domEnabled.checked });
          }

          const mode = byId("mode");
          if (mode) {
            api.setConfig({ mode: mode.value });
          }

          const reducedMotion = byId("reducedMotion");
          if (reducedMotion) {
            api.setConfig({ reducedMotionRespect: !!reducedMotion.checked });
          }

          const zIndex = byId("zIndex");
          if (zIndex) {
            const value = Number(zIndex.value) || 999999;
            api.setConfig({ zIndex: value });
          }

          const auraRadio = document.querySelector('input[name="auraSelection"]:checked');
          if (auraRadio) {
            const level = auraRadio.value || "none";
            api.setConfig({ aura: { enabled: level !== "none", level: level } });
          }

          const selection = getSelection();
          if (selection.type === "effect") {
            api.setConfig({ preferredEffect: selection.name, preferredTheme: "none" });
          } else {
            api.setConfig({ preferredEffect: "none", preferredTheme: "none" });
          }
        }

        function persistConfig(api, changedEl) {
          try {
            invalidateTourPreset();
            saveUIToConfig(api, changedEl);
            if (api && typeof api.saveConfig === "function") {
              api.saveConfig();
            }
          } catch (err) {
            // Fail silent
          }
        }

        function setFieldVisibleByInputId(inputId, visible) {
          const el = byId(inputId);
          if (!el) return;
          const field = typeof el.closest === "function" ? el.closest(".field") : null;
          const target = field || el;
          target.style.display = visible ? "" : "none";
        }

        function updateHalloweenControlsVisibility(styleOverride) {
          const styleEl = byId("halloweenStyle");
          const style = styleOverride || (styleEl ? styleEl.value : "spiders");

          const showGhost = style === "spiders" || style === "mixed";
          const showEmoji = style === "emoji" || style === "mixed";
          const showEmbers = style === "embers";
          const showParticles = showEmoji || showEmbers;

          // Ghost overlay controls (only used when spiders overlay is active).
          [
            "halloweenGhostCount",
            "halloweenGhostDirection",
            "halloweenGhostRandomness",
            "halloweenGhostSizeMin",
            "halloweenGhostSizeMax",
          ].forEach((id) => setFieldVisibleByInputId(id, showGhost));

          // Emoji/particle motion controls.
          [
            "halloweenDirection",
            "halloweenWindStrength",
            "halloweenDrift",
            "halloweenSpeedMin",
            "halloweenSpeedMax",
            "halloweenSizeMin",
            "halloweenSizeMax",
          ].forEach((id) => setFieldVisibleByInputId(id, showEmoji));

          // Spawn tuning (used by emoji + embers).
          ["halloweenEmissionRate", "halloweenMaxParticles"].forEach((id) => {
            setFieldVisibleByInputId(id, showParticles);
          });

          // Legacy spider-string controls are not used by the current CSS spiders overlay.
          ["halloweenStringLenMin", "halloweenStringLenMax"].forEach((id) =>
            setFieldVisibleByInputId(id, false)
          );
        }

        function updateRainControlsVisibility(modeOverride) {
          const modeEl = byId("rainMode");
          const mode = modeOverride || (modeEl ? modeEl.value : "continuous");
          const isBurst = mode === "burst";

          // Only used for burst mode.
          ["rainCount"].forEach((id) => setFieldVisibleByInputId(id, isBurst));

          // Only used for continuous mode.
          [
            "rainEmissionRate",
            "rainMaxParticles",
            "rainParticleLifeMinSec",
            "rainParticleLifeMaxSec",
          ].forEach((id) => setFieldVisibleByInputId(id, !isBurst));
        }

        function updateBubblesControlsVisibility(modeOverride, colorModeOverride) {
          const modeEl = byId("bubblesMode");
          const mode = modeOverride || (modeEl ? modeEl.value : "continuous");
          const isBurst = mode === "burst";

          // Burst-only control.
          ["bubblesCount"].forEach((id) => setFieldVisibleByInputId(id, isBurst));

          // Continuous-only controls.
          ["bubblesEmissionRate", "bubblesMaxParticles"].forEach((id) =>
            setFieldVisibleByInputId(id, !isBurst)
          );

          const colorModeEl = byId("bubblesColorMode");
          const colorMode = colorModeOverride || (colorModeEl ? colorModeEl.value : "palette");
          const isCustom = colorMode === "custom";
          ["bubblesColorHex", "bubblesColorOpacity"].forEach((id) =>
            setFieldVisibleByInputId(id, isCustom)
          );
        }

        function updateChristmasLightsControlsVisibility(colorModeOverride) {
          const modeEl = byId("christmasLightsBokehColorMode");
          const mode = colorModeOverride || (modeEl ? modeEl.value : "palette");
          const isCustom = mode === "custom";
          ["christmasLightsBokehColorHex"].forEach((id) => setFieldVisibleByInputId(id, isCustom));
        }

        function updateEasterControlsVisibility(colorModeOverride) {
          const modeEl = byId("easterColorMode");
          const mode = colorModeOverride || (modeEl ? modeEl.value : "palette");
          const isCustom = mode === "custom";
          ["easterColorHex"].forEach((id) => setFieldVisibleByInputId(id, isCustom));
        }

        function updateLeavesControlsVisibility(colorModeOverride) {
          const modeEl = byId("leavesColorMode");
          const mode = colorModeOverride || (modeEl ? modeEl.value : "palette");
          const isCustom = mode === "custom";
          ["leavesColorHex"].forEach((id) => setFieldVisibleByInputId(id, isCustom));
        }

        function updateFireControlsVisibility(colorModeOverride) {
          const modeEl = byId("fireColorMode");
          const mode = colorModeOverride || (modeEl ? modeEl.value : "palette");
          const isCustom = mode === "custom";
          ["fireColorHex"].forEach((id) => setFieldVisibleByInputId(id, isCustom));
        }

        function updateWindControlsVisibility(colorModeOverride) {
          const modeEl = byId("windColorMode");
          const mode = colorModeOverride || (modeEl ? modeEl.value : "palette");
          const isCustom = mode === "custom";
          ["windColorHex", "windColorOpacity"].forEach((id) =>
            setFieldVisibleByInputId(id, isCustom)
          );
        }

        function applySettingsFilter(effectName, selectionType) {
          const isEffect = selectionType === "effect";
          const isTheme = selectionType === "theme";
          const selected = isEffect ? effectName || "none" : "none";
          const fields = Array.from(document.querySelectorAll(".settings-group [data-effect]"));
          let visibleCount = 0;
          const visibleGroups = new Set();

          // Show/hide theme settings section
          const themeSection = byId("themeSettingsSection");
          const effectSection = byId("effectSettingsSection");
          const globalHint = byId("settingsGlobalHint");

          if (themeSection) {
            const showForConvertedEffects =
              isEffect &&
              (effectName === "flowers" ||
                effectName === "spinningRays" ||
                effectName === "storm" ||
                effectName === "sineWaves" ||
                effectName === "balloons" ||
                effectName === "electric" ||
                effectName === "bokeh");
            themeSection.style.display =
              (isTheme && effectName !== "none") || showForConvertedEffects ? "" : "none";

            const themeMetaRow = themeSection.querySelector(".row");
            if (themeMetaRow) {
              themeMetaRow.style.display = isTheme ? "" : "none";
            }
          }
          if (effectSection) {
            effectSection.style.display = isEffect && effectName !== "none" ? "" : "none";
          }
          if (globalHint) {
            globalHint.style.display =
              (!isTheme && !isEffect) || effectName === "none" ? "" : "none";
          }

          // Show/hide snow theme controls
          const snowControls = byId("snowThemeControls");
          if (snowControls) {
            snowControls.style.display = isTheme && effectName === "snow" ? "" : "none";
          }

          // Show/hide halloween one-shot controls
          const halloweenControls = byId("halloweenThemeControls");
          if (halloweenControls) {
            const isHalloweenActive = isEffect && effectName === "halloween";
            halloweenControls.style.display = isHalloweenActive ? "" : "none";
            if (isHalloweenActive) {
              updateHalloweenControlsVisibility();
            }
          }

          // Show/hide Christmas Lights one-shot controls
          const christmasLightsControls = byId("christmasLightsThemeControls");
          if (christmasLightsControls) {
            const isChristmasLightsActive = isEffect && effectName === "christmasLights";
            christmasLightsControls.style.display = isChristmasLightsActive ? "" : "none";
            if (isChristmasLightsActive) {
              updateChristmasLightsControlsVisibility();
            }
          }

          // Show/hide Easter one-shot controls
          const easterControls = byId("easterThemeControls");
          if (easterControls) {
            const isEasterActive = isEffect && effectName === "easter";
            easterControls.style.display = isEasterActive ? "" : "none";
            if (isEasterActive) {
              updateEasterControlsVisibility();
            }
          }

          // Show/hide Leaves one-shot controls
          const leavesControls = byId("leavesThemeControls");
          if (leavesControls) {
            const isLeavesActive = isEffect && effectName === "leaves";
            leavesControls.style.display = isLeavesActive ? "" : "none";
            if (isLeavesActive) {
              updateLeavesControlsVisibility();
            }
          }

          // Show/hide Fire one-shot controls
          const fireEffectControls = byId("fireEffectControls");
          if (fireEffectControls) {
            const isFireActive = isEffect && effectName === "fire";
            fireEffectControls.style.display = isFireActive ? "" : "none";
            if (isFireActive) {
              updateFireControlsVisibility();
            }
          }

          // Show/hide Wind one-shot controls
          const windEffectControls = byId("windEffectControls");
          if (windEffectControls) {
            const isWindActive = isEffect && effectName === "wind";
            windEffectControls.style.display = isWindActive ? "" : "none";
            if (isWindActive) {
              updateWindControlsVisibility();
            }
          }

          // Show/hide storm theme controls
          const stormControls = byId("stormThemeControls");
          if (stormControls) {
            stormControls.style.display = isEffect && effectName === "storm" ? "" : "none";
          }

          // Show/hide fire (flames) theme controls
          const fireControls = byId("fireThemeControls");
          if (fireControls) {
            fireControls.style.display = isTheme && effectName === "flames" ? "" : "none";
          }

          // Show/hide bokeh theme controls
          const bokehControls = byId("bokehThemeControls");
          if (bokehControls) {
            bokehControls.style.display = isEffect && effectName === "bokeh" ? "" : "none";
          }

          // Show/hide electric theme controls
          const electricControls = byId("electricThemeControls");
          if (electricControls) {
            electricControls.style.display = isEffect && effectName === "electric" ? "" : "none";
          }

          // Show/hide water theme controls
          const waterControls = byId("waterThemeControls");
          if (waterControls) {
            waterControls.style.display = isEffect && effectName === "water" ? "" : "none";
          }

          const flowersControls = byId("flowersThemeControls");
          if (flowersControls) {
            flowersControls.style.display = isEffect && effectName === "flowers" ? "" : "none";
          }

          const raysControls = byId("spinningRaysThemeControls");
          if (raysControls) {
            const isRaysActive = effectName === "spinningRays" && (isTheme || isEffect);
            raysControls.style.display = isRaysActive ? "" : "none";
          }

          const sineControls = byId("sineWavesThemeControls");
          if (sineControls) {
            const isSineActive = effectName === "sineWaves" && (isTheme || isEffect);
            sineControls.style.display = isSineActive ? "" : "none";
          }

          const balloonsControls = byId("balloonsThemeControls");
          if (balloonsControls) {
            balloonsControls.style.display = isEffect && effectName === "balloons" ? "" : "none";
          }

          fields.forEach((field) => {
            const effects = field.dataset.effect
              ? field.dataset.effect.split(",").map((item) => item.trim())
              : [];
            const show = selected !== "none" && effects.indexOf(selected) !== -1;
            field.hidden = !show;
            field.style.display = show ? "" : "none";
            if (show) {
              visibleCount += 1;
              const group = field.closest(".settings-group");
              if (group) {
                visibleGroups.add(group);
              }
            }
          });

          document.querySelectorAll(".settings-group").forEach((group) => {
            const hasVisible = visibleGroups.has(group);
            group.hidden = !hasVisible;
            group.style.display = hasVisible ? "" : "none";
            if (hasVisible) {
              group.open = true;
            }
          });

          if (isEffect && selected === "rain") {
            updateRainControlsVisibility();
          }
          if (isEffect && selected === "bubbles") {
            updateBubblesControlsVisibility();
          }

          const empty = byId("settingsEmpty");
          const hint = byId("settingsHint");
          const label = getLabel(EFFECT_LABELS, selected);

          if (!isEffect || selected === "none") {
            return;
          }

          if (
            selected === "balloons" ||
            selected === "halloween" ||
            selected === "christmasLights" ||
            selected === "easter" ||
            selected === "leaves" ||
            selected === "fire" ||
            selected === "wind" ||
            selected === "electric" ||
            selected === "bokeh" ||
            selected === "flowers" ||
            selected === "storm" ||
            selected === "sineWaves"
          ) {
            if (empty) {
              empty.style.display = "none";
            }
            if (hint) {
              hint.textContent = "Tuning settings for " + label + ".";
            }
            return;
          }

          if (empty) {
            if (visibleCount === 0) {
              empty.textContent = "No adjustable settings for " + label + ".";
              empty.style.display = "block";
            } else {
              empty.style.display = "none";
            }
          }

          if (hint) {
            hint.textContent = "Tuning settings for " + label + ".";
          }
        }

        function applyConfigToUI(config) {
          if (!config) return;
          byId("domEnabled").checked = !!config.enabled;
          byId("mode").value = config.mode || "both";
          byId("reducedMotion").checked = !!config.reducedMotionRespect;
          byId("zIndex").value = Number(config.zIndex || 999999);

          document.querySelectorAll("[data-path]").forEach((el) => {
            const value = getConfigValue(config, el.dataset.path);
            if (typeof value === "undefined") return;
            if (el.type === "checkbox") {
              el.checked = !!value;
            } else {
              el.value = value;
            }
            const output = el.dataset.output ? byId(el.dataset.output) : null;
            if (output) {
              output.textContent = el.value;
            }
          });

          const selection = selectionFromConfig(config);
          const selectionValue =
            selection.type === "none" ? "none" : selection.type + ":" + selection.name;
          setSelectionValue(selectionValue);
          applySettingsFilter(selection.name, selection.type);
        }

        function bindMasterControls(api) {
          byId("domEnabled").addEventListener("change", (event) => {
            const enabled = !!event.target.checked;
            api.enableDomOverlay(enabled);

            // Prevent any implicit auto-start behavior; playback is controlled by Play/Stop.
            if (enabled && api.stopOverlayTheme) {
              api.stopOverlayTheme();
            }

            setNowPlaying("none");
            updatePlaybackButton(false);
            persistConfig(api);
            updateDiagnostics(api);
          });

          byId("mode").addEventListener("change", () => {
            persistConfig(api);
          });

          byId("reducedMotion").addEventListener("change", () => {
            persistConfig(api);
          });

          byId("zIndex").addEventListener("change", () => {
            persistConfig(api);
          });
        }

        function bindPathControls(api) {
          document.querySelectorAll("[data-path]").forEach((el) => {
            const output = el.dataset.output ? byId(el.dataset.output) : null;
            const updateOutput = () => {
              if (output) {
                output.textContent = el.value;
              }
            };

            updateOutput();

            // Live value display only (no auto-play, no persistence here).
            el.addEventListener("input", updateOutput);

            // Persist on committed change.
            el.addEventListener("change", () => {
              persistConfig(api, el);
              updateOutput();
              if (el.id === "halloweenStyle") {
                updateHalloweenControlsVisibility(el.value);
              }
              if (el.id === "rainMode") {
                updateRainControlsVisibility(el.value);
              }
              if (el.id === "bubblesMode") {
                updateBubblesControlsVisibility(el.value);
              }
              if (el.id === "bubblesColorMode") {
                updateBubblesControlsVisibility(undefined, el.value);
              }
              if (el.id === "christmasLightsBokehColorMode") {
                updateChristmasLightsControlsVisibility(el.value);
              }
              if (el.id === "easterColorMode") {
                updateEasterControlsVisibility(el.value);
              }
              if (el.id === "leavesColorMode") {
                updateLeavesControlsVisibility(el.value);
              }
              if (el.id === "fireColorMode") {
                updateFireControlsVisibility(el.value);
              }
              if (el.id === "windColorMode") {
                updateWindControlsVisibility(el.value);
              }
            });
          });
        }

        function bindSelectionRadios(api) {
          const radios = Array.from(document.querySelectorAll('input[name="previewSelection"]'));
          const apply = () => {
            const selection = getSelection();
            invalidateTourPreset();

            // Update config
            if (api && api.setConfig) {
              if (selection.type === "effect") {
                api.setConfig({ preferredEffect: selection.name, preferredTheme: "none" });
              } else {
                api.setConfig({ preferredEffect: "none", preferredTheme: "none" });
              }
            }

            // Persist preference changes immediately (do not auto-play on selection).
            if (api && api.saveConfig) {
              try {
                api.saveConfig();
              } catch (err) {
                // Fail silent
              }
            }

            applySettingsFilter(selection.name, selection.type);

            // Autoplay selection for quick preview.
            playSelectionFromUI(api);
          };
          radios.forEach((radio) => {
            radio.addEventListener("change", apply);
          });
        }

        function bindAuraControls(api) {
          // Aura is now a one-shot effect, no special binding needed
          // The old aura radios section has been removed
        }

        function bindFireThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindBokehThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindElectricThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindWaterThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindThemeLifetimeControl() {
          const lifetimeSelect = byId("themeLifetime");
          const durationField = byId("themeDuration");

          if (!lifetimeSelect || !durationField) return;

          const updateDurationVisibility = () => {
            const isTimed = lifetimeSelect.value === "timed";
            durationField.parentElement.style.display = isTimed ? "" : "none";
          };

          lifetimeSelect.addEventListener("change", updateDurationVisibility);
          updateDurationVisibility(); // Set initial state
        }

        function updatePlaybackButton(isPlaying) {
          const playBtn = byId("playSelection");
          const playIcon = byId("playIcon");
          const pauseIcon = byId("pauseIcon");
          const playText = byId("playButtonText");

          const stopBtn = byId("stopSelection");
          const nowPlayingWrap = byId("nowPlayingWrap");

          if (!playBtn || !playIcon || !pauseIcon || !playText || !stopBtn) return;

          const selection = getSelection();
          const hasActiveNowPlaying = !!(
            nowPlayingWrap && nowPlayingWrap.dataset.active === "true"
          );
          stopBtn.disabled = !(!!isPlaying || hasActiveNowPlaying);

          if (!isPlaying && !hasActiveNowPlaying) {
            setNowPlaying("none");
          }

          // Execute selection on Play (no pause/resume toggle; Stop always stops all).
          playIcon.style.display = "";
          pauseIcon.style.display = "none";

          let nextText = "Play";
          let nextTitle = "Play selection";

          if (selection.type === "effect" && selection.name !== "none") {
            const label = getLabel(EFFECT_LABELS, selection.name);
            nextText = "Play";
            nextTitle = "Play effect: " + label;
          } else {
            nextText = "Stop All";
            nextTitle = "Stop all effects";
          }

          playText.textContent = nextText;
          playBtn.dataset.tooltip = nextTitle;
          playBtn.setAttribute("aria-label", nextTitle);
        }

        function updateDiagnostics(api) {
          const diag = api && api.getDiagnostics ? api.getDiagnostics() : null;
          if (!diag) return;
          byId("diagEnabled").textContent = diag.enabled;
          byId("diagOverlay").textContent = diag.overlayExists;
          byId("diagTourObj").textContent = diag.tourObjCaptured;
          byId("diagLastEffect").textContent = diag.lastPlayedEffect || "none";
          if (diag.themeActive && diag.currentTheme) {
            setNowPlaying(diag.currentTheme);
            updatePlaybackButton(true);
          } else {
            // No-op: one-shot effects manage their own "now playing" state via timers.
          }
        }

        function stopAllPlayback(api) {
          if (!api) return;
          if (typeof api.stopAll === "function") {
            api.stopAll();
          } else if (typeof api.stopOverlayTheme === "function") {
            api.stopOverlayTheme();
          }
          setNowPlaying("none");
          updatePlaybackButton(false);
          updateDiagnostics(api);
        }

        function playSelectionFromUI(api) {
          if (!api) return;
          const selection = getSelection();

          // Dashboard rule: only one thing plays at a time.
          // Stop anything currently running before starting the next selection.
          if (
            selection &&
            selection.type !== "none" &&
            selection.name &&
            selection.name !== "none"
          ) {
            try {
              if (typeof api.stopAll === "function") {
                api.stopAll();
              } else if (typeof api.stopOverlayTheme === "function") {
                api.stopOverlayTheme();
              }
            } catch {
              // ignore
            }
          }

          if (selection.type === "effect" && selection.name !== "none") {
            if (typeof api.playEffect === "function") {
              api.playEffect(selection.name);
            }
            const duration = getEffectDurationMs(
              selection.name,
              api.getConfig ? api.getConfig() : null
            );
            setNowPlaying(selection.name, duration);
            updatePlaybackButton(false);
          } else {
            stopAllPlayback(api);
            return;
          }

          updateDiagnostics(api);
        }

        function bindKeyboardShortcuts(api) {
          document.addEventListener("keydown", (event) => {
            if (event.key === "Escape" || event.key === "Esc") {
              stopAllPlayback(api);
            }
          });
        }

        function bindActions(api) {
          const copyBtn = byId("copyTourCode");
          if (copyBtn) {
            copyBtn.addEventListener("click", () => {
              if (!stagedTourPreset || !stagedTourPreset.selection) {
                showToast("Click Save to stage tour code first", true);
                return;
              }
              const snippet = buildTourButtonSnippet(stagedTourPreset);
              copyTextToClipboard(snippet)
                .then(() => {
                  showToast("Tour button code copied");
                })
                .catch((err) => {
                  try {
                    // eslint-disable-next-line no-console
                    console.error(err);
                  } catch (e) {
                    // ignore
                  }
                  showToast("Copy failed - please copy manually", true);
                });
            });
          }

          const tourCodeMode = byId("tourCodeMode");
          if (tourCodeMode) {
            tourCodeMode.addEventListener("change", () => {
              invalidateTourPreset();
              showToast("Tour code mode changed. Click Save to stage again");
            });
          }

          const resetBtn = byId("resetAnimation");
          if (resetBtn) {
            resetBtn.addEventListener("click", () => {
              try {
                invalidateTourPreset();
                const selection = getSelection();
                const defaults =
                  api && api._internals && api._internals.Config && api._internals.Config.DEFAULTS
                    ? api._internals.Config.DEFAULTS
                    : null;

                if (
                  defaults &&
                  selection &&
                  selection.type &&
                  selection.name &&
                  selection.name !== "none"
                ) {
                  if (
                    selection.type === "theme" &&
                    defaults.themes &&
                    defaults.themes[selection.name]
                  ) {
                    api.setConfig({
                      themes: { [selection.name]: defaults.themes[selection.name] },
                    });
                  } else if (
                    selection.type === "effect" &&
                    defaults.effects &&
                    defaults.effects[selection.name]
                  ) {
                    api.setConfig({
                      effects: { [selection.name]: defaults.effects[selection.name] },
                    });
                  }
                }

                // Persist + refresh UI so sliders/toggles snap back to defaults.
                if (api && typeof api.saveConfig === "function") api.saveConfig();
                if (api && typeof api.getConfig === "function") applyConfigToUI(api.getConfig());
              } catch (err) {
                // ignore
              }

              // Restart playback from a clean slate.
              stopAllPlayback(api);
              playSelectionFromUI(api);

              // Cross-tab reset (tour listens for this token).
              try {
                api.setConfig({ resetAnimationsToken: Date.now() });
                api.saveConfig();
              } catch (err) {
                // ignore
              }

              showToast("Reset to defaults");
            });
          }

          byId("playSelection").addEventListener("click", () => {
            playSelectionFromUI(api);
          });

          byId("stopSelection").addEventListener("click", () => {
            stopAllPlayback(api);
          });

          byId("saveConfig").addEventListener("click", () => {
            try {
              api.saveConfig();
            } catch (err) {
              // ignore
            }

            const selection = getSelection();
            if (
              !selection ||
              selection.type === "none" ||
              !selection.name ||
              selection.name === "none"
            ) {
              invalidateTourPreset();
              showToast("Select a theme/effect before saving tour code", true);
              return;
            }

            const mode = getTourCodeMode();
            const patch = mode === "inline" ? buildTourConfigPatch(api, selection) : null;

            stagedTourPreset = {
              selection: { type: selection.type, name: selection.name },
              mode: mode,
              patch: patch,
              savedAt: Date.now(),
            };

            const modeLabel =
              mode === "inline" ? "self-contained" : "requires effects-pro-config.js";
            setCopyTourCodeEnabled(
              true,
              "Copy tour code (" + modeLabel + ") for " + formatSelectionLabel(selection)
            );
            showToast("Saved. Now click Copy Tour Code");
          });

          byId("exportConfig").addEventListener("click", () => {
            const config = api.getConfig();
            const json = JSON.stringify(config, null, 2);
            const blob = new Blob([json], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "effects-config.json";
            link.click();
            URL.revokeObjectURL(url);
            showToast("Config exported");
          });

          byId("exportConfigJs").addEventListener("click", () => {
            const config = api.getConfig();
            const header =
              "/**\n" +
              " * Effects Pro Configuration\n" +
              " * Generated on " +
              new Date().toLocaleString() +
              "\n" +
              " * Include after effects-core.js in your tour:\n" +
              ' * <script src=\\"visual-effects-pro/effects-pro/effects-core.js\\"><\\\\/script>\n' +
              ' * <script src=\\"visual-effects-pro/effects-pro/effects-pro-config.js\\"><\\\\/script>\n' +
              " */\n\n";
            const body =
              "window.effectsProConfig = " +
              JSON.stringify(config, null, 2) +
              ";\n\n" +
              "if (typeof module !== 'undefined' && module.exports) {\n" +
              "  module.exports = window.effectsProConfig;\n" +
              "}\n\n" +
              "console.log(' Effects Pro config loaded');\n";
            const blob = new Blob([header + body], { type: "application/javascript" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "effects-pro-config.js";
            link.click();
            URL.revokeObjectURL(url);
            showToast("Auto-apply JS exported");
          });

          byId("importConfig").addEventListener("change", (event) => {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (loadEvent) => {
              try {
                invalidateTourPreset();
                const imported = JSON.parse(loadEvent.target.result);
                api.setConfig(imported);
                api.saveConfig();
                applyConfigToUI(api.getConfig());
                api.enableDomOverlay(byId("domEnabled").checked);
                setNowPlaying("none");
                showToast("Config imported");
              } catch (err) {
                showToast("Invalid JSON file", true);
              }
            };
            reader.readAsText(file);
            event.target.value = "";
          });
        }

        waitForApi((api, err) => {
          if (!api) {
            try {
              if (err) {
                // eslint-disable-next-line no-console
                console.error(err);
              }
            } catch (e) {
              // ignore
            }
            const msg =
              err && err.message
                ? "Effects core failed to load: " + String(err.message)
                : "Effects core not loaded";
            showToast(msg, true);
            return;
          }

          const effectsList = api.getEffectsList ? api.getEffectsList() : EFFECTS;
          renderSelectionRadios(effectsList);

          api.loadConfig();
          api.initializeEffects();
          const cfg = api.getConfig ? api.getConfig() : null;
          const defaultsPatch = {};

          if (!cfg || typeof cfg.preferredEffect === "undefined") {
            defaultsPatch.preferredEffect = "none";
          }
          if (!cfg || typeof cfg.preferredTheme === "undefined") {
            defaultsPatch.preferredTheme = "none";
          }
          if (
            !cfg ||
            typeof cfg.aura === "undefined" ||
            cfg.aura === null ||
            typeof cfg.aura !== "object"
          ) {
            defaultsPatch.aura = { enabled: false, level: "none" };
          } else {
            const auraPatch = {};
            if (typeof cfg.aura.enabled === "undefined") auraPatch.enabled = false;
            if (typeof cfg.aura.level === "undefined") auraPatch.level = "none";
            if (Object.keys(auraPatch).length) {
              defaultsPatch.aura = auraPatch;
            }
          }

          if (Object.keys(defaultsPatch).length) {
            api.setConfig(defaultsPatch);
          }

          const config = api.getConfig();
          applyConfigToUI(config);
          api.enableDomOverlay(!!config.enabled);
          if (api.stopAll) {
            api.stopAll();
          } else if (api.stopOverlayTheme) {
            api.stopOverlayTheme();
          }
          setNowPlaying("none");
          updatePlaybackButton(false);

          bindMasterControls(api);
          bindPathControls(api);
          bindSelectionRadios(api);
          bindAuraControls(api);
          bindFireThemeControls(api);
          bindBokehThemeControls(api);
          bindElectricThemeControls(api);
          bindWaterThemeControls(api);
          bindThemeLifetimeControl();
          bindActions(api);
          invalidateTourPreset();
          bindKeyboardShortcuts(api);
          updateDiagnostics(api);
          setInterval(() => updateDiagnostics(api), 1000);
        });
      })();
    </script>
  </body>
</html>
