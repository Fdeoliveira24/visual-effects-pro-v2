<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Effects Pro Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/components/tooltips.css" />
  </head>
  <body>
    <div class="app">
      <button
        class="btn ghost sidebar-open-toggle"
        id="sidebarOpen"
        type="button"
        aria-controls="controlSidebar"
        aria-expanded="false"
      >
        Controls
      </button>

      <header class="hero">
        <div class="eyebrow">Effects Pro</div>
        <h1>Effects Dashboard</h1>
      </header>

      <div class="layout">
        <aside class="sidebar" id="controlSidebar" aria-label="Control Panel">
          <div class="sidebar-head">
            <div class="sidebar-brand" aria-hidden="true">
              <span class="sidebar-brand-label">Controls</span>
            </div>

            <button
              class="btn ghost sidebar-collapse-toggle"
              id="sidebarToggle"
              type="button"
              aria-controls="controlSidebar"
              aria-expanded="true"
              data-tooltip="Collapse controls"
            >
              <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                <path
                  fill="currentColor"
                  d="M10.78 2.72a.75.75 0 0 1 0 1.06L7.56 7l3.22 3.22a.75.75 0 1 1-1.06 1.06L5.97 7.53a.75.75 0 0 1 0-1.06l3.75-3.75a.75.75 0 0 1 1.06 0Z"
                />
              </svg>
              <span class="sr-only">Toggle controls sidebar</span>
            </button>
          </div>

          <div class="sidebar-panels">
            <section class="panel sidebar-panel" style="--delay: 60ms">
              <h2>Playback Controls</h2>
              <div class="row">
                <div class="buttons sidebar-buttons" style="margin-top: 0">
                  <button
                    class="btn secondary"
                    id="playSelection"
                    data-tooltip="Play selection"
                    style="display: inline-flex; align-items: center; gap: 6px"
                  >
                    <svg
                      id="playIcon"
                      viewBox="0 0 16 16"
                      width="14"
                      height="14"
                      fill="currentColor"
                    >
                      <path d="M3 2v12l10-6z" />
                    </svg>
                    <svg
                      id="pauseIcon"
                      viewBox="0 0 16 16"
                      width="14"
                      height="14"
                      fill="currentColor"
                      style="display: none"
                    >
                      <path d="M3 2h3v12H3V2zm7 0h3v12h-3V2z" />
                    </svg>
                    <span class="btn-label" id="playButtonText">Play</span>
                  </button>
                  <button class="btn ghost" id="stopSelection" disabled data-tooltip="Stop">
                    <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                      <path fill="currentColor" d="M4 4h8v8H4V4Z" />
                    </svg>
                    <span class="btn-label">Stop</span>
                  </button>
                  <button
                    class="btn ghost"
                    id="resetAnimation"
                    data-tooltip="Restart current animation"
                  >
                    <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                      <path
                        fill="currentColor"
                        d="M3.5 8a4.5 4.5 0 1 1 1.2 3.1.75.75 0 0 1 1.1-1.02A3 3 0 1 0 5 8H6.5a.5.5 0 0 1 .35.85l-2 2a.5.5 0 0 1-.7 0l-2-2A.5.5 0 0 1 2.5 8H3.5Z"
                      />
                    </svg>
                    <span class="btn-label">Reset</span>
                  </button>
                </div>
                <div class="now-playing" id="nowPlayingWrap" data-active="false">
                  <span class="now-dot"></span>
                  <span>Now playing:</span>
                  <strong id="nowPlaying">None</strong>
                </div>
              </div>
            </section>

            <section class="panel sidebar-panel" style="--delay: 60ms">
              <h2>Persistence</h2>
              <div class="buttons sidebar-buttons" style="margin-top: 0">
                <button class="btn" id="saveConfig" data-tooltip="Save">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M1.75 2A1.75 1.75 0 0 1 3.5.25h7.19c.46 0 .9.18 1.22.5l2.34 2.34c.32.32.5.76.5 1.22V14.5A1.75 1.75 0 0 1 13 16.25H3.5A1.75 1.75 0 0 1 1.75 14.5V2ZM4 1.75v4h7v-4H4Zm0 6.5v6.5h8v-6.5H4Z"
                    />
                  </svg>
                  <span class="btn-label">Save</span>
                </button>
                <button class="btn ghost" id="exportConfig" data-tooltip="Export JSON">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M8 1a.75.75 0 0 1 .75.75V8.19l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72V1.75A.75.75 0 0 1 8 1Zm-6 12a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 13Z"
                    />
                  </svg>
                  <span class="btn-label">Export JSON</span>
                </button>
                <button class="btn ghost" id="exportConfigJs" data-tooltip="Export JS">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M5.75 13.5h5.6a2.65 2.65 0 0 0 .3-5.28 3.75 3.75 0 0 0-7.3-1.1A2.75 2.75 0 0 0 5.75 13.5Zm2.25-2.25a.75.75 0 0 1-.75-.75V7.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 1 1-1.06 1.06l-.97-.97V10.5a.75.75 0 0 1-.75.75Z"
                    />
                  </svg>
                  <span class="btn-label">Export JS</span>
                </button>
              </div>
              <div class="file-row" style="margin-top: 8px">
                <label class="file-input" data-tooltip="Import JSON">
                  <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                    <path
                      fill="currentColor"
                      d="M8 15a.75.75 0 0 1-.75-.75V7.81L5.53 9.53a.75.75 0 1 1-1.06-1.06l3-3a.75.75 0 0 1 1.06 0l3 3a.75.75 0 1 1-1.06 1.06L8.75 7.81v6.44A.75.75 0 0 1 8 15ZM2 3a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 3Z"
                    />
                  </svg>
                  <span class="btn-label">Import JSON</span>
                  <input type="file" id="importConfig" accept="application/json" />
                </label>
              </div>
            </section>
          </div>
        </aside>

        <div class="sidebar-backdrop" id="sidebarBackdrop" hidden></div>

        <main class="grid content-grid">
          <section class="panel span-2" style="--delay: 0ms; display: none">
            <h2>Master Controls</h2>
            <div class="row">
              <label class="toggle">
                <input type="checkbox" id="domEnabled" />
                <span>DOM overlay enabled</span>
              </label>
              <div class="field">
                <label for="mode">Mode</label>
                <select id="mode">
                  <option value="dom">DOM only</option>
                  <option value="button">Button only</option>
                  <option value="both">Both</option>
                </select>
              </div>
              <label class="toggle">
                <input type="checkbox" id="reducedMotion" />
                <span>Respect reduced motion</span>
              </label>
              <div class="field">
                <label for="zIndex">Z-index</label>
                <input type="number" id="zIndex" min="1" max="9999999" />
              </div>
            </div>
          </section>

          <!-- THEMES AND ONE-SHOTS SIDE BY SIDE -->
          <section class="panel" style="--delay: 80ms">
            <h2>Themes</h2>
            <p class="panel-note">
              Continuous background effects that run until stopped. Selecting starts automatically;
              Stop to end.
            </p>
            <div class="radio-section">
              <div class="radio-grid no-scroll" id="themeRadios"></div>
            </div>
            <div style="display: none"><div id="selectionRadios"></div></div>
          </section>

          <section class="panel" style="--delay: 100ms">
            <h2>One-Shot Effects</h2>
            <p class="panel-note">
              Single burst transitions that play once and finish automatically.
            </p>
            <div class="radio-section">
              <div class="radio-grid no-scroll" id="effectRadios"></div>
            </div>
          </section>

          <!-- SETTINGS COLUMN -->
          <section class="panel span-2" style="--delay: 120ms">
            <h2>Settings</h2>
            <p class="panel-note" id="settingsGlobalHint">
              Select a theme or effect above to see its settings.
            </p>

            <!-- Theme Settings - shown when theme selected -->
            <div
              class="subsection"
              id="themeSettingsSection"
              style="display: none; margin-top: 0; padding-top: 0; border-top: none"
            >
              <div class="subhead">Theme Settings</div>
              <div class="row">
                <div class="field">
                  <label for="themeLifetime">Theme lifetime</label>
                  <select id="themeLifetime" data-path="themeLifetime">
                    <option value="permanent">Permanent</option>
                    <option value="timed">Timed</option>
                  </select>
                </div>
                <div class="field">
                  <label for="themeDuration">Theme duration (sec)</label>
                  <input
                    type="number"
                    id="themeDuration"
                    min="5"
                    max="300"
                    data-path="themeDurationSec"
                  />
                </div>
              </div>

              <!-- Snow Theme Controls -->
              <div
                class="theme-controls"
                id="snowThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="snowThemeDirection">Wind direction</label>
                    <select id="snowThemeDirection" data-path="themes.snow.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="snowWindStrength">Wind strength</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowWindStrength"
                        min="0"
                        max="200"
                        step="5"
                        data-path="themes.snow.windStrength"
                        data-output="snowWindStrengthOut"
                      />
                      <output id="snowWindStrengthOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowDrift">Sway amount</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowDrift"
                        min="0"
                        max="60"
                        step="1"
                        data-path="themes.snow.drift"
                        data-output="snowDriftOut"
                      />
                      <output id="snowDriftOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSpeedMin"
                        min="5"
                        max="150"
                        step="1"
                        data-path="themes.snow.speedMin"
                        data-output="snowSpeedMinOut"
                      />
                      <output id="snowSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSpeedMax"
                        min="10"
                        max="200"
                        step="1"
                        data-path="themes.snow.speedMax"
                        data-output="snowSpeedMaxOut"
                      />
                      <output id="snowSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowSizeMin">Flake size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSizeMin"
                        min="1"
                        max="10"
                        step="1"
                        data-path="themes.snow.sizeMin"
                        data-output="snowSizeMinOut"
                      />
                      <output id="snowSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowSizeMax">Flake size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowSizeMax"
                        min="1"
                        max="12"
                        step="1"
                        data-path="themes.snow.sizeMax"
                        data-output="snowSizeMaxOut"
                      />
                      <output id="snowSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowEmissionRate">Density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowEmissionRate"
                        min="2"
                        max="40"
                        step="1"
                        data-path="themes.snow.emissionRate"
                        data-output="snowEmissionRateOut"
                      />
                      <output id="snowEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowMaxParticles">Max flakes</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowMaxParticles"
                        min="50"
                        max="500"
                        step="10"
                        data-path="themes.snow.maxParticles"
                        data-output="snowMaxParticlesOut"
                      />
                      <output id="snowMaxParticlesOut"></output>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Snow Flakes Theme Controls -->
              <div
                class="theme-controls"
                id="snowflakesThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="snowflakesThemeDirection">Wind direction</label>
                    <select id="snowflakesThemeDirection" data-path="themes.snowflakes.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="snowflakesWindStrength">Wind strength</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesWindStrength"
                        min="0"
                        max="200"
                        step="5"
                        data-path="themes.snowflakes.windStrength"
                        data-output="snowflakesWindStrengthOut"
                      />
                      <output id="snowflakesWindStrengthOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesDrift">Sway amount</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesDrift"
                        min="0"
                        max="60"
                        step="1"
                        data-path="themes.snowflakes.drift"
                        data-output="snowflakesDriftOut"
                      />
                      <output id="snowflakesDriftOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSpeedMin"
                        min="5"
                        max="150"
                        step="1"
                        data-path="themes.snowflakes.speedMin"
                        data-output="snowflakesSpeedMinOut"
                      />
                      <output id="snowflakesSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSpeedMax"
                        min="10"
                        max="200"
                        step="1"
                        data-path="themes.snowflakes.speedMax"
                        data-output="snowflakesSpeedMaxOut"
                      />
                      <output id="snowflakesSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesSizeMin">Flake size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSizeMin"
                        min="1"
                        max="10"
                        step="1"
                        data-path="themes.snowflakes.sizeMin"
                        data-output="snowflakesSizeMinOut"
                      />
                      <output id="snowflakesSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesSizeMax">Flake size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesSizeMax"
                        min="1"
                        max="12"
                        step="1"
                        data-path="themes.snowflakes.sizeMax"
                        data-output="snowflakesSizeMaxOut"
                      />
                      <output id="snowflakesSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesEmissionRate">Density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesEmissionRate"
                        min="2"
                        max="40"
                        step="1"
                        data-path="themes.snowflakes.emissionRate"
                        data-output="snowflakesEmissionRateOut"
                      />
                      <output id="snowflakesEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="snowflakesMaxParticles">Max flakes</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="snowflakesMaxParticles"
                        min="50"
                        max="500"
                        step="10"
                        data-path="themes.snowflakes.maxParticles"
                        data-output="snowflakesMaxParticlesOut"
                      />
                      <output id="snowflakesMaxParticlesOut"></output>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Halloween Theme Controls -->
              <div
                class="theme-controls"
                id="halloweenThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="halloweenStyle">Style</label>
                    <select id="halloweenStyle" data-path="themes.halloween.style">
                      <option value="spiders">Spiders (web drop)</option>
                      <option value="emoji">Emoji rain</option>
                      <option value="mixed">Mixed</option>
                      <option value="embers">Embers (legacy)</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="halloweenDirection">Wind direction</label>
                    <select id="halloweenDirection" data-path="themes.halloween.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="halloweenWindStrength">Wind strength</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenWindStrength"
                        min="0"
                        max="220"
                        step="5"
                        data-path="themes.halloween.windStrength"
                        data-output="halloweenWindStrengthOut"
                      />
                      <output id="halloweenWindStrengthOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostCount">Ghost quantity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostCount"
                        min="0"
                        max="12"
                        step="1"
                        data-path="themes.halloween.ghostCount"
                        data-output="halloweenGhostCountOut"
                      />
                      <output id="halloweenGhostCountOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostDirection">Ghost direction</label>
                    <select
                      id="halloweenGhostDirection"
                      data-path="themes.halloween.ghostDirection"
                    >
                      <option value="mixed">Mixed</option>
                      <option value="leftToRight">Left → Right</option>
                      <option value="rightToLeft">Right → Left</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostRandomness">Ghost randomness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostRandomness"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="themes.halloween.ghostRandomness"
                        data-output="halloweenGhostRandomnessOut"
                      />
                      <output id="halloweenGhostRandomnessOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenDrift">Sway amount</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenDrift"
                        min="0"
                        max="80"
                        step="1"
                        data-path="themes.halloween.drift"
                        data-output="halloweenDriftOut"
                      />
                      <output id="halloweenDriftOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSpeedMin"
                        min="5"
                        max="240"
                        step="1"
                        data-path="themes.halloween.speedMin"
                        data-output="halloweenSpeedMinOut"
                      />
                      <output id="halloweenSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSpeedMax"
                        min="10"
                        max="320"
                        step="1"
                        data-path="themes.halloween.speedMax"
                        data-output="halloweenSpeedMaxOut"
                      />
                      <output id="halloweenSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSizeMin"
                        min="10"
                        max="60"
                        step="1"
                        data-path="themes.halloween.sizeMin"
                        data-output="halloweenSizeMinOut"
                      />
                      <output id="halloweenSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenSizeMax"
                        min="12"
                        max="80"
                        step="1"
                        data-path="themes.halloween.sizeMax"
                        data-output="halloweenSizeMaxOut"
                      />
                      <output id="halloweenSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostSizeMin">Ghost size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostSizeMin"
                        min="40"
                        max="220"
                        step="2"
                        data-path="themes.halloween.ghostSizeMin"
                        data-output="halloweenGhostSizeMinOut"
                      />
                      <output id="halloweenGhostSizeMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenGhostSizeMax">Ghost size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenGhostSizeMax"
                        min="50"
                        max="280"
                        step="2"
                        data-path="themes.halloween.ghostSizeMax"
                        data-output="halloweenGhostSizeMaxOut"
                      />
                      <output id="halloweenGhostSizeMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenEmissionRate">Density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenEmissionRate"
                        min="2"
                        max="40"
                        step="1"
                        data-path="themes.halloween.emissionRate"
                        data-output="halloweenEmissionRateOut"
                      />
                      <output id="halloweenEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenMaxParticles">Max items</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenMaxParticles"
                        min="30"
                        max="400"
                        step="10"
                        data-path="themes.halloween.maxParticles"
                        data-output="halloweenMaxParticlesOut"
                      />
                      <output id="halloweenMaxParticlesOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenStringLenMin">Web length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenStringLenMin"
                        min="40"
                        max="800"
                        step="10"
                        data-path="themes.halloween.stringLenMin"
                        data-output="halloweenStringLenMinOut"
                      />
                      <output id="halloweenStringLenMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="halloweenStringLenMax">Web length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="halloweenStringLenMax"
                        min="60"
                        max="900"
                        step="10"
                        data-path="themes.halloween.stringLenMax"
                        data-output="halloweenStringLenMaxOut"
                      />
                      <output id="halloweenStringLenMaxOut"></output>
                    </div>
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  No external images needed (spiders + ghosts are CSS/SVG overlays).
                </p>
              </div>

              <!-- Rain Theme Controls -->
              <div
                class="theme-controls"
                id="rainThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="rainThemeIntensity">Intensity preset</label>
                    <select id="rainThemeIntensity" data-path="themes.rain.intensity">
                      <option value="soft">Soft</option>
                      <option value="medium">Medium</option>
                      <option value="heavy">Heavy</option>
                      <option value="storm">Storm</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="rainThemeDirection">Direction</label>
                    <select id="rainThemeDirection" data-path="themes.rain.direction">
                      <option value="normal">Normal</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                  <label class="toggle" style="min-width: 220px">
                    <input type="checkbox" id="rainSplashes" data-path="themes.rain.splashes" />
                    <span>Enable splashes</span>
                  </label>
                  <div class="field">
                    <label for="rainEmissionRate">Density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainEmissionRate"
                        min="2"
                        max="140"
                        step="1"
                        data-path="themes.rain.emissionRate"
                        data-output="rainEmissionRateOut"
                      />
                      <output id="rainEmissionRateOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainMaxParticles">Max drops</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainMaxParticles"
                        min="50"
                        max="1000"
                        step="10"
                        data-path="themes.rain.maxParticles"
                        data-output="rainMaxParticlesOut"
                      />
                      <output id="rainMaxParticlesOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainSpeedMin">Fall speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainSpeedMin"
                        min="100"
                        max="2200"
                        step="10"
                        data-path="themes.rain.speedMin"
                        data-output="rainSpeedMinOut"
                      />
                      <output id="rainSpeedMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainSpeedMax">Fall speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainSpeedMax"
                        min="150"
                        max="2600"
                        step="10"
                        data-path="themes.rain.speedMax"
                        data-output="rainSpeedMaxOut"
                      />
                      <output id="rainSpeedMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainLengthMin">Drop length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainLengthMin"
                        min="6"
                        max="60"
                        step="1"
                        data-path="themes.rain.lengthMin"
                        data-output="rainLengthMinOut"
                      />
                      <output id="rainLengthMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainLengthMax">Drop length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainLengthMax"
                        min="8"
                        max="80"
                        step="1"
                        data-path="themes.rain.lengthMax"
                        data-output="rainLengthMaxOut"
                      />
                      <output id="rainLengthMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainThicknessMin">Thickness min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainThicknessMin"
                        min="0.5"
                        max="3"
                        step="0.1"
                        data-path="themes.rain.thicknessMin"
                        data-output="rainThicknessMinOut"
                      />
                      <output id="rainThicknessMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainThicknessMax">Thickness max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainThicknessMax"
                        min="0.5"
                        max="3.5"
                        step="0.1"
                        data-path="themes.rain.thicknessMax"
                        data-output="rainThicknessMaxOut"
                      />
                      <output id="rainThicknessMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainDrift">Wind base drift</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainDrift"
                        min="0"
                        max="200"
                        step="5"
                        data-path="themes.rain.drift"
                        data-output="rainDriftOut"
                      />
                      <output id="rainDriftOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainWindVarMin">Wind variance min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainWindVarMin"
                        min="-60"
                        max="0"
                        step="1"
                        data-path="themes.rain.windVarMin"
                        data-output="rainWindVarMinOut"
                      />
                      <output id="rainWindVarMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="rainWindVarMax">Wind variance max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainWindVarMax"
                        min="0"
                        max="60"
                        step="1"
                        data-path="themes.rain.windVarMax"
                        data-output="rainWindVarMaxOut"
                      />
                      <output id="rainWindVarMaxOut"></output>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Storm Theme Controls -->
              <div
                class="theme-controls"
                id="stormThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="row">
                  <div class="field">
                    <label for="stormBackgroundOpacity">Background opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBackgroundOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="themes.storm.backgroundOpacity"
                        data-output="stormBackgroundOpacityOut"
                      />
                      <output id="stormBackgroundOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormLightningCycle">Lightning cycle (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormLightningCycle"
                        min="2000"
                        max="12000"
                        step="250"
                        data-path="themes.storm.lightningCycleMs"
                        data-output="stormLightningCycleOut"
                      />
                      <output id="stormLightningCycleOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormRainCount">Rain count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormRainCount"
                        min="50"
                        max="1600"
                        step="25"
                        data-path="themes.storm.rainCount"
                        data-output="stormRainCountOut"
                      />
                      <output id="stormRainCountOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormWindXMin">Wind X min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormWindXMin"
                        min="-12"
                        max="12"
                        step="0.5"
                        data-path="themes.storm.windXMin"
                        data-output="stormWindXMinOut"
                      />
                      <output id="stormWindXMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormWindXMax">Wind X max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormWindXMax"
                        min="-12"
                        max="12"
                        step="0.5"
                        data-path="themes.storm.windXMax"
                        data-output="stormWindXMaxOut"
                      />
                      <output id="stormWindXMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormSpeedYMin">Fall speed Y min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormSpeedYMin"
                        min="1"
                        max="35"
                        step="0.5"
                        data-path="themes.storm.speedYMin"
                        data-output="stormSpeedYMinOut"
                      />
                      <output id="stormSpeedYMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormSpeedYMax">Fall speed Y max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormSpeedYMax"
                        min="1"
                        max="40"
                        step="0.5"
                        data-path="themes.storm.speedYMax"
                        data-output="stormSpeedYMaxOut"
                      />
                      <output id="stormSpeedYMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormLengthMin">Drop length min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormLengthMin"
                        min="0"
                        max="10"
                        step="0.1"
                        data-path="themes.storm.rainLengthMin"
                        data-output="stormLengthMinOut"
                      />
                      <output id="stormLengthMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormLengthMax">Drop length max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormLengthMax"
                        min="0"
                        max="12"
                        step="0.1"
                        data-path="themes.storm.rainLengthMax"
                        data-output="stormLengthMaxOut"
                      />
                      <output id="stormLengthMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormOpacityMin">Drop opacity min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormOpacityMin"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="themes.storm.rainOpacityMin"
                        data-output="stormOpacityMinOut"
                      />
                      <output id="stormOpacityMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormOpacityMax">Drop opacity max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormOpacityMax"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="themes.storm.rainOpacityMax"
                        data-output="stormOpacityMaxOut"
                      />
                      <output id="stormOpacityMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltStartDelay">Random bolt start (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltStartDelay"
                        min="0"
                        max="20000"
                        step="500"
                        data-path="themes.storm.randomBoltStartDelayMs"
                        data-output="stormBoltStartDelayOut"
                      />
                      <output id="stormBoltStartDelayOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDelayMin">Random bolt delay min (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDelayMin"
                        min="200"
                        max="15000"
                        step="250"
                        data-path="themes.storm.randomBoltDelayMinMs"
                        data-output="stormBoltDelayMinOut"
                      />
                      <output id="stormBoltDelayMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDelayMax">Random bolt delay max (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDelayMax"
                        min="200"
                        max="20000"
                        step="250"
                        data-path="themes.storm.randomBoltDelayMaxMs"
                        data-output="stormBoltDelayMaxOut"
                      />
                      <output id="stormBoltDelayMaxOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDurMin">Bolt duration min (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDurMin"
                        min="60"
                        max="2000"
                        step="25"
                        data-path="themes.storm.randomBoltDurationMinMs"
                        data-output="stormBoltDurMinOut"
                      />
                      <output id="stormBoltDurMinOut"></output>
                    </div>
                  </div>
                  <div class="field">
                    <label for="stormBoltDurMax">Bolt duration max (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="stormBoltDurMax"
                        min="60"
                        max="2500"
                        step="25"
                        data-path="themes.storm.randomBoltDurationMaxMs"
                        data-output="stormBoltDurMaxOut"
                      />
                      <output id="stormBoltDurMaxOut"></output>
                    </div>
                  </div>
                </div>
                <p class="panel-note" style="margin-top: 10px">
                  Tip: keep background opacity low if you want the tour to remain clearly visible
                  under the storm.
                </p>
              </div>

              <!-- Smoke Theme Controls -->
              <div
                class="theme-controls"
                id="smokeThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="smokeThemeIntensity">Smoke intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="smokeThemeIntensity"
                      min="0.1"
                      max="1.0"
                      step="0.05"
                      data-path="themes.smoke.intensity"
                      data-output="smokeThemeIntensityOut"
                    />
                    <output id="smokeThemeIntensityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="smokeThemeSpeed">Smoke speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="smokeThemeSpeed"
                      min="0.3"
                      max="2.0"
                      step="0.1"
                      data-path="themes.smoke.speed"
                      data-output="smokeThemeSpeedOut"
                    />
                    <output id="smokeThemeSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="smokeThemeRiseSoftness">Rise softness</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="smokeThemeRiseSoftness"
                      min="0.1"
                      max="0.6"
                      step="0.05"
                      data-path="themes.smoke.riseSoftness"
                      data-output="smokeThemeRiseSoftnessOut"
                    />
                    <output id="smokeThemeRiseSoftnessOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="smokeThemeDirection">Direction</label>
                  <select id="smokeThemeDirection" data-path="themes.smoke.direction">
                    <option value="up">Up</option>
                    <option value="down">Down</option>
                    <option value="left">Left</option>
                    <option value="right">Right</option>
                  </select>
                </div>
              </div>

              <!-- Burn Theme Controls -->
              <div
                class="theme-controls"
                id="burnThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="burnThemeProgressSpeed">Burn progress speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="burnThemeProgressSpeed"
                      min="0.01"
                      max="2"
                      step="0.01"
                      data-path="themes.burn.progressSpeed"
                      data-output="burnThemeProgressSpeedOut"
                    />
                    <output id="burnThemeProgressSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="burnThemeFlameSpeed">Flame speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="burnThemeFlameSpeed"
                      min="0.1"
                      max="4"
                      step="0.1"
                      data-path="themes.burn.flameSpeed"
                      data-output="burnThemeFlameSpeedOut"
                    />
                    <output id="burnThemeFlameSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="burnThemeBackground">Background</label>
                  <select id="burnThemeBackground" data-path="themes.burn.background">
                    <option value="white">White (burning paper)</option>
                    <option value="transparent">Transparent (fire only)</option>
                  </select>
                </div>
                <div class="field">
                  <label for="burnThemeLoop">Playback</label>
                  <select id="burnThemeLoop" data-path="themes.burn.loop">
                    <option value="true">Loop</option>
                    <option value="false">Play once</option>
                  </select>
                </div>
              </div>

              <!-- Flames Theme Controls -->
              <div
                class="theme-controls"
                id="fireThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="fireThemeIntensity">Intensity (brightness/contrast)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="fireThemeIntensity"
                      min="0.5"
                      max="2"
                      step="0.1"
                      data-path="themes.flames.intensity"
                      data-output="fireThemeIntensityOut"
                    />
                    <output id="fireThemeIntensityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="fireThemeSpeed">Animation speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="fireThemeSpeed"
                      min="0.5"
                      max="3"
                      step="0.1"
                      data-path="themes.flames.speed"
                      data-output="fireThemeSpeedOut"
                    />
                    <output id="fireThemeSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="fireThemeScale">Flame scale (size/height)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="fireThemeScale"
                      min="0.5"
                      max="2"
                      step="0.1"
                      data-path="themes.flames.scale"
                      data-output="fireThemeScaleOut"
                    />
                    <output id="fireThemeScaleOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="fireThemeBackground">Background visibility</label>
                  <select id="fireThemeBackground" data-path="themes.flames.showBackground">
                    <option value="true">Show background (black)</option>
                    <option value="false">Transparent (fire only)</option>
                  </select>
                </div>
              </div>

              <!-- Bokeh Theme Controls -->
              <div
                class="theme-controls"
                id="bokehThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="bokehLightCount">Number of lights</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehLightCount"
                      min="50"
                      max="300"
                      step="10"
                      data-path="themes.bokeh.lightCount"
                      data-output="bokehLightCountOut"
                    />
                    <output id="bokehLightCountOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehLightSize">Light size</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehLightSize"
                      min="50"
                      max="150"
                      step="5"
                      data-path="themes.bokeh.lightSize"
                      data-output="bokehLightSizeOut"
                    />
                    <output id="bokehLightSizeOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehBlurLevel">Blur intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehBlurLevel"
                      min="1"
                      max="5"
                      step="1"
                      data-path="themes.bokeh.blurLevel"
                      data-output="bokehBlurLevelOut"
                    />
                    <output id="bokehBlurLevelOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehSpeed">Animation speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="bokehSpeed"
                      min="0.5"
                      max="2"
                      step="0.1"
                      data-path="themes.bokeh.speed"
                      data-output="bokehSpeedOut"
                    />
                    <output id="bokehSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="bokehPalette">Color palette</label>
                  <select id="bokehPalette" data-path="themes.bokeh.palette">
                    <option value="festive">Festive (Multi-color)</option>
                    <option value="cool">Cool (Blues/Greens)</option>
                    <option value="warm">Warm (Reds/Oranges)</option>
                  </select>
                </div>
              </div>

              <!-- Electric Theme Controls -->
              <div
                class="theme-controls"
                id="electricThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="electricMinDelay">Min delay (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricMinDelay"
                      min="20"
                      max="200"
                      step="10"
                      data-path="themes.electric.minDelay"
                      data-output="electricMinDelayOut"
                    />
                    <output id="electricMinDelayOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricMaxDelay">Max delay (ms)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricMaxDelay"
                      min="200"
                      max="2000"
                      step="50"
                      data-path="themes.electric.maxDelay"
                      data-output="electricMaxDelayOut"
                    />
                    <output id="electricMaxDelayOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricChaosChance">Chaos chance (multi-bolt)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricChaosChance"
                      min="0"
                      max="1"
                      step="0.05"
                      data-path="themes.electric.chaosChance"
                      data-output="electricChaosChanceOut"
                    />
                    <output id="electricChaosChanceOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricBoltColor">Lightning color</label>
                  <input
                    type="color"
                    id="electricBoltColor"
                    data-path="themes.electric.boltColor"
                  />
                </div>
                <div class="field">
                  <label for="electricBranchColor">Branch color</label>
                  <input
                    type="color"
                    id="electricBranchColor"
                    data-path="themes.electric.branchColor"
                  />
                </div>
                <div class="field">
                  <label for="electricFlashIntensity">Flash intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricFlashIntensity"
                      min="0"
                      max="1"
                      step="0.05"
                      data-path="themes.electric.flashIntensity"
                      data-output="electricFlashIntensityOut"
                    />
                    <output id="electricFlashIntensityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricShakeIntensity">Shake intensity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricShakeIntensity"
                      min="0"
                      max="2"
                      step="0.1"
                      data-path="themes.electric.shakeIntensity"
                      data-output="electricShakeIntensityOut"
                    />
                    <output id="electricShakeIntensityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricSparkCount">Spark count</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricSparkCount"
                      min="0"
                      max="50"
                      step="2"
                      data-path="themes.electric.sparkCount"
                      data-output="electricSparkCountOut"
                    />
                    <output id="electricSparkCountOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricBoltWidth">Bolt width</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricBoltWidth"
                      min="1"
                      max="10"
                      step="0.5"
                      data-path="themes.electric.boltWidth"
                      data-output="electricBoltWidthOut"
                    />
                    <output id="electricBoltWidthOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="electricDisplacement">Jaggedness</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="electricDisplacement"
                      min="20"
                      max="300"
                      step="10"
                      data-path="themes.electric.displacement"
                      data-output="electricDisplacementOut"
                    />
                    <output id="electricDisplacementOut"></output>
                  </div>
                </div>
              </div>

              <!-- Water Theme Controls -->
              <div
                class="theme-controls"
                id="waterThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="waterOpacity">Opacity</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterOpacity"
                      min="0.3"
                      max="1"
                      step="0.05"
                      data-path="themes.water.opacity"
                      data-output="waterOpacityOut"
                    />
                    <output id="waterOpacityOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterFlowSpeed">Flow speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterFlowSpeed"
                      min="0.5"
                      max="2.5"
                      step="0.1"
                      data-path="themes.water.flowSpeed"
                      data-output="waterFlowSpeedOut"
                    />
                    <output id="waterFlowSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterDistortion">Distortion (wave intensity)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterDistortion"
                      min="0.01"
                      max="0.15"
                      step="0.01"
                      data-path="themes.water.distortion"
                      data-output="waterDistortionOut"
                    />
                    <output id="waterDistortionOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterSpecular">Specular (highlights)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterSpecular"
                      min="0"
                      max="1"
                      step="0.05"
                      data-path="themes.water.specular"
                      data-output="waterSpecularOut"
                    />
                    <output id="waterSpecularOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterCaustics">Caustics (light patterns)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterCaustics"
                      min="0"
                      max="0.5"
                      step="0.02"
                      data-path="themes.water.caustics"
                      data-output="waterCausticsOut"
                    />
                    <output id="waterCausticsOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterTiling">Detail scale (tiling)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterTiling"
                      min="1"
                      max="5"
                      step="0.2"
                      data-path="themes.water.tiling1"
                      data-output="waterTilingOut"
                    />
                    <output id="waterTilingOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterRotation">Flow angle (rotation)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="waterRotation"
                      min="-45"
                      max="45"
                      step="5"
                      data-path="themes.water.rotate1Deg"
                      data-output="waterRotationOut"
                    />
                    <output id="waterRotationOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="waterTint">Water tint color</label>
                  <input
                    type="color"
                    id="waterTint"
                    data-path="themes.water.tint"
                    value="#78b4dc"
                  />
                </div>
              </div>

              <!-- Spinning Rays Theme Controls -->
              <div
                class="theme-controls"
                id="spinningRaysThemeControls"
                style="display: none; margin-top: 12px"
              >
                <div class="field">
                  <label for="spinningRaysNumRays">Number of rays</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysNumRays"
                      min="1"
                      max="240"
                      step="1"
                      data-path="themes.spinningRays.numRays"
                      data-output="spinningRaysNumRaysOut"
                    />
                    <output id="spinningRaysNumRaysOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysTrailAlpha">Trail fade</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysTrailAlpha"
                      min="0.01"
                      max="0.6"
                      step="0.01"
                      data-path="themes.spinningRays.trailAlpha"
                      data-output="spinningRaysTrailAlphaOut"
                    />
                    <output id="spinningRaysTrailAlphaOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCenterMode">Center mode</label>
                  <select id="spinningRaysCenterMode" data-path="themes.spinningRays.centerMode">
                    <option value="center">Center</option>
                    <option value="random">Random</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                <div class="field">
                  <label for="spinningRaysCenterX">Center X (%)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCenterX"
                      min="0"
                      max="100"
                      step="1"
                      data-path="themes.spinningRays.centerXPercent"
                      data-output="spinningRaysCenterXOut"
                    />
                    <output id="spinningRaysCenterXOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCenterY">Center Y (%)</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCenterY"
                      min="0"
                      max="100"
                      step="1"
                      data-path="themes.spinningRays.centerYPercent"
                      data-output="spinningRaysCenterYOut"
                    />
                    <output id="spinningRaysCenterYOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysHueSpeed">Hue speed</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysHueSpeed"
                      min="-8"
                      max="8"
                      step="0.25"
                      data-path="themes.spinningRays.hueSpeed"
                      data-output="spinningRaysHueSpeedOut"
                    />
                    <output id="spinningRaysHueSpeedOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysHueRange">Hue range</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysHueRange"
                      min="0"
                      max="240"
                      step="1"
                      data-path="themes.spinningRays.hueRange"
                      data-output="spinningRaysHueRangeOut"
                    />
                    <output id="spinningRaysHueRangeOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysSaturation">Saturation</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysSaturation"
                      min="0"
                      max="100"
                      step="1"
                      data-path="themes.spinningRays.saturation"
                      data-output="spinningRaysSaturationOut"
                    />
                    <output id="spinningRaysSaturationOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysLightness">Lightness</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysLightness"
                      min="0"
                      max="100"
                      step="1"
                      data-path="themes.spinningRays.lightness"
                      data-output="spinningRaysLightnessOut"
                    />
                    <output id="spinningRaysLightnessOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysGlowBlur">Glow blur</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysGlowBlur"
                      min="0"
                      max="120"
                      step="1"
                      data-path="themes.spinningRays.glowBlur"
                      data-output="spinningRaysGlowBlurOut"
                    />
                    <output id="spinningRaysGlowBlurOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysBaseLineWidth">Base line width</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysBaseLineWidth"
                      min="0"
                      max="12"
                      step="0.25"
                      data-path="themes.spinningRays.baseLineWidth"
                      data-output="spinningRaysBaseLineWidthOut"
                    />
                    <output id="spinningRaysBaseLineWidthOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysLineWidthFactor">Line width factor</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysLineWidthFactor"
                      min="1"
                      max="240"
                      step="1"
                      data-path="themes.spinningRays.lineWidthFactor"
                      data-output="spinningRaysLineWidthFactorOut"
                    />
                    <output id="spinningRaysLineWidthFactorOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysAngularVelMin">Angular vel min</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysAngularVelMin"
                      min="0"
                      max="0.01"
                      step="0.0001"
                      data-path="themes.spinningRays.angularVelMin"
                      data-output="spinningRaysAngularVelMinOut"
                    />
                    <output id="spinningRaysAngularVelMinOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysAngularVelMax">Angular vel max</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysAngularVelMax"
                      min="0"
                      max="0.02"
                      step="0.0001"
                      data-path="themes.spinningRays.angularVelMax"
                      data-output="spinningRaysAngularVelMaxOut"
                    />
                    <output id="spinningRaysAngularVelMaxOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysWaveAccel">Wave accel</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysWaveAccel"
                      min="0"
                      max="0.01"
                      step="0.0001"
                      data-path="themes.spinningRays.waveAccel"
                      data-output="spinningRaysWaveAccelOut"
                    />
                    <output id="spinningRaysWaveAccelOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysRadiantMax">Radiant max</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysRadiantMax"
                      min="0"
                      max="2"
                      step="0.01"
                      data-path="themes.spinningRays.radiantMax"
                      data-output="spinningRaysRadiantMaxOut"
                    />
                    <output id="spinningRaysRadiantMaxOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCircleMax">Circle max count</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCircleMax"
                      min="8"
                      max="200"
                      step="1"
                      data-path="themes.spinningRays.circleMaxCount"
                      data-output="spinningRaysCircleMaxOut"
                    />
                    <output id="spinningRaysCircleMaxOut"></output>
                  </div>
                </div>
                <div class="field">
                  <label for="spinningRaysCircleRadiusFactor">Circle radius factor</label>
                  <div class="range-row">
                    <input
                      type="range"
                      id="spinningRaysCircleRadiusFactor"
                      min="0.25"
                      max="6"
                      step="0.05"
                      data-path="themes.spinningRays.circleRadiusFactor"
                      data-output="spinningRaysCircleRadiusFactorOut"
                    />
                    <output id="spinningRaysCircleRadiusFactorOut"></output>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sine Waves Theme Controls -->
            <div
              class="theme-controls"
              id="sineWavesThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="field">
                <label for="sineWavesSpeed">Speed</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesSpeed"
                    min="-20"
                    max="20"
                    step="0.25"
                    data-path="themes.sineWaves.speed"
                    data-output="sineWavesSpeedOut"
                  />
                  <output id="sineWavesSpeedOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesCenterY">Center Y (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesCenterY"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.sineWaves.centerYPercent"
                    data-output="sineWavesCenterYOut"
                  />
                  <output id="sineWavesCenterYOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWaveWidth">Wave width (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWaveWidth"
                    min="10"
                    max="100"
                    step="1"
                    data-path="themes.sineWaves.waveWidthPercent"
                    data-output="sineWavesWaveWidthOut"
                  />
                  <output id="sineWavesWaveWidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWaveLeft">Wave left (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWaveLeft"
                    min="0"
                    max="45"
                    step="0.5"
                    data-path="themes.sineWaves.waveLeftPercent"
                    data-output="sineWavesWaveLeftOut"
                  />
                  <output id="sineWavesWaveLeftOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesClearMode">Clear mode</label>
                <select id="sineWavesClearMode" data-path="themes.sineWaves.clearMode">
                  <option value="clear">Clear (no trails)</option>
                  <option value="trails">Trails</option>
                </select>
              </div>
              <div class="field">
                <label for="sineWavesTrailAlpha">Trail alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesTrailAlpha"
                    min="0.01"
                    max="0.6"
                    step="0.01"
                    data-path="themes.sineWaves.trailAlpha"
                    data-output="sineWavesTrailAlphaOut"
                  />
                  <output id="sineWavesTrailAlphaOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesSegDefault">Default segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesSegDefault"
                    min="1"
                    max="60"
                    step="1"
                    data-path="themes.sineWaves.segmentLengthDefault"
                    data-output="sineWavesSegDefaultOut"
                  />
                  <output id="sineWavesSegDefaultOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesComposite">Blend</label>
                <select id="sineWavesComposite" data-path="themes.sineWaves.compositeOperation">
                  <option value="lighter">Glow (lighter)</option>
                  <option value="source-over">Normal</option>
                </select>
              </div>
              <div class="field">
                <label for="sineWavesColorMode">Color mode</label>
                <select id="sineWavesColorMode" data-path="themes.sineWaves.colorMode">
                  <option value="gradient">Gradient</option>
                  <option value="solid">Solid</option>
                </select>
              </div>
              <div class="field">
                <label for="sineWavesStrokeColor">Solid stroke color (CSS)</label>
                <input
                  type="text"
                  id="sineWavesStrokeColor"
                  data-path="themes.sineWaves.strokeColor"
                />
              </div>
              <div class="field">
                <label for="sineWavesGradHue">Gradient hue</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradHue"
                    min="0"
                    max="360"
                    step="1"
                    data-path="themes.sineWaves.gradientHue"
                    data-output="sineWavesGradHueOut"
                  />
                  <output id="sineWavesGradHueOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradSat">Gradient saturation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradSat"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.sineWaves.gradientSaturation"
                    data-output="sineWavesGradSatOut"
                  />
                  <output id="sineWavesGradSatOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradLight">Gradient lightness</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradLight"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.sineWaves.gradientLightness"
                    data-output="sineWavesGradLightOut"
                  />
                  <output id="sineWavesGradLightOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradStartA">Gradient start alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradStartA"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="themes.sineWaves.gradientStartAlpha"
                    data-output="sineWavesGradStartAOut"
                  />
                  <output id="sineWavesGradStartAOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradMidA">Gradient mid alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradMidA"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="themes.sineWaves.gradientMidAlpha"
                    data-output="sineWavesGradMidAOut"
                  />
                  <output id="sineWavesGradMidAOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesGradEndA">Gradient end alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesGradEndA"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="themes.sineWaves.gradientEndAlpha"
                    data-output="sineWavesGradEndAOut"
                  />
                  <output id="sineWavesGradEndAOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Waves</div>
              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave1Enabled"
                    data-path="themes.sineWaves.wave1Enabled"
                  />
                  <span>Wave 1 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave1Amp">Wave 1 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="themes.sineWaves.wave1Amplitude"
                    data-output="sineWavesWave1AmpOut"
                  />
                  <output id="sineWavesWave1AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Wavelength">Wave 1 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="themes.sineWaves.wave1Wavelength"
                    data-output="sineWavesWave1WavelengthOut"
                  />
                  <output id="sineWavesWave1WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Width">Wave 1 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="themes.sineWaves.wave1LineWidth"
                    data-output="sineWavesWave1WidthOut"
                  />
                  <output id="sineWavesWave1WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Seg">Wave 1 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="themes.sineWaves.wave1SegmentLength"
                    data-output="sineWavesWave1SegOut"
                  />
                  <output id="sineWavesWave1SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave1Time">Wave 1 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave1Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="themes.sineWaves.wave1TimeModifier"
                    data-output="sineWavesWave1TimeOut"
                  />
                  <output id="sineWavesWave1TimeOut"></output>
                </div>
              </div>

              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave2Enabled"
                    data-path="themes.sineWaves.wave2Enabled"
                  />
                  <span>Wave 2 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave2Amp">Wave 2 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="themes.sineWaves.wave2Amplitude"
                    data-output="sineWavesWave2AmpOut"
                  />
                  <output id="sineWavesWave2AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Wavelength">Wave 2 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="themes.sineWaves.wave2Wavelength"
                    data-output="sineWavesWave2WavelengthOut"
                  />
                  <output id="sineWavesWave2WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Width">Wave 2 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="themes.sineWaves.wave2LineWidth"
                    data-output="sineWavesWave2WidthOut"
                  />
                  <output id="sineWavesWave2WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Seg">Wave 2 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="themes.sineWaves.wave2SegmentLength"
                    data-output="sineWavesWave2SegOut"
                  />
                  <output id="sineWavesWave2SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave2Time">Wave 2 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave2Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="themes.sineWaves.wave2TimeModifier"
                    data-output="sineWavesWave2TimeOut"
                  />
                  <output id="sineWavesWave2TimeOut"></output>
                </div>
              </div>

              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave3Enabled"
                    data-path="themes.sineWaves.wave3Enabled"
                  />
                  <span>Wave 3 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave3Amp">Wave 3 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="themes.sineWaves.wave3Amplitude"
                    data-output="sineWavesWave3AmpOut"
                  />
                  <output id="sineWavesWave3AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Wavelength">Wave 3 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="themes.sineWaves.wave3Wavelength"
                    data-output="sineWavesWave3WavelengthOut"
                  />
                  <output id="sineWavesWave3WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Width">Wave 3 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="themes.sineWaves.wave3LineWidth"
                    data-output="sineWavesWave3WidthOut"
                  />
                  <output id="sineWavesWave3WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Seg">Wave 3 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="themes.sineWaves.wave3SegmentLength"
                    data-output="sineWavesWave3SegOut"
                  />
                  <output id="sineWavesWave3SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave3Time">Wave 3 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave3Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="themes.sineWaves.wave3TimeModifier"
                    data-output="sineWavesWave3TimeOut"
                  />
                  <output id="sineWavesWave3TimeOut"></output>
                </div>
              </div>

              <div class="field">
                <label class="toggle">
                  <input
                    type="checkbox"
                    id="sineWavesWave4Enabled"
                    data-path="themes.sineWaves.wave4Enabled"
                  />
                  <span>Wave 4 enabled</span>
                </label>
              </div>
              <div class="field">
                <label for="sineWavesWave4Amp">Wave 4 amplitude</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Amp"
                    min="-300"
                    max="300"
                    step="1"
                    data-path="themes.sineWaves.wave4Amplitude"
                    data-output="sineWavesWave4AmpOut"
                  />
                  <output id="sineWavesWave4AmpOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Wavelength">Wave 4 wavelength</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Wavelength"
                    min="10"
                    max="600"
                    step="1"
                    data-path="themes.sineWaves.wave4Wavelength"
                    data-output="sineWavesWave4WavelengthOut"
                  />
                  <output id="sineWavesWave4WavelengthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Width">Wave 4 line width</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Width"
                    min="0.1"
                    max="10"
                    step="0.1"
                    data-path="themes.sineWaves.wave4LineWidth"
                    data-output="sineWavesWave4WidthOut"
                  />
                  <output id="sineWavesWave4WidthOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Seg">Wave 4 segment length</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Seg"
                    min="1"
                    max="60"
                    step="1"
                    data-path="themes.sineWaves.wave4SegmentLength"
                    data-output="sineWavesWave4SegOut"
                  />
                  <output id="sineWavesWave4SegOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="sineWavesWave4Time">Wave 4 time modifier</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="sineWavesWave4Time"
                    min="-4"
                    max="4"
                    step="0.05"
                    data-path="themes.sineWaves.wave4TimeModifier"
                    data-output="sineWavesWave4TimeOut"
                  />
                  <output id="sineWavesWave4TimeOut"></output>
                </div>
              </div>
            </div>

            <!-- Flowers Theme Controls -->
            <div
              class="theme-controls"
              id="flowersThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="subhead" style="margin-bottom: 10px">Flowers</div>

              <div class="field">
                <label for="flowersStyle">Petal style</label>
                <select id="flowersStyle" data-path="themes.flowers.style">
                  <option value="ellipse">Ellipse</option>
                  <option value="path">Path</option>
                  <option value="rounded">Rounded</option>
                  <option value="random">Random mix</option>
                </select>
              </div>

              <div class="field">
                <label for="flowersSpawnMode">Spawn mode</label>
                <select id="flowersSpawnMode" data-path="themes.flowers.spawnMode">
                  <option value="random">Random</option>
                  <option value="bottomBand">Bottom band</option>
                  <option value="custom">Custom cluster</option>
                </select>
              </div>

              <div class="field">
                <label for="flowersSpawnRate">Spawn rate (per sec)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSpawnRate"
                    min="0"
                    max="5"
                    step="0.05"
                    data-path="themes.flowers.spawnRatePerSec"
                    data-output="flowersSpawnRateOut"
                  />
                  <output id="flowersSpawnRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersInitialBurst">Initial burst</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersInitialBurst"
                    min="0"
                    max="20"
                    step="1"
                    data-path="themes.flowers.initialBurst"
                    data-output="flowersInitialBurstOut"
                  />
                  <output id="flowersInitialBurstOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersMax">Max flowers</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersMax"
                    min="0"
                    max="200"
                    step="1"
                    data-path="themes.flowers.maxFlowers"
                    data-output="flowersMaxOut"
                  />
                  <output id="flowersMaxOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Placement</div>

              <div class="field">
                <label for="flowersXPad">X padding (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersXPad"
                    min="0"
                    max="45"
                    step="0.5"
                    data-path="themes.flowers.xPaddingPercent"
                    data-output="flowersXPadOut"
                  />
                  <output id="flowersXPadOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersYMin">Y min (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersYMin"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.yMinPercent"
                    data-output="flowersYMinOut"
                  />
                  <output id="flowersYMinOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersYMax">Y max (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersYMax"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.yMaxPercent"
                    data-output="flowersYMaxOut"
                  />
                  <output id="flowersYMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCustomX">Custom X (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCustomX"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.customXPercent"
                    data-output="flowersCustomXOut"
                  />
                  <output id="flowersCustomXOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCustomY">Custom Y (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCustomY"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.customYPercent"
                    data-output="flowersCustomYOut"
                  />
                  <output id="flowersCustomYOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersSpreadX">Spread X (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSpreadX"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.spreadXPercent"
                    data-output="flowersSpreadXOut"
                  />
                  <output id="flowersSpreadXOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersSpreadY">Spread Y (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSpreadY"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.spreadYPercent"
                    data-output="flowersSpreadYOut"
                  />
                  <output id="flowersSpreadYOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Lifecycle</div>

              <div class="field">
                <label for="flowersBloomMs">Bloom duration (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBloomMs"
                    min="200"
                    max="6000"
                    step="50"
                    data-path="themes.flowers.bloomDurationMs"
                    data-output="flowersBloomMsOut"
                  />
                  <output id="flowersBloomMsOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersLifeMs">Life (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersLifeMs"
                    min="0"
                    max="60000"
                    step="250"
                    data-path="themes.flowers.lifeMs"
                    data-output="flowersLifeMsOut"
                  />
                  <output id="flowersLifeMsOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersFadeMs">Fade out (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersFadeMs"
                    min="0"
                    max="10000"
                    step="50"
                    data-path="themes.flowers.fadeOutMs"
                    data-output="flowersFadeMsOut"
                  />
                  <output id="flowersFadeMsOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Geometry</div>

              <div class="field">
                <label for="flowersSizeMin">Size min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSizeMin"
                    min="5"
                    max="200"
                    step="1"
                    data-path="themes.flowers.sizeMin"
                    data-output="flowersSizeMinOut"
                  />
                  <output id="flowersSizeMinOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="flowersSizeMax">Size max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersSizeMax"
                    min="5"
                    max="300"
                    step="1"
                    data-path="themes.flowers.sizeMax"
                    data-output="flowersSizeMaxOut"
                  />
                  <output id="flowersSizeMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersWobbleAmp">Sway amplitude (deg)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersWobbleAmp"
                    min="0"
                    max="20"
                    step="0.25"
                    data-path="themes.flowers.wobbleAmpPx"
                    data-output="flowersWobbleAmpOut"
                  />
                  <output id="flowersWobbleAmpOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersWobbleFreq">Sway speed</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersWobbleFreq"
                    min="0"
                    max="30"
                    step="0.5"
                    data-path="themes.flowers.wobbleFreq"
                    data-output="flowersWobbleFreqOut"
                  />
                  <output id="flowersWobbleFreqOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Petals</div>

              <div class="field">
                <label for="flowersPetalMin">Petal count min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalMin"
                    min="1"
                    max="24"
                    step="1"
                    data-path="themes.flowers.petalCountMin"
                    data-output="flowersPetalMinOut"
                  />
                  <output id="flowersPetalMinOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="flowersPetalMax">Petal count max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalMax"
                    min="1"
                    max="24"
                    step="1"
                    data-path="themes.flowers.petalCountMax"
                    data-output="flowersPetalMaxOut"
                  />
                  <output id="flowersPetalMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersBackPetalMin">Back petal count min</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBackPetalMin"
                    min="1"
                    max="24"
                    step="1"
                    data-path="themes.flowers.backPetalCountMin"
                    data-output="flowersBackPetalMinOut"
                  />
                  <output id="flowersBackPetalMinOut"></output>
                </div>
              </div>
              <div class="field">
                <label for="flowersBackPetalMax">Back petal count max</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBackPetalMax"
                    min="1"
                    max="24"
                    step="1"
                    data-path="themes.flowers.backPetalCountMax"
                    data-output="flowersBackPetalMaxOut"
                  />
                  <output id="flowersBackPetalMaxOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersBackScale">Back scale</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersBackScale"
                    min="0.2"
                    max="3"
                    step="0.05"
                    data-path="themes.flowers.backScale"
                    data-output="flowersBackScaleOut"
                  />
                  <output id="flowersBackScaleOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersFrontScale">Front scale</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersFrontScale"
                    min="0.2"
                    max="3"
                    step="0.05"
                    data-path="themes.flowers.frontScale"
                    data-output="flowersFrontScaleOut"
                  />
                  <output id="flowersFrontScaleOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Palette</div>

              <div class="field">
                <label for="flowersPaletteMode">Palette mode</label>
                <select id="flowersPaletteMode" data-path="themes.flowers.paletteMode">
                  <option value="magenta">Magenta</option>
                  <option value="randomHsl">Random HSL</option>
                  <option value="custom">Custom</option>
                </select>
              </div>

              <div class="field">
                <label for="flowersPetalHue">Petal hue</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalHue"
                    min="0"
                    max="360"
                    step="1"
                    data-path="themes.flowers.petalHue"
                    data-output="flowersPetalHueOut"
                  />
                  <output id="flowersPetalHueOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalHueVar">Petal hue variance</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalHueVar"
                    min="0"
                    max="180"
                    step="1"
                    data-path="themes.flowers.petalHueVariance"
                    data-output="flowersPetalHueVarOut"
                  />
                  <output id="flowersPetalHueVarOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalSat">Petal saturation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalSat"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.petalSaturation"
                    data-output="flowersPetalSatOut"
                  />
                  <output id="flowersPetalSatOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalLight">Petal lightness</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalLight"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.flowers.petalLightness"
                    data-output="flowersPetalLightOut"
                  />
                  <output id="flowersPetalLightOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalAlpha">Petal alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalAlpha"
                    min="0"
                    max="1"
                    step="0.01"
                    data-path="themes.flowers.petalAlpha"
                    data-output="flowersPetalAlphaOut"
                  />
                  <output id="flowersPetalAlphaOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Glow</div>

              <div class="field">
                <label for="flowersPetalGlowFront">Petal glow (front)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalGlowFront"
                    min="0"
                    max="120"
                    step="1"
                    data-path="themes.flowers.petalGlowBlurFront"
                    data-output="flowersPetalGlowFrontOut"
                  />
                  <output id="flowersPetalGlowFrontOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalGlowBack">Petal glow (back)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalGlowBack"
                    min="0"
                    max="80"
                    step="1"
                    data-path="themes.flowers.petalGlowBlurBack"
                    data-output="flowersPetalGlowBackOut"
                  />
                  <output id="flowersPetalGlowBackOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCenterGlow">Center glow blur</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCenterGlow"
                    min="0"
                    max="120"
                    step="1"
                    data-path="themes.flowers.centerGlowBlur"
                    data-output="flowersCenterGlowOut"
                  />
                  <output id="flowersCenterGlowOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersPetalHighlight">Petal highlight alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersPetalHighlight"
                    min="0"
                    max="1"
                    step="0.01"
                    data-path="themes.flowers.petalHighlightAlpha"
                    data-output="flowersPetalHighlightOut"
                  />
                  <output id="flowersPetalHighlightOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="flowersCenterHighlight">Center highlight alpha</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="flowersCenterHighlight"
                    min="0"
                    max="1"
                    step="0.01"
                    data-path="themes.flowers.centerHighlightAlpha"
                    data-output="flowersCenterHighlightOut"
                  />
                  <output id="flowersCenterHighlightOut"></output>
                </div>
              </div>
            </div>

            <!-- Falling Stars Theme Controls -->
            <div
              class="theme-controls"
              id="fallingStarsThemeControls"
              style="display: none; margin-top: 12px"
            >
              <div class="subhead" style="margin-bottom: 10px">Falling Stars</div>

              <div class="field">
                <label for="fallingStarsTheme">Color theme</label>
                <select id="fallingStarsTheme" data-path="themes.fallingStars.theme">
                  <option value="blue">Blue</option>
                  <option value="purple">Purple</option>
                  <option value="red">Red</option>
                  <option value="orange">Orange</option>
                  <option value="mix">Mixed</option>
                </select>
              </div>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsUseCustomColor"
                  data-path="themes.fallingStars.useCustomColor"
                />
                <span>Use custom color</span>
              </label>

              <div class="field">
                <label for="fallingStarsCustomColorHex">Custom color</label>
                <input
                  type="color"
                  id="fallingStarsCustomColorHex"
                  data-path="themes.fallingStars.customColorHex"
                />
              </div>

              <div class="field">
                <label for="fallingStarsSpawnMode">Spawn mode</label>
                <select id="fallingStarsSpawnMode" data-path="themes.fallingStars.spawnMode">
                  <option value="rain">Rain (from top)</option>
                  <option value="mouse">Mouse trail</option>
                  <option value="both">Both</option>
                </select>
              </div>

              <div class="field">
                <label for="fallingStarsSpawnRate">Spawn rate (ms)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsSpawnRate"
                    min="5"
                    max="100"
                    step="1"
                    data-path="themes.fallingStars.spawnRate"
                    data-output="fallingStarsSpawnRateOut"
                  />
                  <output id="fallingStarsSpawnRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsMaxParticles">Max particles</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsMaxParticles"
                    min="30"
                    max="600"
                    step="10"
                    data-path="themes.fallingStars.maxParticles"
                    data-output="fallingStarsMaxParticlesOut"
                  />
                  <output id="fallingStarsMaxParticlesOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsBaseSize">Base star size</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsBaseSize"
                    min="5"
                    max="50"
                    step="1"
                    data-path="themes.fallingStars.baseSize"
                    data-output="fallingStarsBaseSizeOut"
                  />
                  <output id="fallingStarsBaseSizeOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsSizeVariation">Size variation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsSizeVariation"
                    min="0"
                    max="1"
                    step="0.05"
                    data-path="themes.fallingStars.sizeVariation"
                    data-output="fallingStarsSizeVariationOut"
                  />
                  <output id="fallingStarsSizeVariationOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Physics</div>

              <div class="field">
                <label for="fallingStarsGravity">Gravity</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsGravity"
                    min="0"
                    max="0.05"
                    step="0.001"
                    data-path="themes.fallingStars.gravity"
                    data-output="fallingStarsGravityOut"
                  />
                  <output id="fallingStarsGravityOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsMaxVelocity">Max velocity</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsMaxVelocity"
                    min="1"
                    max="20"
                    step="0.5"
                    data-path="themes.fallingStars.maxVelocity"
                    data-output="fallingStarsMaxVelocityOut"
                  />
                  <output id="fallingStarsMaxVelocityOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsVelocityVariation">Velocity variation</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsVelocityVariation"
                    min="0"
                    max="10"
                    step="0.5"
                    data-path="themes.fallingStars.velocityVariation"
                    data-output="fallingStarsVelocityVariationOut"
                  />
                  <output id="fallingStarsVelocityVariationOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsRotationSpeed">Rotation speed</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsRotationSpeed"
                    min="0"
                    max="0.5"
                    step="0.01"
                    data-path="themes.fallingStars.rotationSpeed"
                    data-output="fallingStarsRotationSpeedOut"
                  />
                  <output id="fallingStarsRotationSpeedOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Animation</div>

              <div class="field">
                <label for="fallingStarsFadeStartPercent">Fade/shrink start (%)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsFadeStartPercent"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.fallingStars.fadeStartPercent"
                    data-output="fallingStarsFadeStartPercentOut"
                  />
                  <output id="fallingStarsFadeStartPercentOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsShrinkRate">Shrink rate</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsShrinkRate"
                    min="0"
                    max="0.1"
                    step="0.005"
                    data-path="themes.fallingStars.shrinkRate"
                    data-output="fallingStarsShrinkRateOut"
                  />
                  <output id="fallingStarsShrinkRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsFadeRate">Fade rate</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsFadeRate"
                    min="0"
                    max="0.1"
                    step="0.005"
                    data-path="themes.fallingStars.fadeRate"
                    data-output="fallingStarsFadeRateOut"
                  />
                  <output id="fallingStarsFadeRateOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsShadowBlur">Glow intensity</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsShadowBlur"
                    min="0"
                    max="50"
                    step="1"
                    data-path="themes.fallingStars.shadowBlur"
                    data-output="fallingStarsShadowBlurOut"
                  />
                  <output id="fallingStarsShadowBlurOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Interaction</div>

              <div class="field">
                <label for="fallingStarsMouseRandomness">Mouse jitter</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsMouseRandomness"
                    min="0"
                    max="100"
                    step="1"
                    data-path="themes.fallingStars.mouseRandomness"
                    data-output="fallingStarsMouseRandomnessOut"
                  />
                  <output id="fallingStarsMouseRandomnessOut"></output>
                </div>
              </div>

              <div class="field">
                <label for="fallingStarsExplosionSize">Explosion size (stars per click)</label>
                <div class="range-row">
                  <input
                    type="range"
                    id="fallingStarsExplosionSize"
                    min="10"
                    max="200"
                    step="5"
                    data-path="themes.fallingStars.explosionSize"
                    data-output="fallingStarsExplosionSizeOut"
                  />
                  <output id="fallingStarsExplosionSizeOut"></output>
                </div>
              </div>

              <div class="subhead" style="margin-top: 10px">Options</div>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsMouseTrail"
                  data-path="themes.fallingStars.mouseTrail"
                />
                <span>Mouse trail enabled</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsClickExplosion"
                  data-path="themes.fallingStars.clickExplosion"
                />
                <span>Click explosion enabled</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsScreenBlend"
                  data-path="themes.fallingStars.screenBlend"
                />
                <span>Screen blend mode</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsReverse"
                  data-path="themes.fallingStars.reverse"
                />
                <span>Reverse (float up)</span>
              </label>

              <label class="toggle">
                <input
                  type="checkbox"
                  id="fallingStarsCircleClip"
                  data-path="themes.fallingStars.useCircleClip"
                />
                <span>Circle clip</span>
              </label>
            </div>

            <!-- Effect Settings - shown when effect selected -->
            <div class="subsection" id="effectSettingsSection" style="display: none">
              <div class="subhead">Effect Tuning</div>
              <p class="panel-note" id="settingsHint">
                Adjusting settings for the selected effect.
              </p>
              <div class="settings-empty" id="settingsEmpty" style="display: none">
                No adjustable settings for this effect.
              </div>

              <details class="settings-group" data-group="transitions" open>
                <summary>Transitions</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="flash">
                    <label for="flashDuration">Flash duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="flashDuration"
                        min="80"
                        max="1200"
                        step="20"
                        data-path="effects.flash.durationMs"
                        data-output="flashDurationOut"
                      />
                      <output id="flashDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeDuration">Fade duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fadeDuration"
                        min="150"
                        max="12000"
                        step="50"
                        data-path="effects.fade.durationMs"
                        data-output="fadeDurationOut"
                      />
                      <output id="fadeDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeColorHex">Fade color</label>
                    <input type="color" id="fadeColorHex" data-path="effects.fade.colorHex" />
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeOpacity">Fade opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fadeOpacity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.fade.opacity"
                        data-output="fadeOpacityOut"
                      />
                      <output id="fadeOpacityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeEasing">Fade easing</label>
                    <select id="fadeEasing" data-path="effects.fade.easing">
                      <option value="standard">Standard</option>
                      <option value="linear">Linear</option>
                      <option value="easeInOut">Ease In Out</option>
                      <option value="easeOut">Ease Out</option>
                      <option value="easeIn">Ease In</option>
                    </select>
                  </div>

                  <div class="field" data-effect="fade">
                    <label for="fadeBlendMode">Blend mode</label>
                    <select id="fadeBlendMode" data-path="effects.fade.blendMode">
                      <option value="normal">Normal</option>
                      <option value="multiply">Multiply</option>
                      <option value="screen">Screen</option>
                      <option value="overlay">Overlay</option>
                      <option value="soft-light">Soft Light</option>
                    </select>
                  </div>
                  <div class="field" data-effect="sweep">
                    <label for="sweepDuration">Sweep duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="sweepDuration"
                        min="200"
                        max="2000"
                        step="20"
                        data-path="effects.sweep.durationMs"
                        data-output="sweepDurationOut"
                      />
                      <output id="sweepDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="sweep">
                    <label for="sweepDirection">Sweep direction</label>
                    <select id="sweepDirection" data-path="effects.sweep.direction">
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                      <option value="top">Top</option>
                      <option value="bottom">Bottom</option>
                    </select>
                  </div>

                  <div class="field" data-effect="sweep">
                    <label for="sweepColor">Sweep color</label>
                    <input type="color" id="sweepColor" data-path="effects.sweep.color" />
                  </div>
                  <div class="field" data-effect="cinema">
                    <label for="cinemaHeight">Cinema bar height (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="cinemaHeight"
                        min="6"
                        max="25"
                        step="1"
                        data-path="effects.cinema.barHeightPercent"
                        data-output="cinemaHeightOut"
                      />
                      <output id="cinemaHeightOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="cinema">
                    <label for="cinemaDuration">Cinema duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="cinemaDuration"
                        min="200"
                        max="2000"
                        step="20"
                        data-path="effects.cinema.durationMs"
                        data-output="cinemaDurationOut"
                      />
                      <output id="cinemaDurationOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="particles" open>
                <summary>Particles</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="confetti">
                    <label for="confettiCount">Confetti count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiCount"
                        min="20"
                        max="320"
                        step="10"
                        data-path="effects.confetti.count"
                        data-output="confettiCountOut"
                      />
                      <output id="confettiCountOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiDuration">Confetti duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiDuration"
                        min="1000"
                        max="6000"
                        step="100"
                        data-path="effects.confetti.durationMs"
                        data-output="confettiDurationOut"
                      />
                      <output id="confettiDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiOrigin">Origin mode</label>
                    <select id="confettiOrigin" data-path="effects.confetti.origin">
                      <option value="cannon">Cannon</option>
                      <option value="rain">Rain</option>
                      <option value="explosion">Explosion</option>
                    </select>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiShape">Shape</label>
                    <select id="confettiShape" data-path="effects.confetti.shape">
                      <option value="mixed">Mixed</option>
                      <option value="rect">Rectangle</option>
                      <option value="circle">Circle</option>
                    </select>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSpeedMin">Speed min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSpeedMin"
                        min="10"
                        max="100"
                        step="5"
                        data-path="effects.confetti.speedMin"
                        data-output="confettiSpeedMinOut"
                      />
                      <output id="confettiSpeedMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSpeedMax">Speed max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSpeedMax"
                        min="50"
                        max="200"
                        step="5"
                        data-path="effects.confetti.speedMax"
                        data-output="confettiSpeedMaxOut"
                      />
                      <output id="confettiSpeedMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiGravity">Gravity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiGravity"
                        min="50"
                        max="600"
                        step="10"
                        data-path="effects.confetti.gravity"
                        data-output="confettiGravityOut"
                      />
                      <output id="confettiGravityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiWind">Wind</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiWind"
                        min="-100"
                        max="100"
                        step="5"
                        data-path="effects.confetti.wind"
                        data-output="confettiWindOut"
                      />
                      <output id="confettiWindOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSizeMin">Size min</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSizeMin"
                        min="2"
                        max="10"
                        step="1"
                        data-path="effects.confetti.sizeMin"
                        data-output="confettiSizeMinOut"
                      />
                      <output id="confettiSizeMinOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="confetti">
                    <label for="confettiSizeMax">Size max</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="confettiSizeMax"
                        min="8"
                        max="20"
                        step="1"
                        data-path="effects.confetti.sizeMax"
                        data-output="confettiSizeMaxOut"
                      />
                      <output id="confettiSizeMaxOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseDuration">Ripple Reverse duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseDuration"
                        min="200"
                        max="2000"
                        step="50"
                        data-path="effects.rippleReverse.durationMs"
                        data-output="rippleReverseDurationOut"
                      />
                      <output id="rippleReverseDurationOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseColor">Ripple Reverse color</label>
                    <input
                      type="color"
                      id="rippleReverseColor"
                      data-path="effects.rippleReverse.color"
                    />
                  </div>

                  <label class="toggle" data-effect="rippleReverse" style="min-width: 220px">
                    <input
                      type="checkbox"
                      id="rippleReverseReverse"
                      data-path="effects.rippleReverse.reverse"
                    />
                    <span>Enable reverse animation</span>
                  </label>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseEasing">Easing</label>
                    <select id="rippleReverseEasing" data-path="effects.rippleReverse.easing">
                      <option value="ease-out">Ease Out</option>
                      <option value="elastic">Elastic</option>
                      <option value="bounce">Bounce</option>
                    </select>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseReverseDelay">Reverse delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseReverseDelay"
                        min="0"
                        max="2000"
                        step="50"
                        data-path="effects.rippleReverse.reverseDelay"
                        data-output="rippleReverseReverseDelayOut"
                      />
                      <output id="rippleReverseReverseDelayOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseHoldTime">Hold time (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseHoldTime"
                        min="0"
                        max="5000"
                        step="100"
                        data-path="effects.rippleReverse.holdTime"
                        data-output="rippleReverseHoldTimeOut"
                      />
                      <output id="rippleReverseHoldTimeOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseOrigin">Origin position</label>
                    <select id="rippleReverseOrigin" data-path="effects.rippleReverse.origin">
                      <option value="top-left">Top Left</option>
                      <option value="top-center">Top Center</option>
                      <option value="top-right">Top Right</option>
                      <option value="middle-left">Middle Left</option>
                      <option value="center">Center</option>
                      <option value="middle-right">Middle Right</option>
                      <option value="bottom-left">Bottom Left</option>
                      <option value="bottom-center">Bottom Center</option>
                      <option value="bottom-right">Bottom Right</option>
                    </select>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseMode">Animation mode</label>
                    <select id="rippleReverseMode" data-path="effects.rippleReverse.mode">
                      <option value="reverse">Reverse</option>
                      <option value="wobble">Wobble</option>
                      <option value="liquid">Liquid</option>
                    </select>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseOpacity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.rippleReverse.opacity"
                        data-output="rippleReverseOpacityOut"
                      />
                      <output id="rippleReverseOpacityOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseBorderWidth">Border width (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rippleReverseBorderWidth"
                        min="0"
                        max="50"
                        step="1"
                        data-path="effects.rippleReverse.borderWidth"
                        data-output="rippleReverseBorderWidthOut"
                      />
                      <output id="rippleReverseBorderWidthOut"></output>
                    </div>
                  </div>

                  <div class="field" data-effect="rippleReverse">
                    <label for="rippleReverseBorderColor">Border color</label>
                    <input
                      type="color"
                      id="rippleReverseBorderColor"
                      data-path="effects.rippleReverse.borderColor"
                    />
                  </div>

                  <div class="field" data-effect="sparkles">
                    <label for="sparklesCount">Sparkles count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="sparklesCount"
                        min="20"
                        max="220"
                        step="10"
                        data-path="effects.sparkles.count"
                        data-output="sparklesCountOut"
                      />
                      <output id="sparklesCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainCount">Rain count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainCount"
                        min="60"
                        max="400"
                        step="10"
                        data-path="effects.rain.count"
                        data-output="rainCountOut"
                      />
                      <output id="rainCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="rain">
                    <label for="rainDuration">Rain duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="rainDuration"
                        min="1000"
                        max="10000"
                        step="100"
                        data-path="effects.rain.durationMs"
                        data-output="rainDurationOut"
                      />
                      <output id="rainDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="dust">
                    <label for="dustCount">Dust count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="dustCount"
                        min="20"
                        max="220"
                        step="10"
                        data-path="effects.dust.count"
                        data-output="dustCountOut"
                      />
                      <output id="dustCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="glitter">
                    <label for="glitterCount">Glitter count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="glitterCount"
                        min="20"
                        max="220"
                        step="10"
                        data-path="effects.glitter.count"
                        data-output="glitterCountOut"
                      />
                      <output id="glitterCountOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="special" open>
                <summary>Special</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="laser">
                    <label for="laserThickness">Laser thickness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserThickness"
                        min="2"
                        max="20"
                        step="1"
                        data-path="effects.laser.thickness"
                        data-output="laserThicknessOut"
                      />
                      <output id="laserThicknessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserLines">Laser lines</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserLines"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.laser.lines"
                        data-output="laserLinesOut"
                      />
                      <output id="laserLinesOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserDuration">Laser duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserDuration"
                        min="200"
                        max="2000"
                        step="50"
                        data-path="effects.laser.durationMs"
                        data-output="laserDurationOut"
                      />
                      <output id="laserDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserColor">Laser color</label>
                    <input type="color" id="laserColor" data-path="effects.laser.color" />
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserOpacity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.laser.opacity"
                        data-output="laserOpacityOut"
                      />
                      <output id="laserOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserDirection">Direction</label>
                    <select id="laserDirection" data-path="effects.laser.direction">
                      <option value="leftToRight">Left to Right</option>
                      <option value="rightToLeft">Right to Left</option>
                      <option value="topToBottom">Top to Bottom</option>
                      <option value="bottomToTop">Bottom to Top</option>
                      <option value="diagTLBR">Diagonal TL to BR</option>
                      <option value="diagTRBL">Diagonal TR to BL</option>
                    </select>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserStagger">Stagger between lines (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserStagger"
                        min="0"
                        max="300"
                        step="10"
                        data-path="effects.laser.staggerMs"
                        data-output="laserStaggerOut"
                      />
                      <output id="laserStaggerOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserGlow">Glow (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserGlow"
                        min="0"
                        max="40"
                        step="1"
                        data-path="effects.laser.glowPx"
                        data-output="laserGlowOut"
                      />
                      <output id="laserGlowOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="laser">
                    <label for="laserOffsetRange">Offset spread (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="laserOffsetRange"
                        min="0"
                        max="80"
                        step="2"
                        data-path="effects.laser.offsetRangePct"
                        data-output="laserOffsetRangeOut"
                      />
                      <output id="laserOffsetRangeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="fireworks">
                    <label for="fireworksBursts">Fireworks bursts</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireworksBursts"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.fireworks.bursts"
                        data-output="fireworksBurstsOut"
                      />
                      <output id="fireworksBurstsOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="fireworks">
                    <label for="fireworksRays">Fireworks rays</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="fireworksRays"
                        min="8"
                        max="30"
                        step="1"
                        data-path="effects.fireworks.rays"
                        data-output="fireworksRaysOut"
                      />
                      <output id="fireworksRaysOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="energy">
                    <label for="energySize">Energy size (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="energySize"
                        min="120"
                        max="420"
                        step="10"
                        data-path="effects.energy.sizePx"
                        data-output="energySizeOut"
                      />
                      <output id="energySizeOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="screenfx" open>
                <summary>Screen FX</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="vhs">
                    <label for="vhsIntensity">VHS intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="vhsIntensity"
                        min="0.2"
                        max="1.2"
                        step="0.05"
                        data-path="effects.vhs.intensity"
                        data-output="vhsIntensityOut"
                      />
                      <output id="vhsIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crt">
                    <label for="crtScanline">CRT scanline opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtScanline"
                        min="0.05"
                        max="0.4"
                        step="0.01"
                        data-path="effects.crt.scanlineOpacity"
                        data-output="crtScanlineOut"
                      />
                      <output id="crtScanlineOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crt">
                    <label for="crtVignette">CRT vignette</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtVignette"
                        min="0.1"
                        max="0.9"
                        step="0.05"
                        data-path="effects.crt.vignette"
                        data-output="crtVignetteOut"
                      />
                      <output id="crtVignetteOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiFontSize">ASCII font size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="asciiFontSize"
                        min="8"
                        max="18"
                        step="1"
                        data-path="effects.ascii.fontSizePx"
                        data-output="asciiFontSizeOut"
                      />
                      <output id="asciiFontSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="ascii">
                    <label for="asciiColor">ASCII color</label>
                    <input type="color" id="asciiColor" data-path="effects.ascii.color" />
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebCount">Web count</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebCount"
                        min="1"
                        max="8"
                        step="1"
                        data-path="effects.spiderWeb.count"
                        data-output="spiderWebCountOut"
                      />
                      <output id="spiderWebCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebPlacement">Placement</label>
                    <select id="spiderWebPlacement" data-path="effects.spiderWeb.placement">
                      <option value="random">Random</option>
                      <option value="center">Center</option>
                    </select>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebPadding">Edge padding (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebPadding"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.spiderWeb.paddingPercent"
                        data-output="spiderWebPaddingOut"
                      />
                      <output id="spiderWebPaddingOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebOpacity"
                        min="0.05"
                        max="1"
                        step="0.05"
                        data-path="effects.spiderWeb.opacity"
                        data-output="spiderWebOpacityOut"
                      />
                      <output id="spiderWebOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebIntensity">Intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebIntensity"
                        min="0.5"
                        max="2"
                        step="0.05"
                        data-path="effects.spiderWeb.intensity"
                        data-output="spiderWebIntensityOut"
                      />
                      <output id="spiderWebIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebQuality">Quality</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebQuality"
                        min="0.2"
                        max="1"
                        step="0.05"
                        data-path="effects.spiderWeb.quality"
                        data-output="spiderWebQualityOut"
                      />
                      <output id="spiderWebQualityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="spiderWeb">
                    <label for="spiderWebDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="spiderWebDuration"
                        min="1000"
                        max="12000"
                        step="250"
                        data-path="effects.spiderWeb.durationMs"
                        data-output="spiderWebDurationOut"
                      />
                      <output id="spiderWebDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassDuration"
                        min="1500"
                        max="12000"
                        step="250"
                        data-path="effects.crackedGlass.durationMs"
                        data-output="crackedGlassDurationOut"
                      />
                      <output id="crackedGlassDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassCountMode">Amount mode</label>
                    <select id="crackedGlassCountMode" data-path="effects.crackedGlass.countMode">
                      <option value="random">Random</option>
                      <option value="fixed">Fixed</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassRandomMin">Random min cracks</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassRandomMin"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.randomMinCount"
                        data-output="crackedGlassRandomMinOut"
                      />
                      <output id="crackedGlassRandomMinOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassRandomMax">Random max cracks</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassRandomMax"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.randomMaxCount"
                        data-output="crackedGlassRandomMaxOut"
                      />
                      <output id="crackedGlassRandomMaxOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassCount">Fixed cracks</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassCount"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.count"
                        data-output="crackedGlassCountOut"
                      />
                      <output id="crackedGlassCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassDistribution">Spread</label>
                    <select
                      id="crackedGlassDistribution"
                      data-path="effects.crackedGlass.distribution"
                    >
                      <option value="screen">Spread (full screen)</option>
                      <option value="cluster">Close (clustered)</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassClusterRadius">Cluster radius (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassClusterRadius"
                        min="2"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.clusterRadiusPercent"
                        data-output="crackedGlassClusterRadiusOut"
                      />
                      <output id="crackedGlassClusterRadiusOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOrigin">Location</label>
                    <select id="crackedGlassOrigin" data-path="effects.crackedGlass.origin">
                      <option value="random">Random</option>
                      <option value="center">Center</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOriginX">Location X (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassOriginX"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.originXPercent"
                        data-output="crackedGlassOriginXOut"
                      />
                      <output id="crackedGlassOriginXOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOriginY">Location Y (%)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassOriginY"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.originYPercent"
                        data-output="crackedGlassOriginYOut"
                      />
                      <output id="crackedGlassOriginYOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassOpacity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.crackedGlass.opacity"
                        data-output="crackedGlassOpacityOut"
                      />
                      <output id="crackedGlassOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassColorMode">Color mode</label>
                    <select id="crackedGlassColorMode" data-path="effects.crackedGlass.colorMode">
                      <option value="white">White</option>
                      <option value="tint">Tint</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassHue">Tint hue</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassHue"
                        min="0"
                        max="360"
                        step="1"
                        data-path="effects.crackedGlass.hue"
                        data-output="crackedGlassHueOut"
                      />
                      <output id="crackedGlassHueOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassHueVar">Hue variance</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassHueVar"
                        min="0"
                        max="180"
                        step="1"
                        data-path="effects.crackedGlass.hueVariance"
                        data-output="crackedGlassHueVarOut"
                      />
                      <output id="crackedGlassHueVarOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassFlashMode">Flash mode</label>
                    <select id="crackedGlassFlashMode" data-path="effects.crackedGlass.flashMode">
                      <option value="single">Single</option>
                      <option value="strobe">Strobe</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassFlashOpacity">Flash opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassFlashOpacity"
                        min="0.05"
                        max="1"
                        step="0.05"
                        data-path="effects.crackedGlass.flashOpacity"
                        data-output="crackedGlassFlashOpacityOut"
                      />
                      <output id="crackedGlassFlashOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassStrobePulses">Strobe pulses</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassStrobePulses"
                        min="1"
                        max="12"
                        step="1"
                        data-path="effects.crackedGlass.strobePulses"
                        data-output="crackedGlassStrobePulsesOut"
                      />
                      <output id="crackedGlassStrobePulsesOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassStrobeInterval">Strobe interval (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassStrobeInterval"
                        min="60"
                        max="500"
                        step="10"
                        data-path="effects.crackedGlass.strobeIntervalMs"
                        data-output="crackedGlassStrobeIntervalOut"
                      />
                      <output id="crackedGlassStrobeIntervalOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassShakeEnabled">Shake</label>
                    <select
                      id="crackedGlassShakeEnabled"
                      data-path="effects.crackedGlass.shakeEnabled"
                    >
                      <option value="true">On</option>
                      <option value="false">Off</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassImpactEnabled">Impact marker</label>
                    <select
                      id="crackedGlassImpactEnabled"
                      data-path="effects.crackedGlass.impactEnabled"
                    >
                      <option value="true">On</option>
                      <option value="false">Off</option>
                    </select>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassMinIntensity">Min intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassMinIntensity"
                        min="0.1"
                        max="2"
                        step="0.05"
                        data-path="effects.crackedGlass.minIntensity"
                        data-output="crackedGlassMinIntensityOut"
                      />
                      <output id="crackedGlassMinIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassMaxIntensity">Max intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassMaxIntensity"
                        min="0.1"
                        max="2"
                        step="0.05"
                        data-path="effects.crackedGlass.maxIntensity"
                        data-output="crackedGlassMaxIntensityOut"
                      />
                      <output id="crackedGlassMaxIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassDelayStep">Impact spacing (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassDelayStep"
                        min="0"
                        max="500"
                        step="10"
                        data-path="effects.crackedGlass.delayStepMs"
                        data-output="crackedGlassDelayStepOut"
                      />
                      <output id="crackedGlassDelayStepOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassSaturation">Tint saturation</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassSaturation"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.saturation"
                        data-output="crackedGlassSaturationOut"
                      />
                      <output id="crackedGlassSaturationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassLightness">Tint lightness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassLightness"
                        min="0"
                        max="100"
                        step="1"
                        data-path="effects.crackedGlass.lightness"
                        data-output="crackedGlassLightnessOut"
                      />
                      <output id="crackedGlassLightnessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassBranchDepth">Branch depth</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassBranchDepth"
                        min="0"
                        max="4"
                        step="1"
                        data-path="effects.crackedGlass.branchDepth"
                        data-output="crackedGlassBranchDepthOut"
                      />
                      <output id="crackedGlassBranchDepthOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassLineWidth">Line width</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassLineWidth"
                        min="0.5"
                        max="6"
                        step="0.25"
                        data-path="effects.crackedGlass.lineWidthBase"
                        data-output="crackedGlassLineWidthOut"
                      />
                      <output id="crackedGlassLineWidthOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassLineWidthJitter">Line width jitter</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassLineWidthJitter"
                        min="0"
                        max="6"
                        step="0.25"
                        data-path="effects.crackedGlass.lineWidthJitter"
                        data-output="crackedGlassLineWidthJitterOut"
                      />
                      <output id="crackedGlassLineWidthJitterOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassJaggedness">Jaggedness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassJaggedness"
                        min="0"
                        max="30"
                        step="1"
                        data-path="effects.crackedGlass.jaggednessPx"
                        data-output="crackedGlassJaggednessOut"
                      />
                      <output id="crackedGlassJaggednessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crackedGlass">
                    <label for="crackedGlassShardProb">Shard probability</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crackedGlassShardProb"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.crackedGlass.shardProbability"
                        data-output="crackedGlassShardProbOut"
                      />
                      <output id="crackedGlassShardProbOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesDuration"
                        min="1000"
                        max="8000"
                        step="100"
                        data-path="effects.heartParticles.durationMs"
                        data-output="heartParticlesDurationOut"
                      />
                      <output id="heartParticlesDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesDensity">Particle density</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesDensity"
                        min="10"
                        max="150"
                        step="5"
                        data-path="effects.heartParticles.density"
                        data-output="heartParticlesDensityOut"
                      />
                      <output id="heartParticlesDensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesBlastSize">Max particle size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesBlastSize"
                        min="10"
                        max="80"
                        step="2"
                        data-path="effects.heartParticles.blastSize"
                        data-output="heartParticlesBlastSizeOut"
                      />
                      <output id="heartParticlesBlastSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesMinSize">Min particle size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesMinSize"
                        min="2"
                        max="30"
                        step="1"
                        data-path="effects.heartParticles.minSize"
                        data-output="heartParticlesMinSizeOut"
                      />
                      <output id="heartParticlesMinSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesGravity">Gravity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesGravity"
                        min="0"
                        max="0.5"
                        step="0.01"
                        data-path="effects.heartParticles.gravity"
                        data-output="heartParticlesGravityOut"
                      />
                      <output id="heartParticlesGravityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesSpeed">Particle speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesSpeed"
                        min="1"
                        max="10"
                        step="0.2"
                        data-path="effects.heartParticles.speed"
                        data-output="heartParticlesSpeedOut"
                      />
                      <output id="heartParticlesSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesShrinkRate">Shrink rate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesShrinkRate"
                        min="0.05"
                        max="0.5"
                        step="0.01"
                        data-path="effects.heartParticles.shrinkRate"
                        data-output="heartParticlesShrinkRateOut"
                      />
                      <output id="heartParticlesShrinkRateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesFadeRate">Fade rate (reverse mode)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesFadeRate"
                        min="0.001"
                        max="0.05"
                        step="0.001"
                        data-path="effects.heartParticles.fadeRate"
                        data-output="heartParticlesFadeRateOut"
                      />
                      <output id="heartParticlesFadeRateOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesExplosionCount">Number of explosions</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="heartParticlesExplosionCount"
                        min="1"
                        max="10"
                        step="1"
                        data-path="effects.heartParticles.explosionCount"
                        data-output="heartParticlesExplosionCountOut"
                      />
                      <output id="heartParticlesExplosionCountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesTheme">Theme</label>
                    <select id="heartParticlesTheme" data-path="effects.heartParticles.theme">
                      <option value="red">Red</option>
                      <option value="pink">Pink</option>
                      <option value="purple">Purple</option>
                      <option value="lightpink">Light Pink</option>
                    </select>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label for="heartParticlesSpreadType">Spread pattern</label>
                    <select
                      id="heartParticlesSpreadType"
                      data-path="effects.heartParticles.spreadType"
                    >
                      <option value="single">Single (Center)</option>
                      <option value="random">Random</option>
                      <option value="grid">Grid</option>
                    </select>
                  </div>
                  <div class="field" data-effect="heartParticles">
                    <label class="toggle">
                      <input
                        type="checkbox"
                        id="heartParticlesReverse"
                        data-path="effects.heartParticles.reverse"
                      />
                      <span>Reverse mode (float up)</span>
                    </label>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraDuration">Duration (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="auraDuration"
                        min="500"
                        max="8000"
                        step="100"
                        data-path="effects.aura.durationMs"
                        data-output="auraDurationOut"
                      />
                      <output id="auraDurationOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraLevelSelect">Aura level</label>
                    <select id="auraLevelSelect" data-path="effects.aura.level">
                      <option value="cold">Cold</option>
                      <option value="warm">Warm</option>
                      <option value="hot">Hot</option>
                    </select>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraColor">Custom color</label>
                    <input type="color" id="auraColor" data-path="effects.aura.color" />
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraIntensity">Color intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="auraIntensity"
                        min="0"
                        max="1"
                        step="0.01"
                        data-path="effects.aura.intensity"
                        data-output="auraIntensityOut"
                      />
                      <output id="auraIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraOpacity">Opacity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="auraOpacity"
                        min="0"
                        max="1"
                        step="0.05"
                        data-path="effects.aura.opacity"
                        data-output="auraOpacityOut"
                      />
                      <output id="auraOpacityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraBlendMode">Blend mode</label>
                    <select id="auraBlendMode" data-path="effects.aura.blendMode">
                      <option value="normal">Normal</option>
                      <option value="screen">Screen</option>
                      <option value="multiply">Multiply</option>
                      <option value="overlay">Overlay</option>
                    </select>
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraGradientCenter">Gradient center</label>
                    <input
                      type="text"
                      id="auraGradientCenter"
                      data-path="effects.aura.gradientCenter"
                      placeholder="50% 40%"
                    />
                  </div>
                  <div class="field" data-effect="aura">
                    <label for="auraGradientRadius">Gradient radius</label>
                    <input
                      type="text"
                      id="auraGradientRadius"
                      data-path="effects.aura.gradientRadius"
                      placeholder="70%"
                    />
                  </div>
                  <div class="field" data-effect="grain">
                    <label for="grainIntensity">Grain intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="grainIntensity"
                        min="0.05"
                        max="0.5"
                        step="0.01"
                        data-path="effects.grain.intensity"
                        data-output="grainIntensityOut"
                      />
                      <output id="grainIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="watercolor">
                    <label for="watercolorIntensity">Watercolor intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="watercolorIntensity"
                        min="0.2"
                        max="1"
                        step="0.05"
                        data-path="effects.watercolor.intensity"
                        data-output="watercolorIntensityOut"
                      />
                      <output id="watercolorIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitPixelSize">8-bit pixel size</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitPixelSize"
                        min="4"
                        max="18"
                        step="1"
                        data-path="effects.eightBit.pixelSize"
                        data-output="eightBitPixelSizeOut"
                      />
                      <output id="eightBitPixelSizeOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="eightBit">
                    <label for="eightBitIntensity">8-bit intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="eightBitIntensity"
                        min="0.1"
                        max="1"
                        step="0.05"
                        data-path="effects.eightBit.intensity"
                        data-output="eightBitIntensityOut"
                      />
                      <output id="eightBitIntensityOut"></output>
                    </div>
                  </div>
                </div>
              </details>

              <details class="settings-group" data-group="glitch" open>
                <summary>Distort &amp; Glitch</summary>
                <div class="settings-grid">
                  <div class="field" data-effect="bulge">
                    <label for="bulgeScale">Bulge scale</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bulgeScale"
                        min="1.05"
                        max="2.2"
                        step="0.05"
                        data-path="effects.bulge.scale"
                        data-output="bulgeScaleOut"
                      />
                      <output id="bulgeScaleOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="strobe">
                    <label for="strobeFrequency">Strobe frequency</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="strobeFrequency"
                        min="2"
                        max="24"
                        step="1"
                        data-path="effects.strobe.frequency"
                        data-output="strobeFrequencyOut"
                      />
                      <output id="strobeFrequencyOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="strobe">
                    <label for="strobeColor">Strobe color (CSS)</label>
                    <input type="text" id="strobeColor" data-path="effects.strobe.color" />
                  </div>
                  <div class="field" data-effect="hardGlitch">
                    <label for="hardGlitchIntensity">Hard glitch intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="hardGlitchIntensity"
                        min="0.3"
                        max="1.6"
                        step="0.05"
                        data-path="effects.hardGlitch.intensity"
                        data-output="hardGlitchIntensityOut"
                      />
                      <output id="hardGlitchIntensityOut"></output>
                    </div>
                  </div>
                  <!-- softGlitch removed -->
                  <div class="field" data-effect="shaderFire">
                    <label for="shaderFireIntensity">Shader fire intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="shaderFireIntensity"
                        min="0.3"
                        max="1.5"
                        step="0.05"
                        data-path="effects.shaderFire.intensity"
                        data-output="shaderFireIntensityOut"
                      />
                      <output id="shaderFireIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="shaderFire">
                    <label for="shaderFireSpeed">Shader fire speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="shaderFireSpeed"
                        min="0.3"
                        max="2.0"
                        step="0.1"
                        data-path="effects.shaderFire.speed"
                        data-output="shaderFireSpeedOut"
                      />
                      <output id="shaderFireSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="pixelSort">
                    <label for="pixelSortIntensity">Pixel sort intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="pixelSortIntensity"
                        min="0.2"
                        max="1"
                        step="0.05"
                        data-path="effects.pixelSort.intensity"
                        data-output="pixelSortIntensityOut"
                      />
                      <output id="pixelSortIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crtTurnOff">
                    <label for="crtTurnOffSpeed">CRT speed</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtTurnOffSpeed"
                        min="0.5"
                        max="2.0"
                        step="0.1"
                        data-path="effects.crtTurnOff.speed"
                        data-output="crtTurnOffSpeedOut"
                      />
                      <output id="crtTurnOffSpeedOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crtTurnOff">
                    <label for="crtTurnOffVerticalDelay">CRT vertical delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtTurnOffVerticalDelay"
                        min="0"
                        max="500"
                        step="50"
                        data-path="effects.crtTurnOff.verticalDelay"
                        data-output="crtTurnOffVerticalDelayOut"
                      />
                      <output id="crtTurnOffVerticalDelayOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="crtTurnOff">
                    <label for="crtTurnOffHorizontalDelay">CRT horizontal delay (ms)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="crtTurnOffHorizontalDelay"
                        min="100"
                        max="800"
                        step="50"
                        data-path="effects.crtTurnOff.horizontalDelay"
                        data-output="crtTurnOffHorizontalDelayOut"
                      />
                      <output id="crtTurnOffHorizontalDelayOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="blur">
                    <label for="blurAmount">Blur amount (px)</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="blurAmount"
                        min="2"
                        max="40"
                        step="1"
                        data-path="effects.blur.amountPx"
                        data-output="blurAmountOut"
                      />
                      <output id="blurAmountOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="bleach">
                    <label for="bleachIntensity">Bleach intensity</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="bleachIntensity"
                        min="0.1"
                        max="0.9"
                        step="0.05"
                        data-path="effects.bleach.intensity"
                        data-output="bleachIntensityOut"
                      />
                      <output id="bleachIntensityOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="colorCorrection">
                    <label for="colorBrightness">Color correction brightness</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="colorBrightness"
                        min="0.7"
                        max="1.8"
                        step="0.05"
                        data-path="effects.colorCorrection.brightness"
                        data-output="colorBrightnessOut"
                      />
                      <output id="colorBrightnessOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="colorCorrection">
                    <label for="colorContrast">Color correction contrast</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="colorContrast"
                        min="0.7"
                        max="2"
                        step="0.05"
                        data-path="effects.colorCorrection.contrast"
                        data-output="colorContrastOut"
                      />
                      <output id="colorContrastOut"></output>
                    </div>
                  </div>
                  <div class="field" data-effect="colorCorrection">
                    <label for="colorSaturate">Color correction saturate</label>
                    <div class="range-row">
                      <input
                        type="range"
                        id="colorSaturate"
                        min="0.6"
                        max="2"
                        step="0.05"
                        data-path="effects.colorCorrection.saturate"
                        data-output="colorSaturateOut"
                      />
                      <output id="colorSaturateOut"></output>
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </section>
        </main>
      </div>

      <section class="status-bar" aria-label="Diagnostics">
        <span class="status-title">Diagnostics</span>
        <div class="diagnostics" id="diagnostics">
          <div class="diag-row">
            <span>Enabled</span>
            <span id="diagEnabled">--</span>
          </div>
          <div class="diag-row">
            <span>Overlay exists</span>
            <span id="diagOverlay">--</span>
          </div>
          <div class="diag-row">
            <span>Tour object captured</span>
            <span id="diagTourObj">--</span>
          </div>
          <div class="diag-row">
            <span>Last played effect</span>
            <span id="diagLastEffect">--</span>
          </div>
        </div>
      </section>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script src="effects-core.js"></script>
    <script>
      (function () {
        "use strict";

        (function () {
          const sidebar = document.getElementById("controlSidebar");
          const collapseToggle = document.getElementById("sidebarToggle");
          const openToggle = document.getElementById("sidebarOpen");
          const backdrop = document.getElementById("sidebarBackdrop");
          if (!sidebar || (!collapseToggle && !openToggle)) return;

          const storageKey = "effectsProSidebarCollapsed";
          const mobileQuery = window.matchMedia ? window.matchMedia("(max-width: 900px)") : null;
          const isMobile = () => !!(mobileQuery && mobileQuery.matches);

          const setBackdropVisible = (visible) => {
            if (!backdrop) return;
            backdrop.hidden = !visible;
          };

          const setAria = () => {
            const mobile = isMobile();
            const open = document.body.classList.contains("sidebar-open");

            if (openToggle) {
              openToggle.setAttribute("aria-expanded", mobile && open ? "true" : "false");
            }

            if (!collapseToggle) return;
            if (mobile) {
              collapseToggle.setAttribute("aria-expanded", open ? "true" : "false");
              const tooltip = open ? "Close controls" : "Open controls";
              collapseToggle.dataset.tooltip = tooltip;
              collapseToggle.setAttribute("aria-label", tooltip);
              return;
            }

            const expanded = !document.body.classList.contains("sidebar-collapsed");
            collapseToggle.setAttribute("aria-expanded", expanded ? "true" : "false");
            const tooltip = expanded ? "Collapse controls" : "Expand controls";
            collapseToggle.dataset.tooltip = tooltip;
            collapseToggle.setAttribute("aria-label", tooltip);
          };

          const closeMobile = () => {
            document.body.classList.remove("sidebar-open");
            setBackdropVisible(false);
            setAria();
          };

          const openMobile = () => {
            document.body.classList.add("sidebar-open");
            setBackdropVisible(true);
            setAria();
          };

          const toggleMobile = () => {
            if (document.body.classList.contains("sidebar-open")) closeMobile();
            else openMobile();
          };

          const applyDesktopState = () => {
            let collapsed = false;
            try {
              collapsed = window.localStorage && window.localStorage.getItem(storageKey) === "1";
            } catch {
              // ignore
            }
            document.body.classList.toggle("sidebar-collapsed", collapsed);
            document.body.classList.remove("sidebar-open");
            setBackdropVisible(false);
            setAria();
          };

          const toggleDesktopCollapsed = () => {
            const nextCollapsed = !document.body.classList.contains("sidebar-collapsed");
            document.body.classList.toggle("sidebar-collapsed", nextCollapsed);
            try {
              if (window.localStorage)
                window.localStorage.setItem(storageKey, nextCollapsed ? "1" : "0");
            } catch {
              // ignore
            }
            setAria();
          };

          if (openToggle) {
            openToggle.addEventListener("click", () => {
              if (isMobile()) toggleMobile();
              else toggleDesktopCollapsed();
            });
          }

          if (collapseToggle) {
            collapseToggle.addEventListener("click", () => {
              if (isMobile()) closeMobile();
              else toggleDesktopCollapsed();
            });
          }

          if (backdrop) {
            backdrop.addEventListener("click", closeMobile);
          }

          document.addEventListener("keydown", (event) => {
            if (!isMobile()) return;
            if (event.key === "Escape" || event.key === "Esc") closeMobile();
          });

          if (mobileQuery) {
            const onChange = () => {
              if (isMobile()) {
                document.body.classList.remove("sidebar-collapsed");
                closeMobile();
              } else {
                applyDesktopState();
              }
            };
            try {
              mobileQuery.addEventListener("change", onChange);
            } catch {
              // ignore
            }
          }

          if (isMobile()) {
            document.body.classList.remove("sidebar-collapsed");
            closeMobile();
          } else {
            applyDesktopState();
          }
        })();

        const EFFECTS = [
          "none",
          "flash",
          "fade",
          "sweep",
          "cinema",
          "confetti",
          "sparkles",
          "smoke",
          "radial",
          "ripple",
          "rippleReverse",
          "waterRipple",
          "dust",
          "glitter",
          "laser",
          "fireworks",
          "energy",
          "vhs",
          "crt",
          "ascii",
          "matrixDance",
          "spiderWeb",
          "crackedGlass",
          "grain",
          "watercolor",
          "eightBit",
          "bulge",
          "strobe",
          "hardGlitch",
          "shaderFire",
          "pixelSort",
          "crtTurnOff",
          "blur",
          "bleach",
          "colorCorrection",
        ];

        const THEMES = [
          "none",
          "snow",
          "snowflakes",
          "rain",
          "storm",
          "spinningRays",
          "sineWaves",
          "halloween",
          "christmasLights",
          "easter",
          "flowers",
          "bubbles",
          "leaves",
          "fire",
          "flames",
          "bokeh",
          "electric",
          "water",
          "wind",
          "burn",
          "smoke",
          "strobe",
        ];

        const EFFECT_LABELS = {
          none: "None",
          flash: "Flash",
          fade: "Fade",
          sweep: "Sweep",
          cinema: "Cinema Bars",
          confetti: "Confetti",
          sparkles: "Sparkles",
          smoke: "Smoke",
          radial: "Radial",
          ripple: "Ripple",
          rippleReverse: "Ripple Reverse",
          waterRipple: "Water Ripple",
          dust: "Dust",
          glitter: "Glitter",
          laser: "Laser",
          fireworks: "Fireworks",
          energy: "Energy",
          vhs: "VHS",
          crt: "CRT",
          ascii: "ASCII",
          matrixDance: "Matrix Dance",
          spiderWeb: "Spider Web",
          crackedGlass: "Cracked Glass",
          grain: "Grain",
          watercolor: "Watercolor",
          eightBit: "8-bit",
          bulge: "Bulge",
          strobe: "Strobe",
          hardGlitch: "Hard Glitch",
          shaderFire: "Shader Fire",
          pixelSort: "Pixel Sort",
          crtTurnOff: "CRT Turn-Off",
          blur: "Blur",
          bleach: "Bleach",
          colorCorrection: "Color Correction",
          heartParticles: "Heart Particles",
          aura: "Aura",
        };

        const THEME_LABELS = {
          none: "None",
          snow: "Snow",
          snowflakes: "Snow Flakes",
          rain: "Rainfall",
          storm: "Storm",
          spinningRays: "Spinning Rays",
          sineWaves: "Sine Waves",
          halloween: "Halloween",
          christmasLights: "Christmas Lights",
          easter: "Easter",
          flowers: "Flowers",
          bubbles: "Bubbles",
          leaves: "Leaves",
          fire: "Fire",
          flames: "Flames",
          bokeh: "Bokeh Lights",
          electric: "Electric",
          water: "Water",
          wind: "Wind",
          burn: "Burn",
          smoke: "Smoke",
          strobe: "Strobe",
          fallingStars: "Falling Stars",
        };

        let nowPlayingTimer = null;

        function byId(id) {
          return document.getElementById(id);
        }

        function getLabel(labelMap, key) {
          if (!key) return "";
          return labelMap && labelMap[key] ? labelMap[key] : key;
        }

        function formatNowPlaying(value) {
          if (!value || value === "none") return "None";
          if (value.indexOf("theme:") === 0) {
            const themeKey = value.replace("theme:", "").trim();
            return "Theme: " + getLabel(THEME_LABELS, themeKey);
          }
          return getLabel(EFFECT_LABELS, value);
        }

        function setNowPlaying(value, durationMs) {
          const wrap = byId("nowPlayingWrap");
          const label = byId("nowPlaying");
          if (!wrap || !label) return;
          if (nowPlayingTimer) {
            clearTimeout(nowPlayingTimer);
            nowPlayingTimer = null;
          }
          const formatted = formatNowPlaying(value);
          label.textContent = formatted;
          const isActive = formatted && formatted !== "None";
          wrap.dataset.active = isActive ? "true" : "false";
          const holdMs = Number(durationMs);
          if (isActive && Number.isFinite(holdMs) && holdMs > 0) {
            nowPlayingTimer = setTimeout(() => {
              label.textContent = "None";
              wrap.dataset.active = "false";
              nowPlayingTimer = null;
              updatePlaybackButton(false);
            }, holdMs + 200);
          }
        }

        function getEffectDurationMs(effectName, config) {
          if (!effectName || effectName === "none") return 0;
          const effectCfg = config && config.effects ? config.effects[effectName] : null;
          const duration =
            effectCfg && typeof effectCfg.durationMs !== "undefined"
              ? Number(effectCfg.durationMs)
              : 0;
          return Number.isFinite(duration) && duration > 0 ? duration : 1200;
        }

        function waitForApi(callback, attempts) {
          const maxAttempts = attempts || 120; // ~12s fallback for slow networks
          let done = false;
          let timer = null;

          function getApi() {
            const api = window.tourEffectsFunctions || window.effectsPro;
            if (!api) return null;
            if (typeof api.getConfig !== "function") return null;
            if (typeof api.loadConfig !== "function") return null;
            return api;
          }

          function finish(api, err) {
            if (done) return;
            done = true;
            if (timer) clearInterval(timer);
            callback(api, err);
          }

          const immediate = getApi();
          if (immediate) {
            finish(immediate);
            return;
          }

          // Prefer loader promise when available (visual-effects-pro loader).
          const ep = window.effectsPro;
          if (ep && ep.ready && typeof ep.ready.then === "function") {
            ep.ready
              .then(() => {
                finish(getApi());
              })
              .catch((err) => {
                finish(null, err);
              });
          }

          let count = 0;
          timer = setInterval(() => {
            const api = getApi();
            if (api) {
              finish(api);
              return;
            }
            count += 1;
            if (count >= maxAttempts) {
              finish(null);
            }
          }, 100);
        }

        function showToast(message, isError) {
          const toast = byId("toast");
          if (!toast) return;
          toast.textContent = message;
          toast.style.borderColor = isError ? "var(--danger)" : "var(--accent-2)";
          toast.classList.add("show");
          setTimeout(() => toast.classList.remove("show"), 2200);
        }

        function createRadioCard(id, value, label) {
          const wrapper = document.createElement("div");
          wrapper.className = "radio-card";
          const input = document.createElement("input");
          input.type = "radio";
          input.name = "previewSelection";
          input.id = id;
          input.value = value;
          const labelEl = document.createElement("label");
          labelEl.setAttribute("for", id);
          labelEl.textContent = label;
          wrapper.appendChild(input);
          wrapper.appendChild(labelEl);
          return wrapper;
        }

        function renderRadioList(container, list, labels, type, includeNone) {
          if (!container) return;
          container.textContent = "";
          if (includeNone) {
            container.appendChild(createRadioCard("select-" + type + "-none", "none", "None"));
          }
          const items = Array.isArray(list) ? list.slice() : [];
          items
            .filter((item) => item !== "none")
            .forEach((item) => {
              const id = "select-" + type + "-" + item;
              const value = type + ":" + item;
              container.appendChild(createRadioCard(id, value, labels[item] || item));
            });
        }

        function renderSelectionRadios(effects, themes) {
          const selection = byId("selectionRadios");
          if (selection) {
            selection.textContent = "";
          }
          renderRadioList(byId("themeRadios"), themes, THEME_LABELS, "theme", true);
          renderRadioList(byId("effectRadios"), effects, EFFECT_LABELS, "effect", false);
        }

        // Render immediately with fallback lists for faster perceived load,
        // then re-render with live lists once the core finishes bootstrapping.
        renderSelectionRadios(EFFECTS, THEMES);

        function parseSelectionValue(value) {
          if (!value || value === "none") {
            return { type: "none", name: "none" };
          }
          const parts = value.split(":");
          return { type: parts[0] || "none", name: parts[1] || "none" };
        }

        function getSelection() {
          const checked = document.querySelector('input[name="previewSelection"]:checked');
          return parseSelectionValue(checked ? checked.value : "none");
        }

        function setSelectionValue(value) {
          const target = document.querySelector(
            'input[name="previewSelection"][value="' + value + '"]'
          );
          if (target) {
            target.checked = true;
            return;
          }
          const fallback = document.querySelector('input[name="previewSelection"][value="none"]');
          if (fallback) {
            fallback.checked = true;
          }
        }

        function selectionFromConfig(config) {
          const preferredTheme = config && config.preferredTheme ? config.preferredTheme : "none";
          if (preferredTheme && preferredTheme !== "none") {
            return { type: "theme", name: preferredTheme };
          }
          const preferredEffect =
            config && config.preferredEffect ? config.preferredEffect : "none";
          if (preferredEffect && preferredEffect !== "none") {
            return { type: "effect", name: preferredEffect };
          }
          return { type: "none", name: "none" };
        }

        function getConfigValue(config, path) {
          return path.split(".").reduce((acc, key) => (acc ? acc[key] : undefined), config);
        }

        function pathToObject(path, value) {
          const parts = path.split(".");
          let obj = {};
          let cursor = obj;
          for (let i = 0; i < parts.length - 1; i++) {
            cursor[parts[i]] = {};
            cursor = cursor[parts[i]];
          }
          cursor[parts[parts.length - 1]] = value;
          return obj;
        }

        function readUiValue(el) {
          if (!el) return undefined;
          if (el.type === "checkbox") {
            return !!el.checked;
          }
          if (el.type === "number" || el.type === "range") {
            const num = Number(el.value);
            return Number.isFinite(num) ? num : 0;
          }
          const value = el.value;
          if (value === "true") return true;
          if (value === "false") return false;
          return value;
        }

        function saveUIToConfig(api, changedEl) {
          if (!api || typeof api.setConfig !== "function") return;

          // Fast path: update a single data-path control safely.
          if (changedEl && changedEl.dataset && changedEl.dataset.path) {
            const value = readUiValue(changedEl);
            api.setConfig(pathToObject(changedEl.dataset.path, value));

            // Derived settings (water flow vectors) for future compatibility.
            if (changedEl.id === "waterFlowSpeed") {
              const flowSpeed = Number(changedEl.value) || 1.0;
              const baseFlow1 = [0.14, -0.09];
              const baseFlow2 = [-0.11, 0.13];
              api.setConfig({
                themes: {
                  water: {
                    flow1: [baseFlow1[0] * flowSpeed, baseFlow1[1] * flowSpeed],
                    flow2: [baseFlow2[0] * flowSpeed, baseFlow2[1] * flowSpeed],
                  },
                },
              });
            }
            return;
          }

          // Sync non-data-path controls used by the dashboard.
          const domEnabled = byId("domEnabled");
          if (domEnabled) {
            api.setConfig({ enabled: !!domEnabled.checked });
          }

          const mode = byId("mode");
          if (mode) {
            api.setConfig({ mode: mode.value });
          }

          const reducedMotion = byId("reducedMotion");
          if (reducedMotion) {
            api.setConfig({ reducedMotionRespect: !!reducedMotion.checked });
          }

          const zIndex = byId("zIndex");
          if (zIndex) {
            const value = Number(zIndex.value) || 999999;
            api.setConfig({ zIndex: value });
          }

          const auraRadio = document.querySelector('input[name="auraSelection"]:checked');
          if (auraRadio) {
            const level = auraRadio.value || "none";
            api.setConfig({ aura: { enabled: level !== "none", level: level } });
          }

          const selection = getSelection();
          if (selection.type === "theme") {
            api.setConfig({ preferredTheme: selection.name, preferredEffect: "none" });
          } else if (selection.type === "effect") {
            api.setConfig({ preferredEffect: selection.name, preferredTheme: "none" });
          } else {
            api.setConfig({ preferredEffect: "none", preferredTheme: "none" });
          }
        }

        function persistConfig(api, changedEl) {
          try {
            saveUIToConfig(api, changedEl);
            if (api && typeof api.saveConfig === "function") {
              api.saveConfig();
            }
          } catch (err) {
            // Fail silent
          }
        }

        function setFieldVisibleByInputId(inputId, visible) {
          const el = byId(inputId);
          if (!el) return;
          const field = typeof el.closest === "function" ? el.closest(".field") : null;
          const target = field || el;
          target.style.display = visible ? "" : "none";
        }

        function updateHalloweenControlsVisibility(styleOverride) {
          const styleEl = byId("halloweenStyle");
          const style = styleOverride || (styleEl ? styleEl.value : "spiders");

          const showGhost = style === "spiders" || style === "mixed";
          const showEmoji = style === "emoji" || style === "mixed";
          const showEmbers = style === "embers";
          const showParticles = showEmoji || showEmbers;

          // Ghost overlay controls (only used when spiders overlay is active).
          [
            "halloweenGhostCount",
            "halloweenGhostDirection",
            "halloweenGhostRandomness",
            "halloweenGhostSizeMin",
            "halloweenGhostSizeMax",
          ].forEach((id) => setFieldVisibleByInputId(id, showGhost));

          // Emoji/particle motion controls.
          [
            "halloweenDirection",
            "halloweenWindStrength",
            "halloweenDrift",
            "halloweenSpeedMin",
            "halloweenSpeedMax",
            "halloweenSizeMin",
            "halloweenSizeMax",
          ].forEach((id) => setFieldVisibleByInputId(id, showEmoji));

          // Spawn tuning (used by emoji + embers).
          ["halloweenEmissionRate", "halloweenMaxParticles"].forEach((id) => {
            setFieldVisibleByInputId(id, showParticles);
          });

          // Legacy spider-string controls are not used by the current CSS spiders overlay.
          ["halloweenStringLenMin", "halloweenStringLenMax"].forEach((id) =>
            setFieldVisibleByInputId(id, false)
          );
        }

        function applySettingsFilter(effectName, selectionType) {
          const isEffect = selectionType === "effect";
          const isTheme = selectionType === "theme";
          const selected = isEffect ? effectName || "none" : "none";
          const fields = Array.from(document.querySelectorAll(".settings-group [data-effect]"));
          let visibleCount = 0;
          const visibleGroups = new Set();

          // Show/hide theme settings section
          const themeSection = byId("themeSettingsSection");
          const effectSection = byId("effectSettingsSection");
          const globalHint = byId("settingsGlobalHint");

          if (themeSection) {
            themeSection.style.display = isTheme && effectName !== "none" ? "" : "none";
          }
          if (effectSection) {
            effectSection.style.display = isEffect && effectName !== "none" ? "" : "none";
          }
          if (globalHint) {
            globalHint.style.display =
              (!isTheme && !isEffect) || effectName === "none" ? "" : "none";
          }

          // Show/hide snow theme controls
          const snowControls = byId("snowThemeControls");
          if (snowControls) {
            snowControls.style.display = isTheme && effectName === "snow" ? "" : "none";
          }

          // Show/hide snowflakes theme controls
          const snowflakesControls = byId("snowflakesThemeControls");
          if (snowflakesControls) {
            snowflakesControls.style.display = isTheme && effectName === "snowflakes" ? "" : "none";
          }

          // Show/hide halloween theme controls
          const halloweenControls = byId("halloweenThemeControls");
          if (halloweenControls) {
            const isHalloweenActive = isTheme && effectName === "halloween";
            halloweenControls.style.display = isHalloweenActive ? "" : "none";
            if (isHalloweenActive) {
              updateHalloweenControlsVisibility();
            }
          }

          // Show/hide smoke theme controls
          const smokeControls = byId("smokeThemeControls");
          if (smokeControls) {
            smokeControls.style.display = isTheme && effectName === "smoke" ? "" : "none";
          }

          // Show/hide rain theme controls
          const rainControls = byId("rainThemeControls");
          if (rainControls) {
            rainControls.style.display = isTheme && effectName === "rain" ? "" : "none";
          }

          // Show/hide storm theme controls
          const stormControls = byId("stormThemeControls");
          if (stormControls) {
            stormControls.style.display = isTheme && effectName === "storm" ? "" : "none";
          }

          // Show/hide burn theme controls
          const burnControls = byId("burnThemeControls");
          if (burnControls) {
            burnControls.style.display = isTheme && effectName === "burn" ? "" : "none";
          }

          // Show/hide fire (flames) theme controls
          const fireControls = byId("fireThemeControls");
          if (fireControls) {
            fireControls.style.display = isTheme && effectName === "flames" ? "" : "none";
          }

          // Show/hide bokeh theme controls
          const bokehControls = byId("bokehThemeControls");
          if (bokehControls) {
            bokehControls.style.display = isTheme && effectName === "bokeh" ? "" : "none";
          }

          // Show/hide electric theme controls
          const electricControls = byId("electricThemeControls");
          if (electricControls) {
            electricControls.style.display = isTheme && effectName === "electric" ? "" : "none";
          }

          // Show/hide water theme controls
          const waterControls = byId("waterThemeControls");
          if (waterControls) {
            waterControls.style.display = isTheme && effectName === "water" ? "" : "none";
          }

          const flowersControls = byId("flowersThemeControls");
          if (flowersControls) {
            flowersControls.style.display = isTheme && effectName === "flowers" ? "" : "none";
          }

          const raysControls = byId("spinningRaysThemeControls");
          if (raysControls) {
            raysControls.style.display = isTheme && effectName === "spinningRays" ? "" : "none";
          }

          const sineControls = byId("sineWavesThemeControls");
          if (sineControls) {
            sineControls.style.display = isTheme && effectName === "sineWaves" ? "" : "none";
          }

          const fallingStarsControls = byId("fallingStarsThemeControls");
          if (fallingStarsControls) {
            fallingStarsControls.style.display =
              isTheme && effectName === "fallingStars" ? "" : "none";
          }

          fields.forEach((field) => {
            const effects = field.dataset.effect
              ? field.dataset.effect.split(",").map((item) => item.trim())
              : [];
            const show = selected !== "none" && effects.indexOf(selected) !== -1;
            field.hidden = !show;
            field.style.display = show ? "" : "none";
            if (show) {
              visibleCount += 1;
              const group = field.closest(".settings-group");
              if (group) {
                visibleGroups.add(group);
              }
            }
          });

          document.querySelectorAll(".settings-group").forEach((group) => {
            const hasVisible = visibleGroups.has(group);
            group.hidden = !hasVisible;
            group.style.display = hasVisible ? "" : "none";
            if (hasVisible) {
              group.open = true;
            }
          });

          const empty = byId("settingsEmpty");
          const hint = byId("settingsHint");
          const label = getLabel(EFFECT_LABELS, selected);

          if (!isEffect || selected === "none") {
            return;
          }

          if (empty) {
            if (visibleCount === 0) {
              empty.textContent = "No adjustable settings for " + label + ".";
              empty.style.display = "block";
            } else {
              empty.style.display = "none";
            }
          }

          if (hint) {
            hint.textContent = "Tuning settings for " + label + ".";
          }
        }

        function applyConfigToUI(config) {
          if (!config) return;
          byId("domEnabled").checked = !!config.enabled;
          byId("mode").value = config.mode || "both";
          byId("reducedMotion").checked = !!config.reducedMotionRespect;
          byId("zIndex").value = Number(config.zIndex || 999999);

          document.querySelectorAll("[data-path]").forEach((el) => {
            const value = getConfigValue(config, el.dataset.path);
            if (typeof value === "undefined") return;
            if (el.type === "checkbox") {
              el.checked = !!value;
            } else {
              el.value = value;
            }
            const output = el.dataset.output ? byId(el.dataset.output) : null;
            if (output) {
              output.textContent = el.value;
            }
          });

          const selection = selectionFromConfig(config);
          const selectionValue =
            selection.type === "none" ? "none" : selection.type + ":" + selection.name;
          setSelectionValue(selectionValue);
          applySettingsFilter(selection.name, selection.type);
        }

        function bindMasterControls(api) {
          byId("domEnabled").addEventListener("change", (event) => {
            const enabled = !!event.target.checked;
            api.enableDomOverlay(enabled);

            // Prevent any implicit auto-start behavior; playback is controlled by Play/Stop.
            if (enabled && api.stopOverlayTheme) {
              api.stopOverlayTheme();
            }

            setNowPlaying("none");
            updatePlaybackButton(false);
            persistConfig(api);
            updateDiagnostics(api);
          });

          byId("mode").addEventListener("change", () => {
            persistConfig(api);
          });

          byId("reducedMotion").addEventListener("change", () => {
            persistConfig(api);
          });

          byId("zIndex").addEventListener("change", () => {
            persistConfig(api);
          });
        }

        function bindPathControls(api) {
          document.querySelectorAll("[data-path]").forEach((el) => {
            const output = el.dataset.output ? byId(el.dataset.output) : null;
            const updateOutput = () => {
              if (output) {
                output.textContent = el.value;
              }
            };

            updateOutput();

            // Live value display only (no auto-play, no persistence here).
            el.addEventListener("input", updateOutput);

            // Persist on committed change.
            el.addEventListener("change", () => {
              persistConfig(api, el);
              updateOutput();
              if (el.id === "halloweenStyle") {
                updateHalloweenControlsVisibility(el.value);
              }
            });
          });
        }

        function bindSelectionRadios(api) {
          const radios = Array.from(document.querySelectorAll('input[name="previewSelection"]'));
          const apply = () => {
            const selection = getSelection();

            // Update config
            if (api && api.setConfig) {
              if (selection.type === "theme") {
                api.setConfig({ preferredTheme: selection.name, preferredEffect: "none" });
              } else if (selection.type === "effect") {
                api.setConfig({ preferredEffect: selection.name, preferredTheme: "none" });
              } else {
                api.setConfig({ preferredEffect: "none", preferredTheme: "none" });
              }
            }

            // Persist preference changes immediately (do not auto-play on selection).
            if (api && api.saveConfig) {
              try {
                api.saveConfig();
              } catch (err) {
                // Fail silent
              }
            }

            applySettingsFilter(selection.name, selection.type);

            // Autoplay selection for quick preview.
            playSelectionFromUI(api);
          };
          radios.forEach((radio) => {
            radio.addEventListener("change", apply);
          });
        }

        function bindAuraControls(api) {
          // Aura is now a one-shot effect, no special binding needed
          // The old aura radios section has been removed
        }

        function bindSmokeThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindRainThemeControls(api) {
          const intensityEl = byId("rainThemeIntensity");
          if (!intensityEl) return;

          const presets = {
            soft: {
              emissionRate: 16,
              maxParticles: 160,
              speedMin: 420,
              speedMax: 750,
              lengthMin: 10,
              lengthMax: 20,
              drift: 45,
              windVarMin: -6,
              windVarMax: 6,
              thicknessMin: 0.7,
              thicknessMax: 1.3,
            },
            medium: {
              emissionRate: 30,
              maxParticles: 260,
              speedMin: 520,
              speedMax: 920,
              lengthMin: 14,
              lengthMax: 30,
              drift: 60,
              windVarMin: -12,
              windVarMax: 12,
              thicknessMin: 0.8,
              thicknessMax: 1.6,
            },
            heavy: {
              emissionRate: 55,
              maxParticles: 420,
              speedMin: 700,
              speedMax: 1300,
              lengthMin: 18,
              lengthMax: 40,
              drift: 90,
              windVarMin: -18,
              windVarMax: 18,
              thicknessMin: 1.0,
              thicknessMax: 2.1,
            },
            storm: {
              emissionRate: 120,
              maxParticles: 820,
              speedMin: 950,
              speedMax: 1800,
              lengthMin: 24,
              lengthMax: 55,
              drift: 150,
              windVarMin: -28,
              windVarMax: 28,
              thicknessMin: 1.2,
              thicknessMax: 2.6,
            },
          };

          intensityEl.addEventListener("change", () => {
            const key = intensityEl.value;
            const patch = presets[key];
            if (!patch) return;
            try {
              api.setConfig({ themes: { rain: Object.assign({ intensity: key }, patch) } });
              api.saveConfig();
              applyConfigToUI(api.getConfig());
            } catch (err) {
              // ignore
            }
          });
        }

        function bindBurnThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindFireThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindBokehThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindElectricThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindWaterThemeControls(api) {
          // Intentionally no-op: settings persist without auto-playing/restarting themes.
        }

        function bindThemeLifetimeControl() {
          const lifetimeSelect = byId("themeLifetime");
          const durationField = byId("themeDuration");

          if (!lifetimeSelect || !durationField) return;

          const updateDurationVisibility = () => {
            const isTimed = lifetimeSelect.value === "timed";
            durationField.parentElement.style.display = isTimed ? "" : "none";
          };

          lifetimeSelect.addEventListener("change", updateDurationVisibility);
          updateDurationVisibility(); // Set initial state
        }

        function updatePlaybackButton(isPlaying) {
          const playBtn = byId("playSelection");
          const playIcon = byId("playIcon");
          const pauseIcon = byId("pauseIcon");
          const playText = byId("playButtonText");

          const stopBtn = byId("stopSelection");
          const nowPlayingWrap = byId("nowPlayingWrap");

          if (!playBtn || !playIcon || !pauseIcon || !playText || !stopBtn) return;

          const selection = getSelection();
          const hasActiveNowPlaying = !!(
            nowPlayingWrap && nowPlayingWrap.dataset.active === "true"
          );
          stopBtn.disabled = !(!!isPlaying || hasActiveNowPlaying);

          if (!isPlaying && !hasActiveNowPlaying) {
            setNowPlaying("none");
          }

          // Execute selection on Play (no pause/resume toggle; Stop always stops all).
          playIcon.style.display = "";
          pauseIcon.style.display = "none";

          let nextText = "Play";
          let nextTitle = "Play selection";

          if (selection.type === "theme" && selection.name !== "none") {
            const label = getLabel(THEME_LABELS, selection.name);
            nextText = "Play";
            nextTitle = "Play theme: " + label;
          } else if (selection.type === "effect" && selection.name !== "none") {
            const label = getLabel(EFFECT_LABELS, selection.name);
            nextText = "Play";
            nextTitle = "Play effect: " + label;
          } else {
            nextText = "Stop All";
            nextTitle = "Stop all effects";
          }

          playText.textContent = nextText;
          playBtn.dataset.tooltip = nextTitle;
          playBtn.setAttribute("aria-label", nextTitle);
        }

        function updateDiagnostics(api) {
          const diag = api && api.getDiagnostics ? api.getDiagnostics() : null;
          if (!diag) return;
          byId("diagEnabled").textContent = diag.enabled;
          byId("diagOverlay").textContent = diag.overlayExists;
          byId("diagTourObj").textContent = diag.tourObjCaptured;
          byId("diagLastEffect").textContent = diag.lastPlayedEffect || "none";
          if (diag.themeActive && diag.currentTheme) {
            setNowPlaying("theme:" + diag.currentTheme);
            updatePlaybackButton(true);
          } else {
            const label = byId("nowPlaying");
            if (label && label.textContent.indexOf("Theme:") === 0) {
              setNowPlaying("none");
              updatePlaybackButton(false);
            }
          }
        }

        function stopAllPlayback(api) {
          if (!api) return;
          if (typeof api.stopAll === "function") {
            api.stopAll();
          } else if (typeof api.stopOverlayTheme === "function") {
            api.stopOverlayTheme();
          }
          setNowPlaying("none");
          updatePlaybackButton(false);
          updateDiagnostics(api);
        }

        function playSelectionFromUI(api) {
          if (!api) return;
          const selection = getSelection();

          if (selection.type === "theme" && selection.name !== "none") {
            if (typeof api.startOverlayTheme === "function") {
              api.startOverlayTheme(selection.name);
            }
            setNowPlaying("theme:" + selection.name);
            updatePlaybackButton(true);
          } else if (selection.type === "effect" && selection.name !== "none") {
            if (typeof api.stopOverlayTheme === "function") {
              api.stopOverlayTheme();
            }
            if (typeof api.playEffect === "function") {
              api.playEffect(selection.name);
            }
            const duration = getEffectDurationMs(
              selection.name,
              api.getConfig ? api.getConfig() : null
            );
            setNowPlaying(selection.name, duration);
            updatePlaybackButton(false);
          } else {
            stopAllPlayback(api);
            return;
          }

          updateDiagnostics(api);
        }

        function bindKeyboardShortcuts(api) {
          document.addEventListener("keydown", (event) => {
            if (event.key === "Escape" || event.key === "Esc") {
              stopAllPlayback(api);
            }
          });
        }

        function bindActions(api) {
          const resetBtn = byId("resetAnimation");
          if (resetBtn) {
            resetBtn.addEventListener("click", () => {
              try {
                const selection = getSelection();
                const defaults =
                  api && api._internals && api._internals.Config && api._internals.Config.DEFAULTS
                    ? api._internals.Config.DEFAULTS
                    : null;

                if (
                  defaults &&
                  selection &&
                  selection.type &&
                  selection.name &&
                  selection.name !== "none"
                ) {
                  if (
                    selection.type === "theme" &&
                    defaults.themes &&
                    defaults.themes[selection.name]
                  ) {
                    api.setConfig({
                      themes: { [selection.name]: defaults.themes[selection.name] },
                    });
                  } else if (
                    selection.type === "effect" &&
                    defaults.effects &&
                    defaults.effects[selection.name]
                  ) {
                    api.setConfig({
                      effects: { [selection.name]: defaults.effects[selection.name] },
                    });
                  }
                }

                // Persist + refresh UI so sliders/toggles snap back to defaults.
                if (api && typeof api.saveConfig === "function") api.saveConfig();
                if (api && typeof api.getConfig === "function") applyConfigToUI(api.getConfig());
              } catch (err) {
                // ignore
              }

              // Restart playback from a clean slate.
              stopAllPlayback(api);
              playSelectionFromUI(api);

              // Cross-tab reset (tour listens for this token).
              try {
                api.setConfig({ resetAnimationsToken: Date.now() });
                api.saveConfig();
              } catch (err) {
                // ignore
              }

              showToast("Reset to defaults");
            });
          }

          byId("playSelection").addEventListener("click", () => {
            playSelectionFromUI(api);
          });

          byId("stopSelection").addEventListener("click", () => {
            stopAllPlayback(api);
          });

          byId("saveConfig").addEventListener("click", () => {
            api.saveConfig();
            showToast("Settings saved");
          });

          byId("exportConfig").addEventListener("click", () => {
            const config = api.getConfig();
            const json = JSON.stringify(config, null, 2);
            const blob = new Blob([json], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "effects-config.json";
            link.click();
            URL.revokeObjectURL(url);
            showToast("Config exported");
          });

          byId("exportConfigJs").addEventListener("click", () => {
            const config = api.getConfig();
            const header =
              "/**\n" +
              " * Effects Pro Configuration\n" +
              " * Generated on " +
              new Date().toLocaleString() +
              "\n" +
              " * Include after effects-core.js in your tour:\n" +
              ' * <script src=\\"visual-effects-pro/effects-pro/effects-core.js\\"><\\\\/script>\n' +
              ' * <script src=\\"visual-effects-pro/effects-pro/effects-pro-config.js\\"><\\\\/script>\n' +
              " */\n\n";
            const body =
              "window.effectsProConfig = " +
              JSON.stringify(config, null, 2) +
              ";\n\n" +
              "if (typeof module !== 'undefined' && module.exports) {\n" +
              "  module.exports = window.effectsProConfig;\n" +
              "}\n\n" +
              "console.log('✅ Effects Pro config loaded');\n";
            const blob = new Blob([header + body], { type: "application/javascript" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "effects-pro-config.js";
            link.click();
            URL.revokeObjectURL(url);
            showToast("Auto-apply JS exported");
          });

          byId("importConfig").addEventListener("change", (event) => {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (loadEvent) => {
              try {
                const imported = JSON.parse(loadEvent.target.result);
                api.setConfig(imported);
                api.saveConfig();
                applyConfigToUI(api.getConfig());
                api.enableDomOverlay(byId("domEnabled").checked);
                setNowPlaying("none");
                showToast("Config imported");
              } catch (err) {
                showToast("Invalid JSON file", true);
              }
            };
            reader.readAsText(file);
            event.target.value = "";
          });
        }

        waitForApi((api, err) => {
          if (!api) {
            try {
              if (err) {
                // eslint-disable-next-line no-console
                console.error(err);
              }
            } catch (e) {
              // ignore
            }
            const msg =
              err && err.message
                ? "Effects core failed to load: " + String(err.message)
                : "Effects core not loaded";
            showToast(msg, true);
            return;
          }

          const effectsList = api.getEffectsList ? api.getEffectsList() : EFFECTS;
          const themesList = api.getThemesList ? api.getThemesList() : THEMES;
          renderSelectionRadios(effectsList, themesList);

          api.loadConfig();
          api.initializeEffects();
          const cfg = api.getConfig ? api.getConfig() : null;
          const defaultsPatch = {};

          if (!cfg || typeof cfg.preferredEffect === "undefined") {
            defaultsPatch.preferredEffect = "none";
          }
          if (!cfg || typeof cfg.preferredTheme === "undefined") {
            defaultsPatch.preferredTheme = "none";
          }
          if (
            !cfg ||
            typeof cfg.aura === "undefined" ||
            cfg.aura === null ||
            typeof cfg.aura !== "object"
          ) {
            defaultsPatch.aura = { enabled: false, level: "none" };
          } else {
            const auraPatch = {};
            if (typeof cfg.aura.enabled === "undefined") auraPatch.enabled = false;
            if (typeof cfg.aura.level === "undefined") auraPatch.level = "none";
            if (Object.keys(auraPatch).length) {
              defaultsPatch.aura = auraPatch;
            }
          }

          if (Object.keys(defaultsPatch).length) {
            api.setConfig(defaultsPatch);
          }

          const config = api.getConfig();
          applyConfigToUI(config);
          api.enableDomOverlay(!!config.enabled);
          if (api.stopAll) {
            api.stopAll();
          } else if (api.stopOverlayTheme) {
            api.stopOverlayTheme();
          }
          setNowPlaying("none");
          updatePlaybackButton(false);

          bindMasterControls(api);
          bindPathControls(api);
          bindSelectionRadios(api);
          bindAuraControls(api);
          bindRainThemeControls(api);
          bindSmokeThemeControls(api);
          bindBurnThemeControls(api);
          bindFireThemeControls(api);
          bindBokehThemeControls(api);
          bindElectricThemeControls(api);
          bindWaterThemeControls(api);
          bindThemeLifetimeControl();
          bindActions(api);
          bindKeyboardShortcuts(api);
          updateDiagnostics(api);
          setInterval(() => updateDiagnostics(api), 1000);
        });
      })();
    </script>
  </body>
</html>
